{
  "hash": "c6b16785b1830336454027fdccb844cf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"One Parameter Models\"\ndate: \"September 8, 2024\"\ndate-modified: last-modified\nformat:\n  metropolis-revealjs:\n    mermaid-format: svg\n---\n\n\n\n\n\n# Bernoulli Model\n\n## Data (Subsample)\n\n- Patients diagnosed with AIDS in Australia before 1 July 1991\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|state |sex |diag       |death      |status |T.categ | age|\n|:-----|:---|:----------|:----------|:------|:-------|---:|\n|VIC   |M   |1991-03-05 |1991-07-01 |A      |hs      |  36|\n|NSW   |M   |1987-08-30 |1988-03-11 |D      |hs      |  25|\n|QLD   |M   |1989-10-09 |1990-08-22 |D      |hs      |  36|\n|NSW   |M   |1991-03-17 |1991-07-01 |A      |hs      |  42|\n|NSW   |M   |1986-04-12 |1989-01-31 |D      |hs      |  40|\n|NSW   |M   |1986-09-29 |1987-03-25 |D      |hs      |  69|\n|NSW   |M   |1989-08-24 |1991-07-01 |A      |hs      |  37|\n|Other |F   |1988-10-19 |1991-07-01 |A      |id      |  30|\n|NSW   |M   |1990-04-07 |1991-01-21 |D      |hs      |  30|\n|NSW   |M   |1988-04-28 |1990-04-07 |D      |hs      |  41|\n\n\n:::\n:::\n\n\n\n---\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n![Cpc chine at English Wikipedia, CC BY-SA 3.0 <https://creativecommons.org/licenses/by-sa/3.0>, via Wikimedia Commons](https://upload.wikimedia.org/wikipedia/commons/b/bf/Australian_States_and_Territories_with_CDS.jpg){.external}\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-3-1.png){width=90%}\n:::\n:::\n\n\n  \n\n:::\n\n::::\n\nLet's go through the Bayesian workflow\n\n---\n\n\n\n```{mermaid}\n%%| fig-width: 10.5\n%%| fig-height: 7\nflowchart LR\n  subgraph DATA\n    direction TB\n    A[Identify/Collect Data] --> B[Visualize Data]\n  end\n    %% B --> C[Choose/Modify Model]\n  subgraph MODEL\n    I -->|Model fit not satisfactory|C\n    C[Choose/Modify Model] --> D[Specify Priors]\n    D --> E[Prior Predictive Check]\n    E --> G[MCMC Sampling with Convergence diagnostics]\n    G --> H[Conduct Posterior Predictive Check]\n    H --> I[Posterior Predictive Check]\n  end\n  subgraph RESULTS\n    %% I -->|Model is reasonable|J[Model comparisons/averaging]\n    J[Model comparisons/averaging] --> K[Interpret and Visualize Results]\n  end\n  DATA --> MODEL\n  MODEL -->RESULTS\n```\n\n\n\n## Choose a Model: Bernoulli\n\nData: $y$ = survival status (0 = \"A\", 1 = \"D\")\n\nParameter: $\\theta$ = probability of \"D\"\n\nModel equation: $y_i \\sim \\text{Bern}(\\theta)$ for $i = 1, 2, \\ldots, N$\n\n- The model states:\n\n> the sample data $y$ follows a Bernoulli distribution with the common parameter $\\theta$\n\n## Bernoulli Likelihood\n\nNotice that there is no subscript for $\\theta$:\n\n- The model assumes each observation has the same $\\theta$\n- I.e., the observations are exchangeable\n\n$$\nP(y_1, y_2, \\ldots, y_N) = \\theta^z (1 - \\theta)^{N - z}\n$$\n\n$z$ = number of \"successes\" (\"D\")\n- $z$ = 6 in this illustrative sample\n\n---\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| theta| likelihood|\n|-----:|----------:|\n|   0.0|    0.00000|\n|   0.1|    0.00000|\n|   0.2|    0.00003|\n|   0.3|    0.00018|\n|   0.4|    0.00053|\n|   0.5|    0.00098|\n|   0.6|    0.00119|\n|   0.7|    0.00095|\n|   0.8|    0.00042|\n|   0.9|    0.00005|\n|   1.0|    0.00000|\n\n\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-6-1.png){width=90%}\n:::\n:::\n\n\n\n:::\n\n::::\n\n## Choosing Priors\n\nWhen choosing priors, start with the **support** of the parameter(s)\n\n- Values that are possible\n\n. . .\n\nSupport for $\\theta$: [0, 1]\n\n::: {.callout}\n\n## One possible (but unlikely) option\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-7-1.png){width=384}\n:::\n:::\n\n\n\n$\\theta$ values in the range $[.40, .60)$ are **5** times more likely than any values outside of that range\n\n:::\n\n## Conjugate Prior: Beta Distribution\n\n$$\nP(\\theta \\mid a, b) \\propto \\theta^{a - 1} (1 - \\theta)^{b - 1} I_{[0, 1]}\n$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- 1\nb <- 1\ndbeta(theta1, shape1 = a, shape2 = b)\n```\n:::\n\n\n\n::: {.callout-important}\n\n## Conjugate Prior\n\nA prior distribution that yields posterior in the same distribution family as the prior\n\n:::\n\n::: aside\nSome other conjugate distributions: <https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions>\n:::\n\n---\n\nTwo **hyperparameters**, $a$ and $b$:\n\n- $a - 1$ = number of prior 'successes' (e.g., \"D\")\n- $b - 1$ = number of prior 'failures'\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=720}\n:::\n:::\n\n\n\n## More on the Beta Distribution\n\nWhen $a > b$, more density to the right (i.e., larger $\\theta$), and vice versa\n\nMean = $a / (a + b)$\n\nConcentration = $\\kappa = a + b$; $\\uparrow \\kappa$, $\\downarrow$ variance, $\\uparrow$ strength of prior\n\nE.g., A Beta(1, 1) prior means 0 prior success and 0 failure\n\n- i.e., no prior information (i.e., *noninformative*)\n\n---\n\n::: {.callout-note}\n\n## Notes on Choosing Priors\n\n- **Give $>$ 0 probability/density for all possible values of a parameter**\n\n- When the prior contains relatively little information\n    * different choices usually make little difference\n\n- Do a prior predictive check\n\n- *Sensitivity analyses* to see how sensitive results are to different reasonable prior choices.\n\n:::\n\n## Obtaining the Posterior Analytically\n\n$$\nP(\\theta \\mid y) = \\frac{P(y \\mid \\theta) P(\\theta)}{\\int_0^1 P(y \\mid \\theta^*) P(\\theta^*) d \\theta^*}\n$$\n\nThe denominator is usually intractable\n\n. . .\n\nConjugate prior: Posterior is from a known distribution family\n\n- $N$ trials and $z$ successes\n- $\\mathrm{Beta}(a, b)$ prior\n- $\\Rightarrow$ $\\mathrm{Beta}(a + z, b + N - z)$ posterior\n    * $a + \\color{red}{z} - 1$ successes\n    * $b + \\color{red}{N - z} - 1$ failures\n\n## Back to the Example\n\n$N$ = 10, $z$ = 6\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\nPrior: Do you believe that the fatality rate of AIDS is 100%? or 0%?\n\n- Let's use $\\kappa = 4$, prior mean = 0.5, so $a$ = 2 and $b$ = 2\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-10-1.png){width=100%}\n:::\n:::\n\n\n\n:::\n\n::::\n\n## Posterior Beta\n\n$$\n\\theta \\mid y \\sim \\mathrm{Beta}(2 + 6, 2 + 4)\n$$\n\n\n\n::: {.cell output-location='fragment'}\n\n```{.r .cell-code}\nggplot(data.frame(x = c(0, 1)), aes(x = x)) +\n    stat_function(fun = dbeta,\n                  args = list(shape1 = 8, shape2 = 6)) +\n    labs(title = \"Beta(a = 8, b = 6)\",\n         x = expression(theta), y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-11-1.png){width=480}\n:::\n:::\n\n\n\n## Summarizing the Posterior\n\nIf the posterior is from a known family, one can evalue summary statistics analytically\n\n- E.g., $E(\\theta \\mid y) = \\int_0^1 \\theta P(\\theta \\mid y) d \\theta$\n\nHowever, more often, a simulation-based approach is used to draw samples from the posterior\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_draws <- 1000\nsim_theta <- rbeta(1000, shape1 = 8, shape2 = 6)\n```\n:::\n\n\n\n---\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Statistic |Common.name                                   |Value          |\n|:---------|:---------------------------------------------|:--------------|\n|mean      |Bayes estimate/Expected a posteriori (EAP)    |0.563          |\n|median    |Posterior median                              |0.567          |\n|mode      |Maximum a posteriori (MAP)                    |0.577          |\n|SD        |Posterior SD                                  |0.126          |\n|MAD       |Posterior MAD                                 |0.13           |\n|80% CI    |(Equal-tailed) Credible interval              |[0.398, 0.727] |\n|80% HDI   |HDI/Highest Posterior Density Interval (HPDI) |[0.404, 0.733] |\n\n\n:::\n:::\n\n\n\n## Using the Full Data\n\n1082 A, 1761 D $\\rightarrow$ $N$ = 2843, $z$ = 1761\n\nPosterior: Beta(1763, 1084)\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-14-1.png){width=480}\n:::\n:::\n\n\n\n# Stan\n\nSee [notes](/docs/04b-beta-bernoulli-stan.html)\n\n## Posterior Predictive Check\n\n::: {.callout-important}\n\n## Posterior Predictive Distribution\n\n$$\nP(\\tilde y \\mid y) = \\int P(\\tilde y \\mid \\theta, y) P(\\theta \\mid y) d \\theta\n$$\n\n- $\\tilde y$ = new/future data\n\n:::\n\n. . .\n\nSimulate a new $\\theta^*$ from posterior, then simulate a new data set\n\n. . .\n\nIf the model does not fit the data, any results are basically meaningless at best, and can be very misleading\n\nRequires substantive knowledge and some creativity\n\n- E.g., are the case fatality rates equal across the 4 state categories?\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheta_new <- rbeta(1, 1763, 1084)                 # <1>\nstatus_new <- sample(c(\"D\", \"A\"), nrow(Aids2),    # <2>\n    replace = TRUE, prob = c(theta_new, 1 - theta_new)\n)\ndf_new <- Aids2 |>\n    mutate(status = factor(status_new))\n```\n:::\n\n\n1. Sample a new theta from the posterior\n2. Sample new data based on the new theta\n\n---\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](one_parameter_models_files/figure-revealjs/unnamed-chunk-16-1.png){width=739.2}\n:::\n:::\n\n\n\n## Some Common Checks\n\n- Does the model simulate data with similar distributions as the observed data?\n    * e.g., skewness, range\n- Subsets of observed data that are of more interest?\n    * e.g., old age group\n    * If not fit, age should be incorporated in the model\n\nSee an example in @gabry2019\n\n## Example Check: Sample mean by age group\n\nHere we use the function `bayesplot::ppc_stat_grouped()`{.r}\n\n```r\nage50 <- factor(Aids2$age > 50, labels = c(\"<= 50\", \"> 50\"))  # <1>\nbern_pp_fit$draws(\"ytilde\", format = \"draws_matrix\") |>         # <2>\n    ppc_stat_grouped(y = Aids2_standata$y, group = age50, stat = \"mean\")  # <3>\n```\n1. Create binary indicator of two age groups\n2. Extract simulated data sets\n3. Plot a histogram of the sample means from the simulated data (i.e., posterior predictive distribution) for each age group\n\n# Other One-Parameter Models\n\n## Binomial Model\n\n- For count outcome: $y_i \\sim \\mathrm{Bin}(N_i, \\theta)$\n    * $\\theta$: rate of occurrence (per trial)\n- Conjugate prior: Beta\n- E.g.,\n    * $y$ minority candidates in $N$ new hires\n    * $y$ out of $N$ symptoms checked\n    * A word appears $y$ times in a tweet of $N$ number of words\n\n## Poisson Model\n\n- For count outcome: $y_i \\sim \\mathrm{Pois}(\\theta)$\n    * $\\theta$: rate of occurrence\n- Conjugate prior: Gamma\n- E.g., \n    * Drinking $y$ times in a week\n    * $y$ hate crimes in a year for a county\n    * $y$ people visiting a store in an hour\n\n## Bibliography",
    "supporting": [
      "one_parameter_models_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
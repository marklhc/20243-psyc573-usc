{
  "hash": "2dd42ec0026c90839d58609235eedcde",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Causal Inference\"\ndate-modified: last-modified\nformat: metropolis-revealjs\n---\n\n\n\n\n\n## Causation\n\n> Data are profoundly dumb about causal relationships\n\n--- @pearl2020\n\n## Outline\n\n- Thought experiments\n- Potential outcomes\n- Causal diagrams\n- Mediation\n\n::: {.content-hidden unless-profile=\"class\"}\n\n## Thought Experiment {.unnumbered}\n\nYou have a group of 20 friends. You found out 10 have taken a \"smart pill,\" and the others have not. When comparing the stat exam performance of the two groups, the \"smart pill\" group, on average, is better, with 90% CI [1.0, 5.0].\n\n> Do you think the \"smart pill\" causes half of your friends to do better in stat?\n\n## Thought Experiment (cont'd) {.unnumbered}\n\nA researcher conducts an experiment with 20 students. Ten are randomly assigned to take a \"smart pill,\" and the other a placebo. When comparing the stat exam performance of the two groups, the \"smart pill\" group, on average, is better, with 90% CI [1, 5].\n\n> Do you think the \"smart pill\" causes half of the students to do better in stat?\n\n---\n\n## {.unnumbered}\n\nIs there any difference in the **statistical results** between the two scenarios?\n\nIs there any difference in **causal implications** between the two scenarios?\n\n## Thought Experiment (cont'd) {.unnumbered}\n\nA researcher conducts a study with 20 students. Ten volunteers took a \"smart pill,\" and then the researcher compared their stat exam performance with 10 other students who had similar stat background as the \"smart pill\" group but did not take the pill. The \"smart pill\" group, on average, is better, with 90% CI [1, 5].\n\n> Do you think the \"smart pill\" causes the first 10 students to do better in stat?\n\n:::\n\n## Causal Inference\n\nObtaining an estimate of the causal effect of one variable on another\n\n. . .\n\n> an hour more exercise per day causes an increase in happiness by 0.1 to 0.2 points\n\n. . .\n\n- Intervention: if I exercise one hour more, my happiness will increase by 0.1 to 0.2 points\n- Counterfactual: had I exercised one less hour, my happiness would have been 0.1 to 0.2 points less\n\n## Potential Outcomes\n\n$T$ is the binary treatment variable (e.g., new drug for boosting stat knowledge)\n\n---\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Person  |Math Attitude |Y (if T = 1) |Y (if T = 0) |Y(1) - Y(0) |\n|:-------|:-------------|:------------|:------------|:-----------|\n|1       |4             |75           |70           |5           |\n|2       |7             |80           |88           |-8          |\n|3       |3             |70           |75           |-5          |\n|4       |9             |90           |92           |-2          |\n|5       |5             |85           |82           |3           |\n|6       |6             |82           |85           |-3          |\n|7       |8             |95           |90           |5           |\n|8       |2             |78           |78           |0           |\n|Average |5.5           |81.875       |82.5         |-0.625      |\n\n\n:::\n:::\n\n\n\n## Average Treatment Effect (ATE)\n\n$$\n\\text{ATE} = \\bar Y(1) - \\bar Y(0)\n$$\n\n## Observed Outcomes\n\nOnly one potential outcome is observed for each person\n\n. . .\n\nE.g., Persons 2, 4, 6, 7 take the drug\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Person  |T  |Math Attitude |Y (if T = 1) |Y (if T = 0) |\n|:-------|:--|:-------------|:------------|:------------|\n|1       |0  |4             |             |70           |\n|2       |1  |7             |80           |             |\n|3       |0  |3             |             |75           |\n|4       |1  |9             |90           |             |\n|5       |0  |5             |             |82           |\n|6       |1  |6             |82           |             |\n|7       |1  |8             |95           |             |\n|8       |0  |2             |             |78           |\n|average |   |5.5           |86.75        |76.25        |\n\n\n:::\n:::\n\n\n\n::: {.content-hidden unless-profile=\"class\"}\n\n---\n\nWhy is the mean difference between the observed outcomes of the two groups so different from the true ATE?\n:::\n\n## Directed Acyclic Graph\n\n. . .\n\nAllows researchers to encode **causal assumptions** of the data\n\n- Based on knowledge of the *data* and the *variables*\n\n. . .\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n\n---\n\nData from the 2009 American Community Survey (ACS)\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n\n. . .\n\nDoes marriage **cause** divorce?\n\n---\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n- A = Median age of marriage\n- M = Marriage rate\n- D = Divorce rate\n:::\n\n::::\n\n. . .\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n### \"Weak\" assumptions\n\n- A *may* directly influence M\n- A *may* directly influence D\n- M *may* directly influence D\n\n:::\n\n::: {.column width=\"50%\"}\n\n### \"Strong\" assumptions\n\nAbsence of a link\n\n- E.g., M does not directly influence A\n- E.g., A is the only relevant variable in the causal pathway M &rarr; D\n\n:::\n\n::::\n\n## Basic Types of Junctions\n\n**Fork**: A &larr; B &rarr; C\n\n**Chain/Pipe**: A &rarr; B &rarr; C\n\n**Collider**: A &rarr; B &larr; C\n\n---\n\n## Fork\n\naka Classic confounding\n- *Confound*: something that misleads us about a causal influence\n\nM &larr; <span style=\"color:red\">A</span> &rarr; D\n\n. . .\n\nAssuming the DAG is correct,\n- the *causal effect* of M &rarr; D can be obtained by holding constant A\n    * stratifying by A; \"controlling\" for A\n\n## Pedicting an Intervention\n\n> What would happen to the divorce rate if we encourage more people to get married, so that marriage rate increases by 1 per 10 adults?\n\n. . .\n\nBased on our DAG, this should not change the median marriage age\n\n# Randomization\n\nRemoving incoming path to the \"causal\" variable\n\n::: {.content-hidden unless-profile=\"class\"}\n\nCan we infer causal and effect in the absence of randomized experiments?\n\n. . .\n\nDoes smoking cause lung cancer?\n\n:::\n\n## Framing Experiment\n\n- X: exposure to a negatively framed news story about immigrants\n- Y: anti-immigration political action\n\n. . .\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\nNo Randomization\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n\n:::\n\n::: {.notes}\nPotential confound:\n- Location\n- Usual outlet/source to acquire information\n:::\n\n::: {.column width=\"50%\"}\n\nRandomization\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n\n:::\n\n::::\n\n## Back-Door Criterion\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n\nThe causal effect of X &rarr; Y can be obtained by blocking all the backdoor paths that do not involve descendants of X\n\n. . .\n\n- Randomization: (when done successfully) eliminates all paths entering X\n- Conditioning (holding constant)\n\n## Dagitty\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dagitty)\ndag4 <- dagitty(\"dag{\n  X -> Y; W1 -> X; U -> W2; W2 -> X; W1 -> Y; U -> Y\n}\")\nlatents(dag4) <- \"U\"\nadjustmentSets(dag4, exposure = \"X\", outcome = \"Y\",\n               effect = \"direct\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{ W1, W2 }\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimpliedConditionalIndependencies(dag4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nW1 _||_ W2\n```\n\n\n:::\n:::\n\n\n\n::: {.content-hidden unless-profile=\"class\"}\n\n## Exercise {.unnumbered}\n\n![](/images/McElreath_2020_ch6_ex.jpg)\n\n:::\n\n# Post-Treatment Bias\n\nAdjusting/\"controlling\" for covariates imply a causal interpretation\n\n> Please do not simply adjust for a variable without thinking about it (especially variables that may be impacted by the treatment)\n\nSee @chatton2024, Figure 1\n\n::: {.content-hidden unless-profile=\"class\"}\n![](/images/Chatton_etal_2024_fig1.png)\n:::\n\n## Data for Framing Experiment\n\n- `cong_mesg`: binary variable indicating whether or not the participant agreed to send a letter about immigration policy to his or her member of Congress\n\n- `emo`: post-test anxiety about increased immigration (0-9)\n\n- `tone`: framing of news story (0 = positive, 1 = negative)\n\n## Results\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n      function styleCell_4cq4xblckcb1hgvj1cg3(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_4cq4xblckcb1hgvj1cg3\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_4cq4xblckcb1hgvj1cg3');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_4cq4xblckcb1hgvj1cg3(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_4cq4xblckcb1hgvj1cg3\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(0, 0, 'tinytable_css_idf01p3kt9amso01sl8ekj') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(0, 1, 'tinytable_css_idej8ud8qch7qu7twadrtu') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(0, 2, 'tinytable_css_idej8ud8qch7qu7twadrtu') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(1, 0, 'tinytable_css_idn764rz3dcwfghqwu1i7m') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(1, 1, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(1, 2, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(2, 0, 'tinytable_css_idn764rz3dcwfghqwu1i7m') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(2, 1, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(2, 2, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(3, 0, 'tinytable_css_id24wbqufv67ve27joln2r') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(3, 1, 'tinytable_css_idlm9kilcswzwgn71zh49e') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(3, 2, 'tinytable_css_idlm9kilcswzwgn71zh49e') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(4, 0, 'tinytable_css_idn764rz3dcwfghqwu1i7m') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(4, 1, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\nwindow.addEventListener('load', function () { styleCell_4cq4xblckcb1hgvj1cg3(4, 2, 'tinytable_css_id57y1tdyy7zmusr63h40w') })\n    </script>\n\n    <style>\n    .table td.tinytable_css_idf01p3kt9amso01sl8ekj, .table th.tinytable_css_idf01p3kt9amso01sl8ekj {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }\n    .table td.tinytable_css_idej8ud8qch7qu7twadrtu, .table th.tinytable_css_idej8ud8qch7qu7twadrtu {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }\n    .table td.tinytable_css_idn764rz3dcwfghqwu1i7m, .table th.tinytable_css_idn764rz3dcwfghqwu1i7m {  text-align: left; }\n    .table td.tinytable_css_id57y1tdyy7zmusr63h40w, .table th.tinytable_css_id57y1tdyy7zmusr63h40w {  text-align: center; }\n    .table td.tinytable_css_id24wbqufv67ve27joln2r, .table th.tinytable_css_id24wbqufv67ve27joln2r {  border-bottom: solid 0.05em black;  text-align: left; }\n    .table td.tinytable_css_idlm9kilcswzwgn71zh49e, .table th.tinytable_css_idlm9kilcswzwgn71zh49e {  border-bottom: solid 0.05em black;  text-align: center; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_4cq4xblckcb1hgvj1cg3\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">No adjustment</th>\n                <th scope=\"col\">Adjusting for feeling</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>b_Intercept</td>\n                  <td>-0.81 [-1.20, -0.45]</td>\n                  <td>-1.99 [-2.62, -1.44]</td>\n                </tr>\n                <tr>\n                  <td>b_tone     </td>\n                  <td>0.21 [-0.30, 0.73]  </td>\n                  <td>-0.15 [-0.72, 0.43] </td>\n                </tr>\n                <tr>\n                  <td>b_emo      </td>\n                  <td>                    </td>\n                  <td>0.32 [0.21, 0.43]   </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.003               </td>\n                  <td>0.142               </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n\n::: {.notes}\nNegative framing: emphasizing costs\nPositive framing: emphasizing benefits\n:::\n\n. . .\n\nWhich one estimates the causal effect of `tone`?\n\n# Mediation\n\nMediation is a causal analysis, by definition\n\n## Mediation\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\n\nIn the DAG, E is a post-treatment variable potentially influenced by T\n- E is a potential **mediator**\n\n. . .\n\n::: {.callout-important}\nA mediator is very different from a confounder\n:::\n\n\n\n\n\n\n\n## Direct Effect\n\nCausal effect when holding mediator at a specific level (e.g., T &rarr; C when E = 5)\n\n*Controlled direct effect*\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| tone| emo| Estimate| Est.Error|  Q2.5| Q97.5|\n|----:|---:|--------:|---------:|-----:|-----:|\n|    0|   0|    0.121|     0.032| 0.066| 0.191|\n|    1|   0|    0.108|     0.033| 0.054| 0.183|\n|    0|   9|    0.698|     0.070| 0.556| 0.823|\n|    1|   9|    0.670|     0.063| 0.542| 0.786|\n\n\n:::\n:::\n\n\n\n## Natural Direct Effect\n\nComparing two potential outcomes: (a) Y(T = 1, M = M[0]) and (b) Y(T = 0, M = M[0])\n\nE.g., What would the effect of negatively-framed story be *had it not elicited* negative emotions?\n\n## Natural Indirect Effect\n\nChange in $Y$ of the control group if their mediator level changes to what the treatment group *would have obtained*\n\ni.e., Y(T = 0, M = M[1]) - Y(T = 0, M = M[0])\n\nE.g., What would the effect of negatively-framed story be *had it only elicited* negative emotions, but did not affect anything else?\n\n## Notes on Mediation\n\n::: {.incremental}\n- When the effects of T &rarr; M (usually called the a path) and M &rarr; Y (usually called the b path) are assumed linear, the indirect effect equals the product of the paths (ab)\n    * When a and/or b are not linear, the indirect effect is not constant across different levels of T and M\n    * Also the case when there is interaction between the treatment and the mediator\n:::\n\n## Assumptions of Mediation\n\n::: {.incremental}\n- No unmeasured treatment-outcome confounding\n- No unmeasured mediator-outcome confounding\n- No unmeasured treatment-mediator confounding\n- The mediator-outcome path is not moderated by the treatment\n:::\n\n. . .\n\nNote: randomization of the treatment only rules out confounding for T &rarr; M, but not for M &rarr; Y\n\n## Sensitivity Analysis\n\nAssign priors representing plausible magnitude of confounding (see notes for an example)\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n\n## Collider Bias\n\n:::: {.columns}\n\n::: {.column width=40%}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-19-1.png){width=384}\n:::\n:::\n\n\n\n:::\n\n::: {.column width=60%}\n\nE.g., Is the most newsworthy research the least trustworthy?\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-20-1.png){fig-align='center' width=432}\n:::\n:::\n\n\n\n:::\n\n::::\n\n::: {.content-hidden unless-profile=\"class\"}\n\n## Thought Exercise\n\nPrevious research found, among infants with low birth weight, those born to smokers had a lower mortality rate\n\nWhat is the problem?\n\n:::\n\n## Collider Bias in Real Research/Real Life\n\n- Adjusting for current neighborhood when estimating effect of schooling on earnings\n- Studying the link between impulsivity and delinquency among high-risk youth\n- Estimating association between standardized test among students admitted\n- Studying infant mortality and maternal smoking among infants with low birth weight\n\n## Instrumental Variables\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](causal_inference_files/figure-revealjs/unnamed-chunk-21-1.png){width=384}\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n\n- X = Career Adaptability\n- Y = Job Satisfaction\n- Z (instrument) = Conscientiousness\n- U = Confounding\n\n:::\n\n::::\n\n::: aside\n<https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2019.01481/full>\n:::\n\n::: {.callout-note}\n\n## Instrument\n\n- Plausible cause of X\n- Can only affect Y through X\n\n:::\n\n## Other Examples of Instrumental Variables\n\n- Distance to the nearest college for the effect of education on earnings\n- Hospital's encouragement on the effect of breastfeeding on weight outcomes\n\n## Some Other Topics for Causal Inference\n\n- Propensity score analysis\n    * Estimate probability of being in the treatment for each participant based on other covariates\n    * Balancing out pre-treatment covariates so that the comparison more resembles a randomized experiments\n- Regression discontinuity\n    * E.g., Assigning to treatment only when pre-test score is below a cutoff\n    * Pre-test score becomes the only confounding variable to be adjusted for\n\n## Remarks\n\n- Causal inference requires **causal assumptions**\n    * You need a DAG\n\n. . .\n\n- Blindly adjusting for covariates does not give better results\n    * post-treatment bias, collider bias, etc\n\n. . .\n\n- Think carefully about what causal quantity is of interest\n    * E.g., direct, indirect, total\n\n. . .\n\n- Causal inferences are possible with both experimental and non-experimental data\n\n## References",
    "supporting": [
      "causal_inference_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
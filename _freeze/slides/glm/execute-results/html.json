{
  "hash": "1b749b14b43ea12c48fba26c01b600c0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Generalized Linear Model (GLM)\"\ndate-modified: last-modified\nformat: metropolis-revealjs\n---\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n## GLM\n\nThree components:\n\n- Conditional distribution of $Y$\n- Link function\n- Linear predictor ($\\eta$)\n\n## Some Examples\n\n| Outcome type | Support          | Distributions | Link |\n|:------------:|:----------------:|:-------------:|:----:|\n| continuous | [$-\\infty$, $\\infty$] | Normal | Identity |\n| count (fixed duration) | {0, 1, $\\ldots$} | Poisson | Log |\n| count (known # of trials) | {0, 1, $\\ldots$, $N$} | Binomial | Logit |\n| binary | {0, 1} | Bernoulli | Logit |\n| ordinal | {0, 1, $\\ldots$, $K$} | categorical | Logit |\n| nominal | $K$-vector of {0, 1} | categorical | Logit |\n| multinomial | $K$-vector of {0, 1, $\\ldots$, $K$} | categorical | Logit |\n\n## Mathematical Form (One Predictor)\n\n$$\n\\begin{aligned}\n  Y_i & \\sim \\mathrm{Dist}(\\mu_i, \\tau)  \\\\\n  g(\\mu_i) & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 X_{i}\n\\end{aligned}\n$$\n\n::: {.incremental}\n- $\\mathrm{Dist}$: conditional distribution of $Y \\mid X$ (e.g., normal, Bernoulli, $\\ldots$)\n    * I.e., distribution of **prediction error**; not the marginal distribution of $Y$\n- $\\mu_i$: mean parameter for the $i$th observation\n- $\\eta_i$: linear predictor\n- $g(\\cdot)$: link function\n- ($\\tau$: dispersion parameter)\n:::\n\n## Illustration\n\nNext few slides contain example GLMs, with the same predictor $X$\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_obs <- 100\nx <- runif(num_obs, min = 1, max = 5)  # uniform x\nbeta0 <- 0.2; beta1 <- 0.5\n```\n:::\n\n\n\n\n## Normal, Identity Link\n\naka linear regression\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n$$\n\\begin{aligned}\n  Y_i & \\sim N(\\mu_i, \\sigma) \\\\\n  \\mu_i & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 X_{i}\n\\end{aligned}\n$$\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neta <- beta0 + beta1 * x\nmu <- eta\ny <- rnorm(num_obs, mean = mu, sd = 0.3)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/plot-sim-1.png){width=480}\n:::\n:::\n\n\n\n\n:::\n\n::::\n\n## Poisson, Log Link\n\naka poisson regression\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n$$\n\\begin{aligned}\n  Y_i & \\sim \\mathrm{Pois}(\\mu_i) \\\\\n  \\log(\\mu_i) & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 X_{i}\n\\end{aligned}\n$$\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neta <- beta0 + beta1 * x\nmu <- exp(eta)  # inverse link\ny <- rpois(num_obs, lambda = mu)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-8-1.png){width=480}\n:::\n:::\n\n\n\n\n:::\n\n::::\n\n## Bernoulli, Logit Link\n\naka binary logistic regression\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n$$\n\\begin{aligned}\n  Y_i & \\sim \\mathrm{Bern}(\\mu_i) \\\\\n  \\log\\left(\\frac{\\mu_i}{1 - \\mu_i}\\right) & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 X_{i}\n\\end{aligned}\n$$\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neta <- beta0 + beta1 * x\nmu <- plogis(eta)  # inverse link is logistic\ny <- rbinom(num_obs, size = 1, prob = mu)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-10-1.png){width=480}\n:::\n:::\n\n\n\n\n:::\n\n::::\n\n## Binomial, Logit Link\n\naka binomial logistic regression\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n$$\n\\begin{aligned}\n  Y_i & \\sim \\mathrm{Bin}(N, \\mu_i) \\\\\n  \\log\\left(\\frac{\\mu_i}{1 - \\mu_i}\\right) & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 X_{i}\n\\end{aligned}\n$$\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_trials <- 10\neta <- beta0 + beta1 * x\nmu <- plogis(eta)  # inverse link is logistic\ny <- rbinom(num_obs, size = num_trials, prob = mu)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-12-1.png){width=480}\n:::\n:::\n\n\n\n\n:::\n\n::::\n\n## Remarks\n\nDifferent link functions can be used\n\n- E.g., identity link or probit link for Bernoulli variables\n\n. . .\n\nLinearity is a strong assumption\n\n::: {.incremental}\n- GLM can allow $\\eta$ and $X$ to be nonlinearly related, as long as it's linear in the coefficients\n    * E.g., $\\eta_i = \\beta_0 + \\beta_1 \\log(X_{i})$\n    * E.g., $\\eta_i = \\beta_0 + \\beta_1 X_i + \\beta_2 X_i^2$\n    * But not something like $\\eta_i = \\beta_0 \\log(\\beta_1 + x_i)$\n:::\n\n# Logistic Regression\n\nSee exercise \n\n# Poisson Regression\n\n---\n\n- `count`: The seizure count between two visits\n- `Trt`: Either 0 or 1 indicating if the patient received anticonvulsant therapy\n\n$$\n\\begin{aligned}\n  \\text{count}_i & \\sim \\mathrm{Pois}(\\mu_i)  \\\\\n  \\log(\\mu_i) & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 \\text{Trt}_{i}\n\\end{aligned}\n$$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=432}\n:::\n:::\n\n\n\n\n---\n\n### Poisson with log link\n\nPredicted seizure rate = $\\exp(\\beta_0 + \\beta_1) = \\exp(\\beta_0) \\exp(\\beta_1)$ for Trt = 1; $\\exp(\\beta_0)$ for Trt = 0\n\n$\\beta_1$ = mean difference in **log** rate of seizure; $\\exp(\\beta_1)$ = ratio in rate of seizure \n\n---\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- brm(count ~ Trt, data = epilepsy4,\n          family = poisson(link = \"log\"))\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: poisson \n  Links: mu = log \nFormula: count ~ Trt \n   Data: epilepsy4 (Number of observations: 59) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept     2.07      0.07     1.94     2.21 1.00     4022     2321\nTrt1         -0.17      0.10    -0.36     0.02 1.00     3435     2620\n\nDraws were sampled using sample(hmc). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n\n\n---\n\n### Poisson with identity link\n\nIn this case, with one binary predictor, the link does not matter to the fit\n\n$$\n\\begin{aligned}\n  \\text{count}_i & \\sim \\mathrm{Pois}(\\mu_i)  \\\\\n  \\mu_i & = \\eta_i \\\\\n  \\eta_i & = \\beta_0 + \\beta_1 \\text{Trt}_{i}\n\\end{aligned}\n$$\n\n$\\beta_1$ = mean difference in the rate of seizure in two weeks\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm3 <- brm(count ~ Trt, data = epilepsy4,\n          family = poisson(link = \"identity\"))\n```\n:::\n\n\n\n\n::: {.content-hidden unless-profile=\"class\"}\n\n---\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\nPrediction With Log Link\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-17-1.png){width=432}\n:::\n:::\n\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n\nPrediction With Identity Link\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](glm_files/figure-revealjs/unnamed-chunk-18-1.png){width=432}\n:::\n:::\n\n\n\n\n:::\n\n::::\n\n:::\n\n---\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> log link </th>\n   <th style=\"text-align:center;\"> identity link </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> b_Intercept </td>\n   <td style=\"text-align:center;\"> 2.07 </td>\n   <td style=\"text-align:center;\"> 7.95 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [1.94, 2.21] </td>\n   <td style=\"text-align:center;\"> [6.99, 9.08] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> b_Trt1 </td>\n   <td style=\"text-align:center;\"> −0.17 </td>\n   <td style=\"text-align:center;\"> −1.24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> [−0.36, 0.02] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> [−2.59, 0.07] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 59 </td>\n   <td style=\"text-align:center;\"> 59 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.004 </td>\n   <td style=\"text-align:center;\"> 0.004 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ELPD </td>\n   <td style=\"text-align:center;\"> −345.8 </td>\n   <td style=\"text-align:center;\"> −343.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ELPD s.e. </td>\n   <td style=\"text-align:center;\"> 96.0 </td>\n   <td style=\"text-align:center;\"> 94.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC </td>\n   <td style=\"text-align:center;\"> 691.5 </td>\n   <td style=\"text-align:center;\"> 687.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC s.e. </td>\n   <td style=\"text-align:center;\"> 192.0 </td>\n   <td style=\"text-align:center;\"> 188.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WAIC </td>\n   <td style=\"text-align:center;\"> 690.2 </td>\n   <td style=\"text-align:center;\"> 689.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 9.54 </td>\n   <td style=\"text-align:center;\"> 9.56 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "glm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
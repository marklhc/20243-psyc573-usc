<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>14&nbsp; Mediation – PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-mcmc.html" rel="next">
<link href="./08-causal-inference.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6d9163938730c4bb45bb2ddd9242afb9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-225295148', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../modules.html"> 
<span class="menu-text">Modules</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../docs/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../exercises/index.html"> 
<span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../syllabus/index.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/marklhc/usc-psyc573-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./PSYC-573-Bayesian-Data-Analysis--2024-Fall---Course-Notes.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-causal-inference.html">Week 9</a></li><li class="breadcrumb-item"><a href="./08b-mediation.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bayes-theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayes’s Theorem</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-beta-bernoulli-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04b-beta-bernoulli-stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model With Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04c-poisson-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Poisson Model</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-hierarchical-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5–6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06b-multiple-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06c-regression-diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-stacking-and-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stacking, Regularization, and Variable Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-causal-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08b-mediation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 10–11</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09b-gibbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Gibbs Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09c-hmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Hamiltonian Monte Carlo</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 12</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Generalized Linear Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b-glm2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Generalized Linear Model (II)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#summary-statistics-tables" id="toc-summary-statistics-tables" class="nav-link active" data-scroll-target="#summary-statistics-tables"><span class="header-section-number">14.1</span> Summary Statistics Tables</a></li>
  <li><a href="#randomization-removes-incoming-paths-for-treatment" id="toc-randomization-removes-incoming-paths-for-treatment" class="nav-link" data-scroll-target="#randomization-removes-incoming-paths-for-treatment"><span class="header-section-number">14.2</span> Randomization Removes Incoming Paths for Treatment</a></li>
  <li>
<a href="#causal-chains" id="toc-causal-chains" class="nav-link" data-scroll-target="#causal-chains"><span class="header-section-number">14.3</span> Causal Chains</a>
  <ul class="collapse">
<li><a href="#post-treatment-bias" id="toc-post-treatment-bias" class="nav-link" data-scroll-target="#post-treatment-bias"><span class="header-section-number">14.3.1</span> Post-Treatment Bias</a></li>
  </ul>
</li>
  <li>
<a href="#causal-mediation" id="toc-causal-mediation" class="nav-link" data-scroll-target="#causal-mediation"><span class="header-section-number">14.4</span> Causal Mediation</a>
  <ul class="collapse">
<li><a href="#using-brms" id="toc-using-brms" class="nav-link" data-scroll-target="#using-brms"><span class="header-section-number">14.4.1</span> Using <code>brms</code></a></li>
  <li><a href="#using-stan" id="toc-using-stan" class="nav-link" data-scroll-target="#using-stan"><span class="header-section-number">14.4.2</span> Using Stan</a></li>
  <li><a href="#direct-and-indirect-effects" id="toc-direct-and-indirect-effects" class="nav-link" data-scroll-target="#direct-and-indirect-effects"><span class="header-section-number">14.4.3</span> Direct and Indirect Effects</a></li>
  <li><a href="#controlled-direct-effect-cde" id="toc-controlled-direct-effect-cde" class="nav-link" data-scroll-target="#controlled-direct-effect-cde"><span class="header-section-number">14.4.4</span> Controlled direct effect (CDE)</a></li>
  <li><a href="#natural-direct-effect-nde" id="toc-natural-direct-effect-nde" class="nav-link" data-scroll-target="#natural-direct-effect-nde"><span class="header-section-number">14.4.5</span> Natural direct effect (NDE)</a></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis"><span class="header-section-number">14.4.6</span> Sensitivity analysis</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-causal-inference.html">Week 9</a></li><li class="breadcrumb-item"><a href="./08b-mediation.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>We’ll use the <code>framing</code> data set from the <code>mediation</code> package, so you’ll need to have the package installed first. The data were analyzed in a <a href="https://doi.org/10.1111/j.1540-5907.2008.00353.x">report in the American Journal of Political Science</a>. The study examined whether “news about the costs of immigration boosts white opposition” (p.&nbsp;959).</p>
<section id="summary-statistics-tables" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="summary-statistics-tables">
<span class="header-section-number">14.1</span> Summary Statistics Tables</h2>
<p>I’ll take a quick detour to introduce you to some useful functions for tabulating your data. The functions will be from the <code>modelsummary</code> package.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">framing</span>, package <span class="op">=</span> <span class="st">"mediation"</span><span class="op">)</span></span>
<span><span class="co"># Subtract the `emo` variable by 3 so that it starts from 0-9</span></span>
<span><span class="va">framing</span><span class="op">$</span><span class="va">emo</span> <span class="op">&lt;-</span> <span class="va">framing</span><span class="op">$</span><span class="va">emo</span> <span class="op">-</span> <span class="fl">3</span></span>
<span><span class="co"># Quick summary of selected variables</span></span>
<span><span class="fu">datasummary_skim</span><span class="op">(</span><span class="va">framing</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique (#)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47.8</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">18.0</td>
<td style="text-align: right;">47.0</td>
<td style="text-align: right;">85.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="-0.21" y="10.25" width="3.32" height="1.41" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="3.10" y="8.85" width="3.32" height="2.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.42" y="4.39" width="3.32" height="7.27" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.74" y="6.27" width="3.32" height="5.40" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.05" y="6.97" width="3.32" height="4.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.37" y="3.22" width="3.32" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.69" y="6.50" width="3.32" height="5.16" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="23.00" y="5.80" width="3.32" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="26.32" y="6.03" width="3.32" height="5.63" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="29.64" y="5.80" width="3.32" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.96" y="6.97" width="3.32" height="4.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.27" y="8.85" width="3.32" height="2.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="39.59" y="11.19" width="3.32" height="0.47" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.91" y="10.02" width="3.32" height="1.64" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10.8</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">19.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="-0.69" y="10.47" width="4.94" height="1.19" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.25" y="10.21" width="4.94" height="1.45" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="9.16" width="4.94" height="2.51" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="14.12" y="7.97" width="4.94" height="3.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.06" y="6.25" width="4.94" height="5.41" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="3.22" width="4.94" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.94" y="5.46" width="4.94" height="6.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="33.88" y="7.57" width="4.94" height="4.09" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="10.08" width="4.94" height="1.58" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="43.75" y="11.27" width="4.94" height="0.40" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="odd">
<td style="text-align: left;">emo</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.94" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.72" y="6.42" width="4.94" height="5.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="11.65" y="7.44" width="4.94" height="4.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="6.42" width="4.94" height="5.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="21.53" y="7.88" width="4.94" height="3.79" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="26.47" y="8.46" width="4.94" height="3.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="8.60" width="4.94" height="3.06" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.35" y="9.48" width="4.94" height="2.18" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.28" y="8.46" width="4.94" height="3.20" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="even">
<td style="text-align: left;">p_harm</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="10.71" width="3.70" height="0.95" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="5.48" y="9.16" width="3.70" height="2.50" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="12.89" y="6.90" width="3.70" height="4.76" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="20.30" y="8.09" width="3.70" height="3.57" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.70" y="4.29" width="3.70" height="7.37" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="35.11" y="7.74" width="3.70" height="3.92" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.52" y="3.22" width="3.70" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="odd">
<td style="text-align: left;">tone</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.53" width="4.44" height="8.13" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="even">
<td style="text-align: left;">eth</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.53" width="4.44" height="8.13" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treat</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="8.75" width="4.44" height="2.91" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="even">
<td style="text-align: left;">immigr</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="10.18" width="7.41" height="1.49" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="6.74" width="7.41" height="4.93" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="11.66" width="7.41" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="5.80" width="7.41" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="11.66" width="7.41" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="3.22" width="7.41" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="odd">
<td style="text-align: left;">anti_info</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="10.62" width="4.44" height="1.04" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
<tr class="even">
<td style="text-align: left;">cong_mesg</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)"></g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="7.46" width="4.44" height="4.20" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg></td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Summary by treatment condition (`tone`)</span></span>
<span><span class="fu">datasummary_balance</span><span class="op">(</span><span class="op">~</span> <span class="va">tone</span>, data <span class="op">=</span> <span class="va">framing</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
0
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
1
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: right; empty-cells: hide; border-bottom: hidden;"></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Dev.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Dev.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diff. in Means</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">48.4</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">47.1</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">-1.3</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">10.6</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">-0.4</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">emo</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">p_harm</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eth</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">treat</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">immigr</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">anti_info</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left; box-shadow: 0px 1.5px;">cong_mesg</td>
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.3</td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.5</td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.4</td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.5</td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.0</td>
<td style="text-align: right; box-shadow: 0px 1.5px;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">N</td>
<td style="text-align: right;">Pct.</td>
<td style="text-align: right;">N</td>
<td style="text-align: right;">Pct.</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">cond</td>
<td style="text-align: left;">not asked</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">refused</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">control</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">50.4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">49.6</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">51.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">48.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">anx</td>
<td style="text-align: left;">not asked</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">refused</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">very anxious</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">26.2</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">somewhat anxious</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">a little anxious</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">23.8</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">31.9</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">not anxious at all</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13.1</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">20.7</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">educ</td>
<td style="text-align: left;">not asked</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">refused</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">less than high school</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">high school</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">32.6</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">some college</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">23.8</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">28.9</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">bachelor's degree or higher</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">34.6</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: left;">not asked</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">refused</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">49.2</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">45.9</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">50.8</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">54.1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">english</td>
<td style="text-align: left;">Strongly Favor</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Favor</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">11.5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Oppose</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Strongly Oppose</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">53.8</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># More tailor-made table with selected variables by treatment condition</span></span>
<span><span class="fu">datasummary</span><span class="op">(</span><span class="va">emo</span> <span class="op">+</span> <span class="va">p_harm</span> <span class="op">+</span> <span class="va">cong_mesg</span> <span class="op">~</span> <span class="fu">Factor</span><span class="op">(</span><span class="va">tone</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">Mean</span> <span class="op">+</span> <span class="va">SD</span> <span class="op">+</span> <span class="va">Histogram</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">framing</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
0
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
1
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Histogram</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">emo</td>
<td style="text-align: right;">3.39</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">▇▅▇▆▆▃▃▂▂▂</td>
<td style="text-align: right;">4.53</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">▆▄▆▅▇▇▅▆▄▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">p_harm</td>
<td style="text-align: right;">5.53</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">▁▃▅▄▇▂▆</td>
<td style="text-align: right;">6.23</td>
<td style="text-align: right;">1.69</td>
<td style="text-align: right;">▁▃▂▅▄▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cong_mesg</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">▇▃</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">▇▄</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Correlation table</span></span>
<span><span class="va">framing</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">tone</span>, <span class="va">emo</span>, <span class="va">cong_mesg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">datasummary_correlation</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tone</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cong_mesg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">tone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">.</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="even">
<td style="text-align: left;">emo</td>
<td style="text-align: right;">.21</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cong_mesg</td>
<td style="text-align: right;">.05</td>
<td style="text-align: right;">.37</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="randomization-removes-incoming-paths-for-treatment" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="randomization-removes-incoming-paths-for-treatment">
<span class="header-section-number">14.2</span> Randomization Removes Incoming Paths for Treatment</h2>
<p>Let’s consider a DAG without randomization, for the following two variables:</p>
<ul>
<li>X: Exposure to a negatively framed news story about immigrants</li>
<li>Y: Anti-immigration political action</li>
</ul>
<p>There are many possible confounders when we observe these two variables in data (e.g., an individual’s political affiliation and the state in which a person resides). We can represent these unobserved confounders as U, so the DAG will be something like</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag2</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      X -&gt; Y; U -&gt; X; U -&gt; Y</span></span>
<span><span class="st">      U [unobserved]</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, U <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, U <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dag2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08b-mediation_files/figure-html/fig-dag2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.1: DAG with an unobserved confounder
</figcaption></figure>
</div>
</div>
</div>
<p>The magic of randomization—randomly assigning individuals to a manipulated level of X—is that it blocks the path U → X. Therefore, with randomization, the reason a person sees a negatively-framed news story about immigrants is not related to reasons that the person may have intentions for anti-immigration actions. The DAG becomes</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag3</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      X -&gt; Y; U -&gt; Y</span></span>
<span><span class="st">      U [unobserved]</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, U <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, U <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dag3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08b-mediation_files/figure-html/fig-dag3-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.2: DAG with randomization
</figcaption></figure>
</div>
</div>
</div>
<p>Therefore, when randomization is successful, the path coefficient of X → Y is the causal effect of X on Y. However, randomized experiments do not always rule out all confounding. For example, suppose participants are randomly assigned to different experimental conditions, but those who disagree with the presented news story drop out. In that case, such attrition can induce a non-zero correlation between X and Y in the remaining sample.</p>
</section><section id="causal-chains" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="causal-chains">
<span class="header-section-number">14.3</span> Causal Chains</h2>
<section id="post-treatment-bias" class="level3" data-number="14.3.1"><h3 data-number="14.3.1" class="anchored" data-anchor-id="post-treatment-bias">
<span class="header-section-number">14.3.1</span> Post-Treatment Bias</h3>
<p>Here are some key variables from the <code>framing</code> data set:</p>
<ul>
<li>
<code>cong_mesg</code>: binary variable indicating whether or not the participant agreed to send a letter about immigration policy to his or her member of Congress</li>
<li>
<code>emo</code>: posttest anxiety about increased immigration (0-9)</li>
<li>
<code>tone</code>: framing of news story (0 = positive, 1 = negative)</li>
</ul>
<p>We can compare the results of two models:</p>
<ol type="1">
<li>
<code>tone</code> → <code>cong_mesg</code>
</li>
<li>
<code>tone</code> → <code>cong_mesg</code>, adjusting for <code>emo</code>
</li>
</ol>
<p>Which model gives us the causal effect estimate for <code>tone</code>? Let’s run the two models.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_no_adjust</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">cong_mesg</span> <span class="op">~</span> <span class="va">tone</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">framing</span>,</span>
<span>                   family <span class="op">=</span> <span class="fu">bernoulli</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>                   file <span class="op">=</span> <span class="st">"08b_m_no_adjust"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.1 seconds.
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rstan</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: StanHeaders</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
rstan version 2.32.5 (Stan version 2.32.2)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>For execution on a local, multicore CPU with excess RAM we recommend calling
options(mc.cores = parallel::detectCores()).
To avoid recompilation of unchanged Stan programs, we recommend calling
rstan_options(auto_write = TRUE)
For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,
change `threads_per_chain` option:
rstan_options(threads_per_chain = 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rstan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_adjust</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">cong_mesg</span> <span class="op">~</span> <span class="va">tone</span> <span class="op">+</span> <span class="va">emo</span>,</span>
<span>                data <span class="op">=</span> <span class="va">framing</span>,</span>
<span>                family <span class="op">=</span> <span class="fu">bernoulli</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>                file <span class="op">=</span> <span class="st">"08b_m_adjust"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.1 seconds.
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.5 seconds.</code></pre>
</div>
</div>
<p>We can combine the results in a table:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">msummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>`No adjustment` <span class="op">=</span> <span class="va">m_no_adjust</span>,</span>
<span>              `Adjusting for feeling` <span class="op">=</span> <span class="va">m_adjust</span><span class="op">)</span>,</span>
<span>         estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>         statistic <span class="op">=</span> <span class="cn">NULL</span>, fmt <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 
`modelsummary` uses the `performance` package to extract goodness-of-fit
statistics from models of this class. You can specify the statistics you wish
to compute by supplying a `metrics` argument to `modelsummary`, which will then
push it forward to `performance`. Acceptable values are: "all", "common",
"none", or a character vector of metrics names. For example: `modelsummary(mod,
metrics = c("RMSE", "R2")` Note that some metrics are computationally
expensive. See `?performance::performance` for details.
 This warning appears once per session.</code></pre>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">No adjustment</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Adjusting for feeling</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: center;">−0.81 [−1.19, −0.46]</td>
<td style="text-align: center;">−2.00 [−2.63, −1.44]</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_tone</td>
<td style="text-align: center;">0.21 [−0.28, 0.71]</td>
<td style="text-align: center;">−0.13 [−0.71, 0.43]</td>
</tr>
<tr class="odd">
<td style="text-align: left; box-shadow: 0px 1.5px;">b_emo</td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">0.32 [0.21, 0.43]</td>
</tr>
<tr class="even">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">265</td>
<td style="text-align: center;">265</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.003</td>
<td style="text-align: center;">0.142</td>
</tr>
<tr class="even">
<td style="text-align: left;">ELPD</td>
<td style="text-align: center;">−170.1</td>
<td style="text-align: center;">−152.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ELPD s.e.</td>
<td style="text-align: center;">5.5</td>
<td style="text-align: center;">7.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">LOOIC</td>
<td style="text-align: center;">340.2</td>
<td style="text-align: center;">305.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LOOIC s.e.</td>
<td style="text-align: center;">11.0</td>
<td style="text-align: center;">14.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">WAIC</td>
<td style="text-align: center;">340.2</td>
<td style="text-align: center;">305.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">0.47</td>
<td style="text-align: center;">0.44</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can see that the Bayes estimate of the coefficient for <code>tone</code> was positive without <code>emo</code>, but was negative with <code>emo</code>. Which one should we believe? The information criteria (LOOIC and WAIC) suggested that the model with <code>emo</code> was better for prediction, but just because something helps predict the outcome does not make it a causal variable. To repeat,</p>
<blockquote class="blockquote">
<p>Coefficients in a predictive model are not causal effects.</p>
</blockquote>
<p>And to emphasize again,</p>
<blockquote class="blockquote">
<p>Causal inference requires causal assumptions, and these assumptions are not in the data.</p>
</blockquote>
<p>So instead, we need a DAG. Given that we know <code>emo</code> is measured <strong>after</strong> the intervention, it seems reasonable to think that a negatively framed story about immigrants would elicit some negative emotions about increased immigration, and that emotion may prompt people to take anti-immigrant actions. Therefore, we have the following DAG:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag5</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      T -&gt; C; T -&gt; E; E -&gt; C</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag5</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="fl">0</span>, E <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="fl">0</span>, E <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-dag5" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dag5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14.1: DAG for a mediation model with emotion as a mediator.
</figcaption><div aria-describedby="tbl-dag5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08b-mediation_files/figure-html/tbl-dag5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>This is an example of a pipe/chain. It is a causal chain going from T(one) → E(motion) → C(ongress message). If we are interested in the causal effect of T, we should not condition on E; conditioning on E would mean comparing those who saw the negatively-framed story and <em>those who saw the positively-framed story but had the same negative emotion towards immigrants.</em> In other words, adjusting for E would mean taking out part of the effect of T on C through E.</p>
<p>As another example, think about a drug that is supposed to lower the risk of a heart attack. Imagine someone conducting a study comparing drug/no drug conditions on their probability of getting heart attacks. Should we adjust for participants’ blood pressure after the intervention? If we want to know the drug’s effect, and that the drug works by lowering blood pressure, we should not adjust for posttest blood pressure. Otherwise, we would be asking the question: Does the drug help prevent heart attacks through something other than lowering one’s blood pressure?</p>
<p>The latter question can be answered in mediation analysis.</p>
</section></section><section id="causal-mediation" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="causal-mediation">
<span class="header-section-number">14.4</span> Causal Mediation</h2>
<p>In the DAG above, E is a post-treatment variable potentially influenced by T, which we call a <strong>mediator</strong>. Mediator is an important topic in causal inference, as it informs the mechanism of how a variable has a causal effect on an outcome.</p>
<p>One thing to be careful of is that, statistically speaking, a mediator behaves very much like a confounder, and their difference is based on causal assumptions.</p>
<p>Let’s analyze the mediation model in Figure X. There are two variables that are on the receiving end of some causal effects: <code>emo</code> and <code>cong_mesg</code>. Whereas the generalized linear model handles one outcome, with <code>brms</code>, we can have a system of equations—one for each outcome—estimated simultaneously, as shown in the code below.</p>
<section id="using-brms" class="level3" data-number="14.4.1"><h3 data-number="14.4.1" class="anchored" data-anchor-id="using-brms">
<span class="header-section-number">14.4.1</span> Using <code>brms</code>
</h3>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_med</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>    <span class="co"># Two equations for two outcomes</span></span>
<span>    <span class="fu">bf</span><span class="op">(</span><span class="va">cong_mesg</span> <span class="op">~</span> <span class="va">tone</span> <span class="op">+</span> <span class="va">emo</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">bf</span><span class="op">(</span><span class="va">emo</span> <span class="op">~</span> <span class="va">tone</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">set_rescor</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="co"># A list of two family arguments for two outcomes</span></span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">bernoulli</span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="st">"identity"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">framing</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, resp <span class="op">=</span> <span class="st">"emo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span>, resp <span class="op">=</span> <span class="st">"emo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">2.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, resp <span class="op">=</span> <span class="st">"congmesg"</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1338</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"08b_m_med"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.1 seconds.
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
</div>
</section><section id="using-stan" class="level3" data-number="14.4.2"><h3 data-number="14.4.2" class="anchored" data-anchor-id="using-stan">
<span class="header-section-number">14.4.2</span> Using Stan</h3>
<p>Here’s some Stan code for running the same mediation model</p>
<div class="cell" data-output.var="med_mod">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N0;  <span class="co">// number of observations (control)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N1;  <span class="co">// number of observations (treatment)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">array</span>[N0] <span class="dt">int</span> y0; <span class="co">// outcome (control);</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">array</span>[N1] <span class="dt">int</span> y1; <span class="co">// outcome (treatment);</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N0] m0;    <span class="co">// mediator (control);</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N1] m1;    <span class="co">// mediator (treatment);</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> alpham;  <span class="co">// regression intercept for M</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> alphay;  <span class="co">// regression intercept for M</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta1;   <span class="co">// X -&gt; M</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta2;   <span class="co">// X -&gt; Y</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta3;   <span class="co">// M -&gt; Y</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigmam;  <span class="co">// SD of prediction error for M</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// model</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    m0 ~ normal(alpham, sigmam);</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    m1 ~ normal(alpham + beta1, sigmam);</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    y0 ~ bernoulli_logit(alphay + beta3 * m0);</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    y1 ~ bernoulli_logit(alphay + beta2 + beta3 * m1);</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// prior</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    alpham ~ normal(<span class="fl">4.5</span>, <span class="fl">4.5</span>);</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    alphay ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    beta1 ~ std_normal();</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    beta2 ~ std_normal();</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    beta3 ~ std_normal();</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    sigmam ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">med_mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"stan_code/mediation_logit_normal.stan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1. Form the data list for Stan</span></span>
<span><span class="va">stan_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span></span>
<span>    <span class="va">framing</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        N0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        N1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        m0 <span class="op">=</span> <span class="va">emo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        m1 <span class="op">=</span> <span class="va">emo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        y0 <span class="op">=</span> <span class="va">cong_mesg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        y1 <span class="op">=</span> <span class="va">cong_mesg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># 2. Run Stan</span></span>
<span><span class="va">m_med_stan</span> <span class="op">&lt;-</span> <span class="va">med_mod</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stan_dat</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1338</span>,</span>
<span>    refresh <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="direct-and-indirect-effects" class="level3" data-number="14.4.3"><h3 data-number="14.4.3" class="anchored" data-anchor-id="direct-and-indirect-effects">
<span class="header-section-number">14.4.3</span> Direct and Indirect Effects</h3>
<p>In a mediation model, the effect of X on Y has two mechanisms: - Indirect effect: X causes Y because X causes M, and M causes Y - Direct effect: X causes Y without involving M</p>
<p>More specifically, the direct effect is the change in Y for one unit change in X, <em>holding M constant</em>. In our example, it means comparing subsets of the treatment and the control groups, under the condition that both subsets have the same level of negative emotion about increased immigration. The indirect effect takes more effort to understand: it is the change in Y for the control group (or the treatment group) if their mediator value is set to the same level as the treatment group. In our example, it would mean comparing the control group and the <em>counterfactual</em> where the control group had their negative emotion changed to the same level as the treatment group.</p>
<p>The <em>causal mediation</em> literature has more distinctions on the different types of direct and indirect effects. Below, I give codes for obtaining these effects without going into detail.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section><section id="controlled-direct-effect-cde" class="level3" data-number="14.4.4"><h3 data-number="14.4.4" class="anchored" data-anchor-id="controlled-direct-effect-cde">
<span class="header-section-number">14.4.4</span> Controlled direct effect (CDE)</h3>
<p>CDE is the direct effect when the mediator is set to a specific level. Below is the CDE for <code>emo</code> = 0 and <code>emo</code> = 9, respectively.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cond_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>tone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                      emo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">9</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cond_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">bind_cols</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">m_med</span>, newdata <span class="op">=</span> <span class="va">cond_df</span><span class="op">)</span><span class="op">[</span> , , <span class="st">"congmesg"</span><span class="op">]</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-cde" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14.2: Estimated direct effect of <code>tone</code> on <code>cong_mesg</code> at two different levels of <code>emo</code>.
</figcaption><div aria-describedby="tbl-cde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">tone</th>
<th style="text-align: right;">emo</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Est.Error</th>
<th style="text-align: right;">Q2.5</th>
<th style="text-align: right;">Q97.5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1212844</td>
<td style="text-align: right;">0.0320367</td>
<td style="text-align: right;">0.0662354</td>
<td style="text-align: right;">0.1907005</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1084567</td>
<td style="text-align: right;">0.0330696</td>
<td style="text-align: right;">0.0538386</td>
<td style="text-align: right;">0.1830547</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.6982051</td>
<td style="text-align: right;">0.0698306</td>
<td style="text-align: right;">0.5559154</td>
<td style="text-align: right;">0.8234034</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.6702609</td>
<td style="text-align: right;">0.0631406</td>
<td style="text-align: right;">0.5418592</td>
<td style="text-align: right;">0.7855347</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="natural-direct-effect-nde" class="level3" data-number="14.4.5"><h3 data-number="14.4.5" class="anchored" data-anchor-id="natural-direct-effect-nde">
<span class="header-section-number">14.4.5</span> Natural direct effect (NDE)</h3>
<p>The “natural” effects are quantities for some kind of population averages. NDE is the direct effect when the mediator is held constant at the level of the control group. As a first step, we need to obtain the potential outcome of <code>emo</code> when <code>tone</code> = 0. We call this potential outcome variable <span class="math inline">\(M_0\)</span> (potential outcome of <span class="math inline">\(M\)</span> if <span class="math inline">\(X\)</span> = 0). This has already been observed for the control group but will be a counterfactual for the treatment group.</p>
<p>We will use a general approach by <span class="citation" data-cites="imai2010">Imai et al. (<a href="references.html#ref-imai2010" role="doc-biblioref">2010</a>)</span> to simulate potential outcomes for each observation, before computing NDE (and NIE). For each observation, we will first simulate the potential outcome of <code>emo</code> when <code>tone</code> = 0 (<span class="math inline">\(M_0\)</span>), and then simulate the potential outcome of <code>emo</code> when <code>tone</code> = 1 (<span class="math inline">\(M_1\)</span>).</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulate potential outcomes for mediator when T = 0</span></span>
<span><span class="va">dat0</span> <span class="op">&lt;-</span> <span class="va">m_med</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">dat0</span><span class="op">$</span><span class="va">tone</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co"># Predicted emo when T = 0</span></span>
<span><span class="va">po_m0</span> <span class="op">&lt;-</span> <span class="fu">posterior_predict</span><span class="op">(</span><span class="va">m_med</span>, newdata <span class="op">=</span> <span class="va">dat0</span>, resp <span class="op">=</span> <span class="st">"emo"</span><span class="op">)</span></span>
<span><span class="co"># Simulate potential outcomes for mediator when T = 1</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">m_med</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">dat1</span><span class="op">$</span><span class="va">tone</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Predicted emo when T = 1</span></span>
<span><span class="va">po_m1</span> <span class="op">&lt;-</span> <span class="fu">posterior_predict</span><span class="op">(</span><span class="va">m_med</span>, newdata <span class="op">=</span> <span class="va">dat1</span>, resp <span class="op">=</span> <span class="st">"emo"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we will simulate four potential outcomes for <code>cong_mesg</code> (Y):</p>
<ul>
<li>Y(T = 0, M = <span class="math inline">\(M_0\)</span>)</li>
<li>Y(T = 1, M = <span class="math inline">\(M_0\)</span>)</li>
<li>Y(T = 0, M = <span class="math inline">\(M_1\)</span>)</li>
<li>Y(T = 1, M = <span class="math inline">\(M_1\)</span>)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_med_draws</span> <span class="op">&lt;-</span> <span class="fu">as_draws_df</span><span class="op">(</span><span class="va">m_med</span><span class="op">)</span></span>
<span><span class="co"># Predicted logit of congmesg when T = 0 and emo = po_m0</span></span>
<span><span class="va">po_y0_m0</span> <span class="op">&lt;-</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_Intercept</span> <span class="op">+</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_emo</span> <span class="op">*</span> <span class="va">po_m0</span></span>
<span><span class="co"># Predicted logit of congmesg when T = 1 and emo = po_m0</span></span>
<span><span class="va">po_y1_m0</span> <span class="op">&lt;-</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_Intercept</span> <span class="op">+</span></span>
<span>    <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_tone</span> <span class="op">+</span></span>
<span>    <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_emo</span> <span class="op">*</span> <span class="va">po_m0</span></span>
<span><span class="co"># Predicted logit of congmesg when T = 0 and emo = po_m1</span></span>
<span><span class="va">po_y0_m1</span> <span class="op">&lt;-</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_Intercept</span> <span class="op">+</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_emo</span> <span class="op">*</span> <span class="va">po_m1</span></span>
<span><span class="co"># Predicted logit of congmesg when T = 1 and emo = po_m1</span></span>
<span><span class="va">po_y1_m1</span> <span class="op">&lt;-</span> <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_Intercept</span> <span class="op">+</span></span>
<span>    <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_tone</span> <span class="op">+</span></span>
<span>    <span class="va">m_med_draws</span><span class="op">$</span><span class="va">b_congmesg_emo</span> <span class="op">*</span> <span class="va">po_m1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The NDE is defined as Y(T = 1, M = <span class="math inline">\(M_0\)</span>) - Y(T = 0, M = <span class="math inline">\(M_0\)</span>).</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NDE = Y(1, M(0)) - Y(0, M(0))</span></span>
<span><span class="va">nde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">po_y1_m0</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">po_y0_m0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="natural-indirect-effect-nie" class="level4" data-number="14.4.5.1"><h4 data-number="14.4.5.1" class="anchored" data-anchor-id="natural-indirect-effect-nie">
<span class="header-section-number">14.4.5.1</span> Natural indirect effect (NIE)</h4>
<p>NIE is the difference in the outcome between the actual control group and a counterfactual control group. The counterfactual here is a control group that did not receive the treatment, but had their <code>emo</code> value set to be equal to the treatment group. The NIE is defined as Y(T = 0, M = <span class="math inline">\(M_1\)</span>) - Y(T = 0, M = <span class="math inline">\(M_0\)</span>).</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NIE = Y(0, M(1)) - Y(0, M(0))</span></span>
<span><span class="va">nie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">po_y0_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">po_y0_m0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">draws_nde_nie</span> <span class="op">&lt;-</span> <span class="fu">as_draws</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>NDE <span class="op">=</span> <span class="va">nde</span>, NIE <span class="op">=</span> <span class="va">nie</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html">summarise_draws</a></span><span class="op">(</span><span class="va">draws_nde_nie</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-nde-nie" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-nde-nie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14.3: Estimated natural direct and indirect effects for the control group.
</figcaption><div aria-describedby="tbl-nde-nie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["q5"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["q95"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["ess_tail"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"NDE","2":"-0.02460334","3":"-0.02481711","4":"0.05180202","5":"0.05214507","6":"-0.10949233","7":"0.0614191","8":"1.000891","9":"5119.817","10":"2984.998"},{"1":"NIE","2":"0.06741516","3":"0.06535813","4":"0.02787398","5":"0.02692294","6":"0.02563981","7":"0.1165879","8":"1.001557","9":"3959.789","10":"3149.613"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">draws_nde_nie</span>, bw <span class="op">=</span> <span class="st">"SJ"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nde-nie" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-nde-nie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08b-mediation_files/figure-html/fig-nde-nie-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nde-nie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.3: Estimated natural direct and indirect effects for the control group.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sensitivity-analysis" class="level3" data-number="14.4.6"><h3 data-number="14.4.6" class="anchored" data-anchor-id="sensitivity-analysis">
<span class="header-section-number">14.4.6</span> Sensitivity analysis</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag6</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      T -&gt; C; T -&gt; E; E -&gt; C; U -&gt; E; U -&gt; C</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag6</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="fl">0</span>, E <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">2</span>, U <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="fl">0</span>, E <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">0</span>, U <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag6</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-dag6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08b-mediation_files/figure-html/fig-dag6-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.4: DAG for a mediation model with an unobserved mediator-outcome confounder.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assumptions of Causal Mediation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mediation effects can be estimated properly when the causal diagram and the corresponding model are specified correctly. In our model, we assume</p>
<ul>
<li>No unmeasured treatment-outcome confounding</li>
<li>No unmeasured mediator-outcome confounding</li>
<li>No unmeasured treatment-mediator confounding</li>
<li>The mediator-outcome path is not moderated by the treatment</li>
</ul>
<p>Note that randomization of the treatment does not rule out confounding for the mediator-outcome path.</p>
</div>
</div>
<p>One important assumption in mediation is that there is no unobserved confounding variable between the mediator and the outcome. This assumption requires researchers’ input, as usually we don’t have studies that randomly assign both the treatment variable and the mediator. An additional technique is to ask: what would the effect be if there were unobserved confounding variables of a certain magnitude? With Bayesian, we can represent the strength of the confounding effect by a prior distribution <span class="citation" data-cites="mccandless2019">(see <a href="references.html#ref-mccandless2019" role="doc-biblioref">McCandless &amp; Somers, 2019, p. 10.1177</a>/0962280217729844)</span>. The following shows the mediation estimates assuming the effect of the confounding variable to the mediator is 1, and to the outcome has a prior of N(0.5, 0.2).</p>
<div class="cell" data-output.var="med_mod_sens">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N0;  <span class="co">// number of observations (control)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N1;  <span class="co">// number of observations (treatment)</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">array</span>[N0] <span class="dt">int</span> y0; <span class="co">// outcome (control);</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">array</span>[N1] <span class="dt">int</span> y1; <span class="co">// outcome (treatment);</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N0] m0;    <span class="co">// mediator (control);</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N1] m1;    <span class="co">// mediator (treatment);</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> alpham;  <span class="co">// regression intercept for M</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> alphay;  <span class="co">// regression intercept for M</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta1;   <span class="co">// X -&gt; M</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta2;   <span class="co">// X -&gt; Y</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta3;   <span class="co">// M -&gt; Y</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N0] u0;  <span class="co">// confounding variable</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vector</span>[N1] u1;  <span class="co">// confounding variable</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> beta4;   <span class="co">// U -&gt; Y</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigmam;  <span class="co">// SD of prediction error for M</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// model</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    u0 ~ std_normal();</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    u1 ~ std_normal();</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    m0 ~ normal(alpham + u0, sigmam);</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    m1 ~ normal(alpham + beta1 + u1, sigmam);</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    y0 ~ bernoulli_logit(alphay + beta3 * m0 + beta4 * u0);</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    y1 ~ bernoulli_logit(alphay + beta2 + beta3 * m1 + beta4 * u1);</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// prior</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    alpham ~ normal(<span class="fl">4.5</span>, <span class="fl">4.5</span>);</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    alphay ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    beta1 ~ std_normal();</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    beta2 ~ std_normal();</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    beta3 ~ std_normal();</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    beta4 ~ normal(<span class="fl">0.5</span>, <span class="fl">0.2</span>);</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    sigmam ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">med_mod_sens</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"stan_code/mediation_logit_normal_sensitivity.stan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1. form the data list for Stan</span></span>
<span><span class="va">stan_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span></span>
<span>    <span class="va">framing</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        N0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        N1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        m0 <span class="op">=</span> <span class="va">emo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        m1 <span class="op">=</span> <span class="va">emo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        y0 <span class="op">=</span> <span class="va">cong_mesg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        y1 <span class="op">=</span> <span class="va">cong_mesg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tone</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># 2. Run Stan</span></span>
<span><span class="va">m_med_sens</span> <span class="op">&lt;-</span> <span class="va">med_mod_sens</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stan_dat</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1338</span>,</span>
<span>    refresh <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 1.0 seconds.
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 1.0 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 1.0 seconds.
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 1.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.0 seconds.
Total execution time: 4.4 seconds.</code></pre>
</div>
</div>
<p>beta1 = tone -&gt; emo; beta2 = tone -&gt; cong_mesg; beta3 = emo -&gt; cong_mesg</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_med_sens</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpham"</span>, <span class="st">"alphay"</span>,</span>
<span>      <span class="st">"beta1"</span>, <span class="st">"beta2"</span>, <span class="st">"beta3"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mcmc_intervals</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-med-sens" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-med-sens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08b-mediation_files/figure-html/fig-med-sens-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-med-sens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14.5: Estimated coefficients for the mediation model with the sensitivity analysis.
</figcaption></figure>
</div>
</div>
</div>
<p>As you can see, the prior of the confounding effect attenuates the coefficients from the mediator to the outcome, but the path from the mediator to the outcome remains pretty much above zero.</p>
<p>You may also check out the <a href="https://cran.r-project.org/web/packages/BayesGmed/index.html"><code>BayesGmed</code> package</a>, which is also based on Stan. More descriptions are in the paper <span class="citation" data-cites="yimer2023">Yimer et al. (<a href="references.html#ref-yimer2023" role="doc-biblioref">2023</a>)</span>.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-imai2010" class="csl-entry" role="listitem">
Imai, K., Keele, L., &amp; Tingley, D. (2010). A general approach to causal mediation analysis. <em>Psychological Methods</em>, <em>15</em>(4), 309–334. <a href="https://doi.org/10.1037/a0020761">https://doi.org/10.1037/a0020761</a>
</div>
<div id="ref-mccandless2019" class="csl-entry" role="listitem">
McCandless, L. C., &amp; Somers, J. M. (2019). Bayesian sensitivity analysis for unmeasured confounding in causal mediation analysis. <em>Statistical Methods in Medical Research</em>, <em>28</em>(2), 515–531. <a href="https://doi.org/10.1177/0962280217729844">https://doi.org/10.1177/0962280217729844</a>
</div>
<div id="ref-yimer2023" class="csl-entry" role="listitem">
Yimer, B. B., Lunt, M., Beasley, M., Macfarlane, G. J., &amp; McBeth, J. (2023). BayesGmed: An R-package for Bayesian causal mediation analysis. <em>PLOS ONE</em>, <em>18</em>(6), e0287037. <a href="https://doi.org/10.1371/journal.pone.0287037">https://doi.org/10.1371/journal.pone.0287037</a>
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>You can find more information about causal mediation in this paper: <a href="https://ftp.cs.ucla.edu/pub/stat_ser/r389.pdf" class="uri">https://ftp.cs.ucla.edu/pub/stat_ser/r389.pdf</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-causal-inference.html" class="pagination-link" aria-label="Causal Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-mcmc.html" class="pagination-link" aria-label="Markov Chain Monte Carlo">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mediation</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>comma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">2</span>L) <span class="fu">format</span>(x, <span class="at">digits =</span> digits, <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey92"</span>)))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend =</span> <span class="st">"cmdstanr"</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>We'll use the <span class="in">`framing`</span> data set from the <span class="in">`mediation`</span> package, so you'll need to have the package installed first. The data were analyzed in a <span class="co">[</span><span class="ot">report in the American Journal of Political Science</span><span class="co">](https://doi.org/10.1111/j.1540-5907.2008.00353.x)</span>. The study examined whether "news about the costs of immigration boosts white opposition" (p. 959).</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary Statistics Tables</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>I'll take a quick detour to introduce you to some useful functions for tabulating your data. The functions will be from the <span class="in">`modelsummary`</span> package.</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(framing, <span class="at">package =</span> <span class="st">"mediation"</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Subtract the `emo` variable by 3 so that it starts from 0-9</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>framing<span class="sc">$</span>emo <span class="ot">&lt;-</span> framing<span class="sc">$</span>emo <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick summary of selected variables</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_skim</span>(framing)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary by treatment condition (`tone`)</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_balance</span>(<span class="sc">~</span> tone, <span class="at">data =</span> framing)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="co"># More tailor-made table with selected variables by treatment condition</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary</span>(emo <span class="sc">+</span> p_harm <span class="sc">+</span> cong_mesg <span class="sc">~</span> <span class="fu">Factor</span>(tone) <span class="sc">*</span> (Mean <span class="sc">+</span> SD <span class="sc">+</span> Histogram),</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> framing)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation table</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>framing <span class="sc">|&gt;</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(tone, emo, cong_mesg) <span class="sc">|&gt;</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datasummary_correlation</span>(<span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Randomization Removes Incoming Paths for Treatment</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>Let's consider a DAG without randomization, for the following two variables:</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>X: Exposure to a negatively framed news story about immigrants</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Y: Anti-immigration political action</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>There are many possible confounders when we observe these two variables in data (e.g., an individual's political affiliation and the state in which a person resides). We can represent these unobserved confounders as U, so the DAG will be something like</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dag2</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "DAG with an unobserved confounder"</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>dag2 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dag{</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="st">      X -&gt; Y; U -&gt; X; U -&gt; Y</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="st">      U [unobserved]</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag2) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">U =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">2</span>),</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">U =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">0</span>))</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag2) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>The magic of randomization---randomly assigning individuals to a manipulated level of X---is that it blocks the path U <span class="dv">&amp;rarr;</span> X. Therefore, with randomization, the reason a person sees a negatively-framed news story about immigrants is not related to reasons that the person may have intentions for anti-immigration actions. The DAG becomes</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dag3</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "DAG with randomization"</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>dag3 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dag{</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="st">      X -&gt; Y; U -&gt; Y</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="st">      U [unobserved]</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag3) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">U =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">2</span>),</span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">U =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">0</span>))</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag3) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>Therefore, when randomization is successful, the path coefficient of X <span class="dv">&amp;rarr;</span> Y is the causal effect of X on Y. However, randomized experiments do not always rule out all confounding. For example, suppose participants are randomly assigned to different experimental conditions, but those who disagree with the presented news story drop out. In that case, such attrition can induce a non-zero correlation between X and Y in the remaining sample.</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## Causal Chains</span></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### Post-Treatment Bias</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>Here are some key variables from the <span class="in">`framing`</span> data set:</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`cong_mesg`</span>: binary variable indicating whether or not the participant agreed to send a letter about immigration policy to his or her member of Congress</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`emo`</span>: posttest anxiety about increased immigration (0-9)</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`tone`</span>: framing of news story (0 = positive, 1 = negative)</span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>We can compare the results of two models:</span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`tone`</span> <span class="dv">&amp;rarr;</span> <span class="in">`cong_mesg`</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`tone`</span> <span class="dv">&amp;rarr;</span> <span class="in">`cong_mesg`</span>, adjusting for <span class="in">`emo`</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>Which model gives us the causal effect estimate for <span class="in">`tone`</span>? Let's run the two models.</span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>m_no_adjust <span class="ot">&lt;-</span> <span class="fu">brm</span>(cong_mesg <span class="sc">~</span> tone,</span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> framing,</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>                   <span class="at">file =</span> <span class="st">"08b_m_no_adjust"</span>)</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a>m_adjust <span class="ot">&lt;-</span> <span class="fu">brm</span>(cong_mesg <span class="sc">~</span> tone <span class="sc">+</span> emo,</span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> framing,</span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">"08b_m_adjust"</span>)</span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a>We can combine the results in a table:</span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="st">`</span><span class="at">No adjustment</span><span class="st">`</span> <span class="ot">=</span> m_no_adjust,</span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Adjusting for feeling</span><span class="st">`</span> <span class="ot">=</span> m_adjust),</span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="cn">NULL</span>, <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a>We can see that the Bayes estimate of the coefficient for <span class="in">`tone`</span> was positive without <span class="in">`emo`</span>, but was negative with <span class="in">`emo`</span>. Which one should we believe? The information criteria (LOOIC and WAIC) suggested that the model with <span class="in">`emo`</span> was better for prediction, but just because something helps predict the outcome does not make it a causal variable. To repeat,</span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Coefficients in a predictive model are not causal effects.</span></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a>And to emphasize again,</span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Causal inference requires causal assumptions, and these assumptions are not in the data.</span></span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a>So instead, we need a DAG. Given that we know <span class="in">`emo`</span> is measured **after** the intervention, it seems reasonable to think that a negatively framed story about immigrants would elicit some negative emotions about increased immigration, and that emotion may prompt people to take anti-immigrant actions. Therefore, we have the following DAG:</span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-dag5</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "DAG for a mediation model with emotion as a mediator."</span></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a>dag5 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dag{</span></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="st">      T -&gt; C; T -&gt; E; E -&gt; C</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag5) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">T =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">1</span>, <span class="at">C =</span> <span class="dv">2</span>),</span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">T =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">1</span>, <span class="at">C =</span> <span class="dv">0</span>))</span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag5) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a>This is an example of a pipe/chain. It is a causal chain going from T(one) <span class="dv">&amp;rarr;</span> E(motion) <span class="dv">&amp;rarr;</span> C(ongress message). If we are interested in the causal effect of T, we should not condition on E; conditioning on E would mean comparing those who saw the negatively-framed story and *those who saw the positively-framed story but had the same negative emotion towards immigrants.* In other words, adjusting for E would mean taking out part of the effect of T on C through E. </span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a>As another example, think about a drug that is supposed to lower the risk of a heart attack. Imagine someone conducting a study comparing drug/no drug conditions on their probability of getting heart attacks. Should we adjust for participants' blood pressure after the intervention? If we want to know the drug's effect, and that the drug works by lowering blood pressure, we should not adjust for posttest blood pressure. Otherwise, we would be asking the question: Does the drug help prevent heart attacks through something other than lowering one's blood pressure?</span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a>The latter question can be answered in mediation analysis.</span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## Causal Mediation</span></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a>In the DAG above, E is a post-treatment variable potentially influenced by T, which we call a **mediator**. Mediator is an important topic in causal inference, as it informs the mechanism of how a variable has a causal effect on an outcome. </span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a>One thing to be careful of is that, statistically speaking, a mediator behaves very much like a confounder, and their difference is based on causal assumptions.</span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>Let's analyze the mediation model in Figure X. There are two variables that are on the receiving end of some causal effects: <span class="in">`emo`</span> and <span class="in">`cong_mesg`</span>. Whereas the generalized linear model handles one outcome, with <span class="in">`brms`</span>, we can have a system of equations---one for each outcome---estimated simultaneously, as shown in the code below. </span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using `brms`</span></span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a>m_med <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Two equations for two outcomes</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bf</span>(cong_mesg <span class="sc">~</span> tone <span class="sc">+</span> emo) <span class="sc">+</span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bf</span>(emo <span class="sc">~</span> tone) <span class="sc">+</span></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A list of two family arguments for two outcomes</span></span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">bernoulli</span>(<span class="st">"logit"</span>), <span class="fu">gaussian</span>(<span class="st">"identity"</span>)),</span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> framing,</span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">resp =</span> <span class="st">"emo"</span>) <span class="sc">+</span></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> <span class="st">"sigma"</span>, <span class="at">resp =</span> <span class="st">"emo"</span>) <span class="sc">+</span></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">resp =</span> <span class="st">"congmesg"</span>),</span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1338</span>,</span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"08b_m_med"</span></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using Stan</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a>Here's some Stan code for running the same mediation model</span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan}</span></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a><span class="in">#| output.var: med_mod</span></span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a><span class="in">#| file: "stan_code/mediation_logit_normal.stan"</span></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a>med_mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"stan_code/mediation_logit_normal.stan"</span>)</span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Form the data list for Stan</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a>stan_dat <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a>    framing,</span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">N0 =</span> <span class="fu">sum</span>(tone <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a>        <span class="at">N1 =</span> <span class="fu">sum</span>(tone <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>        <span class="at">m0 =</span> emo[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">0</span>)],</span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a>        <span class="at">m1 =</span> emo[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">1</span>)],</span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a>        <span class="at">y0 =</span> cong_mesg[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">0</span>)],</span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">y1 =</span> cong_mesg[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Run Stan</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a>m_med_stan <span class="ot">&lt;-</span> med_mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> stan_dat,</span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1338</span>,</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### Direct and Indirect Effects</span></span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a>In a mediation model, the effect of X on Y has two mechanisms: </span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Indirect effect: X causes Y because X causes M, and M causes Y</span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Direct effect: X causes Y without involving M</span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a>More specifically, the direct effect is the change in Y for one unit change in X, *holding M constant*. In our example, it means comparing subsets of the treatment and the control groups, under the condition that both subsets have the same level of negative emotion about increased immigration. The indirect effect takes more effort to understand: it is the change in Y for the control group (or the treatment group) if their mediator value is set to the same level as the treatment group. In our example, it would mean comparing the control group and the *counterfactual* where the control group had their negative emotion changed to the same level as the treatment group.</span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a>The *causal mediation* literature has more distinctions on the different types of direct and indirect effects. Below, I give codes for obtaining these effects without going into detail.<span class="ot">[^causal-mediate]</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="ot">[^causal-mediate]: </span>You can find more information about causal mediation in this paper: <span class="ot">&lt;https://ftp.cs.ucla.edu/pub/stat_ser/r389.pdf&gt;</span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### Controlled direct effect (CDE)</span></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>CDE is the direct effect when the mediator is set to a specific level. Below is the CDE for <span class="in">`emo`</span> = 0 and <span class="in">`emo`</span> = 9, respectively.</span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-cde</span></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimated direct effect of `tone` on `cong_mesg` at two different levels of `emo`."</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a>cond_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tone =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a>                      <span class="at">emo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">9</span>))</span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>cond_df <span class="sc">|&gt;</span></span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(</span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fitted</span>(m_med, <span class="at">newdata =</span> cond_df)[ , , <span class="st">"congmesg"</span>]</span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="fu">### Natural direct effect (NDE)</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a>The "natural" effects are quantities for some kind of population averages. NDE is the direct effect when the mediator is held constant at the level of the control group. As a first step, we need to obtain the potential outcome of <span class="in">`emo`</span> when <span class="in">`tone`</span> = 0. We call this potential outcome variable $M_0$ (potential outcome of $M$ if $X$ = 0). This has already been observed for the control group but will be a counterfactual for the treatment group.</span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a>We will use a general approach by @imai2010 to simulate potential outcomes for each observation, before computing NDE (and NIE). For each observation, we will first simulate the potential outcome of <span class="in">`emo`</span> when <span class="in">`tone`</span> = 0 ($M_0$), and then simulate the potential outcome of <span class="in">`emo`</span> when <span class="in">`tone`</span> = 1 ($M_1$).</span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate potential outcomes for mediator when T = 0</span></span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> m_med<span class="sc">$</span>data</span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>dat0<span class="sc">$</span>tone <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted emo when T = 0</span></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a>po_m0 <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(m_med, <span class="at">newdata =</span> dat0, <span class="at">resp =</span> <span class="st">"emo"</span>)</span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate potential outcomes for mediator when T = 1</span></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> m_med<span class="sc">$</span>data</span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a>dat1<span class="sc">$</span>tone <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted emo when T = 1</span></span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a>po_m1 <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(m_med, <span class="at">newdata =</span> dat1, <span class="at">resp =</span> <span class="st">"emo"</span>)</span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a>Next, we will simulate four potential outcomes for <span class="in">`cong_mesg`</span> (Y):</span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Y(T = 0, M = $M_0$)</span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Y(T = 1, M = $M_0$)</span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Y(T = 0, M = $M_1$)</span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Y(T = 1, M = $M_1$)</span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>m_med_draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(m_med)</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted logit of congmesg when T = 0 and emo = po_m0</span></span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>po_y0_m0 <span class="ot">&lt;-</span> m_med_draws<span class="sc">$</span>b_congmesg_Intercept <span class="sc">+</span> m_med_draws<span class="sc">$</span>b_congmesg_emo <span class="sc">*</span> po_m0</span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted logit of congmesg when T = 1 and emo = po_m0</span></span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a>po_y1_m0 <span class="ot">&lt;-</span> m_med_draws<span class="sc">$</span>b_congmesg_Intercept <span class="sc">+</span></span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a>    m_med_draws<span class="sc">$</span>b_congmesg_tone <span class="sc">+</span></span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a>    m_med_draws<span class="sc">$</span>b_congmesg_emo <span class="sc">*</span> po_m0</span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted logit of congmesg when T = 0 and emo = po_m1</span></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a>po_y0_m1 <span class="ot">&lt;-</span> m_med_draws<span class="sc">$</span>b_congmesg_Intercept <span class="sc">+</span> m_med_draws<span class="sc">$</span>b_congmesg_emo <span class="sc">*</span> po_m1</span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted logit of congmesg when T = 1 and emo = po_m1</span></span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a>po_y1_m1 <span class="ot">&lt;-</span> m_med_draws<span class="sc">$</span>b_congmesg_Intercept <span class="sc">+</span></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a>    m_med_draws<span class="sc">$</span>b_congmesg_tone <span class="sc">+</span></span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a>    m_med_draws<span class="sc">$</span>b_congmesg_emo <span class="sc">*</span> po_m1</span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>The NDE is defined as Y(T = 1, M = $M_0$) - Y(T = 0, M = $M_0$). </span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a><span class="co"># NDE = Y(1, M(0)) - Y(0, M(0))</span></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>nde <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">plogis</span>(po_y1_m0)) <span class="sc">-</span> <span class="fu">rowMeans</span>(<span class="fu">plogis</span>(po_y0_m0))</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Natural indirect effect (NIE)</span></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>NIE is the difference in the outcome between the actual control group and a counterfactual control group. The counterfactual here is a control group that did not receive the treatment, but had their <span class="in">`emo`</span> value set to be equal to the treatment group. The NIE is defined as Y(T = 0, M = $M_1$) - Y(T = 0, M = $M_0$).</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a><span class="co"># NIE = Y(0, M(1)) - Y(0, M(0))</span></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a>nie <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">plogis</span>(po_y0_m1)) <span class="sc">-</span> <span class="fu">rowMeans</span>(<span class="fu">plogis</span>(po_y0_m0))</span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-nde-nie</span></span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimated natural direct and indirect effects for the control group."</span></span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a>draws_nde_nie <span class="ot">&lt;-</span> <span class="fu">as_draws</span>(<span class="fu">list</span>(<span class="at">NDE =</span> nde, <span class="at">NIE =</span> nie))</span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">::</span><span class="fu">summarise_draws</span>(draws_nde_nie)</span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nde-nie</span></span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated natural direct and indirect effects for the control group."</span></span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(draws_nde_nie, <span class="at">bw =</span> <span class="st">"SJ"</span>)</span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sensitivity analysis</span></span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dag6}</span></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag6</span></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "DAG for a mediation model with an unobserved mediator-outcome confounder."</span></span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a><span class="in">dag6 &lt;- dagitty(</span></span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a><span class="in">    "dag{</span></span>
<span id="cb41-361"><a href="#cb41-361" aria-hidden="true" tabindex="-1"></a><span class="in">      T -&gt; C; T -&gt; E; E -&gt; C; U -&gt; E; U -&gt; C</span></span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a><span class="in">    }"</span></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a><span class="in">coordinates(dag6) &lt;- list(x = c(T = 0, E = 1, C = 2, U = 2),</span></span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a><span class="in">                          y = c(T = 0, E = 1, C = 0, U = 1))</span></span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a><span class="in">ggdag(dag6) + theme_dag()</span></span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assumptions of Causal Mediation</span></span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a>Mediation effects can be estimated properly when the causal diagram and the corresponding model are specified correctly. In our model, we assume</span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No unmeasured treatment-outcome confounding</span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No unmeasured mediator-outcome confounding</span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No unmeasured treatment-mediator confounding</span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The mediator-outcome path is not moderated by the treatment</span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a>Note that randomization of the treatment does not rule out confounding for the mediator-outcome path.</span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a>One important assumption in mediation is that there is no unobserved confounding variable between the mediator and the outcome. This assumption requires researchers' input, as usually we don't have studies that randomly assign both the treatment variable and the mediator. An additional technique is to ask: what would the effect be if there were unobserved confounding variables of a certain magnitude? With Bayesian, we can represent the strength of the confounding effect by a prior distribution <span class="co">[</span><span class="ot">see @mccandless2019, 10.1177/0962280217729844</span><span class="co">]</span>. The following shows the mediation estimates assuming the effect of the confounding variable to the mediator is 1, and to the outcome has a prior of N(0.5, 0.2).</span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan}</span></span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a><span class="in">#| output.var: med_mod_sens</span></span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a><span class="in">#| file: "stan_code/mediation_logit_normal_sensitivity.stan"</span></span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a>med_mod_sens <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"stan_code/mediation_logit_normal_sensitivity.stan"</span>)</span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. form the data list for Stan</span></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a>stan_dat <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a>    framing,</span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a>        <span class="at">N0 =</span> <span class="fu">sum</span>(tone <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a>        <span class="at">N1 =</span> <span class="fu">sum</span>(tone <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a>        <span class="at">m0 =</span> emo[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">0</span>)],</span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a>        <span class="at">m1 =</span> emo[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">1</span>)],</span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a>        <span class="at">y0 =</span> cong_mesg[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">0</span>)],</span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a>        <span class="at">y1 =</span> cong_mesg[<span class="fu">which</span>(tone <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Run Stan</span></span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a>m_med_sens <span class="ot">&lt;-</span> med_mod_sens<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> stan_dat,</span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1338</span>,</span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a>beta1 = tone -&gt; emo; beta2 = tone -&gt; cong_mesg; beta3 = emo -&gt; cong_mesg</span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-med-sens</span></span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated coefficients for the mediation model with the sensitivity analysis."</span></span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a>m_med_sens<span class="sc">$</span><span class="fu">draws</span>(</span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"alpham"</span>, <span class="st">"alphay"</span>,</span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a>      <span class="st">"beta1"</span>, <span class="st">"beta2"</span>, <span class="st">"beta3"</span>)</span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mcmc_intervals</span>()</span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a>As you can see, the prior of the confounding effect attenuates the coefficients from the mediator to the outcome, but the path from the mediator to the outcome remains pretty much above zero.</span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a>You may also check out the <span class="co">[</span><span class="ot">`BayesGmed` package</span><span class="co">](https://cran.r-project.org/web/packages/BayesGmed/index.html)</span>, which is also based on Stan. More descriptions are in the paper @yimer2023.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Hok Chio (Mark) Lai</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>13&nbsp; Causal Inference – PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08b-mediation.html" rel="next">
<link href="./07b-stacking-and-regularization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-225295148', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../modules.html"> 
<span class="menu-text">Modules</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../docs/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../exercises/index.html"> 
<span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../syllabus/index.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/marklhc/usc-psyc573-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./PSYC-573-Bayesian-Data-Analysis--2024-Fall---Course-Notes.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-causal-inference.html">Week 9</a></li><li class="breadcrumb-item"><a href="./08-causal-inference.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bayes-theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayes’s Theorem</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-beta-bernoulli-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04b-beta-bernoulli-stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model With Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04c-poisson-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Poisson Model</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-hierarchical-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5–6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06b-multiple-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06c-regression-diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-stacking-and-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stacking, Regularization, and Variable Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-causal-inference.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08b-mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#potential-outcomes" id="toc-potential-outcomes" class="nav-link active" data-scroll-target="#potential-outcomes"><span class="header-section-number">13.1</span> Potential Outcomes</a></li>
  <li>
<a href="#directed-acyclic-graph-dag" id="toc-directed-acyclic-graph-dag" class="nav-link" data-scroll-target="#directed-acyclic-graph-dag"><span class="header-section-number">13.2</span> Directed Acyclic Graph (DAG)</a>
  <ul class="collapse">
<li><a href="#assumptions-in-a-dag" id="toc-assumptions-in-a-dag" class="nav-link" data-scroll-target="#assumptions-in-a-dag"><span class="header-section-number">13.2.1</span> Assumptions in a DAG</a></li>
  <li><a href="#basic-types-of-junctions" id="toc-basic-types-of-junctions" class="nav-link" data-scroll-target="#basic-types-of-junctions"><span class="header-section-number">13.2.2</span> Basic Types of Junctions</a></li>
  </ul>
</li>
  <li><a href="#the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data" id="toc-the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data" class="nav-link" data-scroll-target="#the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data"><span class="header-section-number">13.3</span> The Back-Door Criterion: Estimating Causal Effect in Nonexperimental Data</a></li>
  <li>
<a href="#using-multiple-regression-model" id="toc-using-multiple-regression-model" class="nav-link" data-scroll-target="#using-multiple-regression-model"><span class="header-section-number">13.4</span> Using Multiple Regression Model</a>
  <ul class="collapse">
<li><a href="#table" id="toc-table" class="nav-link" data-scroll-target="#table"><span class="header-section-number">13.4.1</span> Table</a></li>
  <li><a href="#posterior-predictive-checks" id="toc-posterior-predictive-checks" class="nav-link" data-scroll-target="#posterior-predictive-checks"><span class="header-section-number">13.4.2</span> Posterior predictive checks</a></li>
  </ul>
</li>
  <li><a href="#predicting-an-intervention" id="toc-predicting-an-intervention" class="nav-link" data-scroll-target="#predicting-an-intervention"><span class="header-section-number">13.5</span> Predicting an Intervention</a></li>
  <li><a href="#collider" id="toc-collider" class="nav-link" data-scroll-target="#collider"><span class="header-section-number">13.6</span> Collider</a></li>
  <li><a href="#some-additional-references" id="toc-some-additional-references" class="nav-link" data-scroll-target="#some-additional-references"><span class="header-section-number">13.7</span> Some Additional References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-causal-inference.html">Week 9</a></li><li class="breadcrumb-item"><a href="./08-causal-inference.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Causal inference is an important topic in statistics, but it also has a complicated history with statistics. Early-day statisticians saw causality as a taboo such that researchers were discouraged from drawing any causal conclusions in nonexperimental research. In the past few decades, much progress has been made on causal inference in epidemiology, computer science, and statistics, with several frameworks proposed and many tools developed for experimental and nonexperimental data.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> This note will introduce the causal diagram framework for encoding causal assumptions, which can be used to guide analysis for drawing causal conclusions. The goal is to give you some basic ideas so that you can learn more from other sources, such as the book <a href="http://bayes.cs.ucla.edu/BOOK-2K/"><em>Causality</em> by Pearl</a> and the book <a href="https://doi.org/10.1017/CBO9781139025751"><em>Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction</em> by Imbens and Rubin</a>.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Two prominent frameworks for causal inference are</p>
<ol type="1">
<li>Structural causal model, which uses tools such as DAGs and <span class="math inline">\(d\)</span>-separation, is thoroughly described in the book <a href="http://bayes.cs.ucla.edu/BOOK-2K/"><em>Causality</em> by Pearl</a>, and</li>
<li>Potential outcome model, which is thoroughly described in the book <a href="https://doi.org/10.1017/CBO9781139025751"><em>Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction</em> by Imbens and Rubin</a>.</li>
</ol>
</div>
</div>
</div>
<p>In this note, we will draw on both frameworks.</p>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Causal Inference?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Causal inference is the process of determining the causal effect of one variable on another, based on data and causal assumptions. Two common ways of interpreting a causal effect are (a) <em>intervention</em>: how <span class="math inline">\(Y\)</span> will change if <span class="math inline">\(X\)</span> is manipulated to be <span class="math inline">\(x\)</span>; (b) <em>counterfactual</em>: what would <span class="math inline">\(Y\)</span> be if <span class="math inline">\(X\)</span> were set to <span class="math inline">\(x\)</span>.</p>
</div>
</div>
<section id="potential-outcomes" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="potential-outcomes">
<span class="header-section-number">13.1</span> Potential Outcomes</h2>
<p>Consider a binary treatment variable. For each individual, there are two <em>potential outcomes</em>: one if they receive the treatment (T = 1) and one if they do not (T = 0). Here is a hypothetical data set of a new drug for improving statistics knowledge, with the treatment condition receiving the drug and the control condition receiving a placebo:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">po_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    person <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    attitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">80</span>, <span class="fl">70</span>, <span class="fl">90</span>, <span class="fl">85</span>, <span class="fl">82</span>, <span class="fl">95</span>, <span class="fl">78</span><span class="op">)</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fl">88</span>, <span class="fl">75</span>, <span class="fl">92</span>, <span class="fl">82</span>, <span class="fl">85</span>, <span class="fl">90</span>, <span class="fl">78</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">po_dat</span>,</span>
<span>    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Person"</span>, <span class="st">"Math Attitude"</span>, <span class="st">"Y (if T = 1)"</span>, <span class="st">"Y (if T = 0)"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Person</th>
<th style="text-align: right;">Math Attitude</th>
<th style="text-align: right;">Y (if T = 1)</th>
<th style="text-align: right;">Y (if T = 0)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">88</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">75</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">92</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">85</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">90</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">78</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If one could observe the two potential outcomes for each person (which is impossible in the real world), one could compute the treatment effect for each person:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">te</span> <span class="op">&lt;-</span> <span class="va">po_dat</span><span class="op">$</span><span class="va">treat</span> <span class="op">-</span> <span class="va">po_dat</span><span class="op">$</span><span class="va">control</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5 -8 -5 -2  3 -3  5  0</code></pre>
</div>
</div>
<p>and the <strong>average treatment effect (ATE)</strong> (here we just compute it on the sample, so the sample ATE):</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">te</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.625</code></pre>
</div>
</div>
<p>However, in practice, we can only observe one of the two potential outcomes. For example, if persons 2, 4, 6, 7 are in the treatment condition, we have</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">po_dat</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">po_dat</span><span class="op">$</span><span class="va">person</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">po_dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">po_dat</span><span class="op">$</span><span class="va">t</span>, <span class="va">po_dat</span><span class="op">$</span><span class="va">treat</span>, <span class="va">po_dat</span><span class="op">$</span><span class="va">control</span><span class="op">)</span></span>
<span><span class="va">po_dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treatment"</span>, <span class="st">"Observed Y"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Treatment</th>
<th style="text-align: right;">Observed Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">75</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">90</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">95</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">78</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>and the naive comparison of those in the treatment condition and those in the control condition will have a mean difference of</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">po_dat</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">po_dat</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">po_dat</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">po_dat</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.5</code></pre>
</div>
</div>
<p>which gives a misleading estimate of the ATE.</p>
</section><section id="directed-acyclic-graph-dag" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="directed-acyclic-graph-dag">
<span class="header-section-number">13.2</span> Directed Acyclic Graph (DAG)</h2>
<p>DAG is a tool for encoding causal assumptions. It contains nodes and paths. A node is usually a variable that can be measured in the data or unmeasured. Generally, paths in a DAG are directional (as implied by <em>directed</em>), which indicates the directions of causal relations. Acyclic means the causal chain does not close in a loop.</p>
<p>We will use an example described in <span class="citation" data-cites="mcelreath2020">McElreath (<a href="references.html#ref-mcelreath2020" role="doc-biblioref">2020</a>)</span>, chapter 5, about data from 50 U.S. states from the 2009 American Community Survey (ACS), which we have already seen in <a href="06b-multiple-predictors.html" class="quarto-xref"><span>Chapter 9</span></a> and <a href="06b-multiple-predictors.html#fig-waffle-divorce" class="quarto-xref">Figure&nbsp;<span>9.1</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">waffle_divorce</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span>  <span class="co"># read delimited files</span></span>
<span>    <span class="st">"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/WaffleDivorce.csv"</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">";"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 50 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr  (2): Location, Loc
dbl (11): Population, MedianAgeMarriage, Marriage, Marriage SE, Divorce, Div...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Rescale Marriage and Divorce by dividing by 10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Marriage</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Marriage</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Divorce</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Divorce</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">MedianAgeMarriage</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">MedianAgeMarriage</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="co"># See data description at https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The outcome of interest is the divorce rate. Remember the plot shows how marriage rate is related to divorce rate at the state level. It looks like marriage rate can predict divorce rate. A causal interpretation would be a stronger assertion, such that we expect a higher divorce rate if policymakers encourage more people to get married. In order to make a causal claim, we need to remove potential confounders.</p>
<p>A potential confounder is when people get married. Suppose people are forced to get married later in life. In that case, fewer people in the population will be married, and people may have less time, opportunity, and motivation to get divorced (as it may be harder to find a new partner). Therefore, we can use the following DAG:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag1</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span><span class="st">"dag{ A -&gt; D; A -&gt; M; M -&gt; D }"</span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">0</span>, A <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">0</span>, A <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dag1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-dag1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.1: DAG for the relationship between marriage rate (M) and divorce rate (D) example, with median age of marriage (A) as a potential confounder.
</figcaption></figure>
</div>
</div>
</div>
<p>We can look at how the median age people get married in different states relates to the divorce rate:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">waffle_divorce</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">MedianAgeMarriage</span>, y <span class="op">=</span> <span class="va">Divorce</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Median age marriage (10 years)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Divorce rate (per 10 adults)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">Loc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-scatter-age-divorce" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-scatter-age-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-scatter-age-divorce-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scatter-age-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.2: Scatter plot of divorce rate (y) vs median age of marriage (x).
</figcaption></figure>
</div>
</div>
</div>
<section id="assumptions-in-a-dag" class="level3" data-number="13.2.1"><h3 data-number="13.2.1" class="anchored" data-anchor-id="assumptions-in-a-dag">
<span class="header-section-number">13.2.1</span> Assumptions in a DAG</h3>
<p>In a graphical model, there are usually two kinds of assumptions conveyed. Perhaps counterintuitively, the weaker assumptions are the ones you can see, whereas the stronger assumptions are ones you <strong>do not see</strong>.</p>
<p>For example, a weak assumption is:</p>
<ul>
<li>Marriage age <em>may</em> directly influence the number of people who are married</li>
</ul>
<p>On the other hand, examples of a strong assumption are:</p>
<ul>
<li>Marriage rate does not directly influence the age people get married</li>
<li>there is no other variable in the causal pathway M → D</li>
</ul>
<p>The last assumption will not hold if there is a common cause of M and D other than A.</p>
</section><section id="basic-types-of-junctions" class="level3" data-number="13.2.2"><h3 data-number="13.2.2" class="anchored" data-anchor-id="basic-types-of-junctions">
<span class="header-section-number">13.2.2</span> Basic Types of Junctions</h3>
<ul>
<li>Fork: A ← B → C
<ul>
<li>A and C are correlated due to a common cause B</li>
</ul>
</li>
<li>Chain/Pipe: A → B → C
<ul>
<li>B is on the causal pathway of A to C</li>
</ul>
</li>
<li>Collider: A → B ← C
<ul>
<li>B is a <em>descendant</em> of both A and C</li>
</ul>
</li>
</ul>
<p>Going back to our example, there is a fork relation: M → <span style="color:red">A</span> → D. In this case, A is a confounder when estimating the causal relation between M and D. In this case, the causal effect of M to D can be obtained by adjusting for A, which means looking at the subsets of data where A is constant. In regression, adjustment is obtained by including both M and A as predictors of D.</p>
</section></section><section id="the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data">
<span class="header-section-number">13.3</span> The Back-Door Criterion: Estimating Causal Effect in Nonexperimental Data</h2>
<p>Randomization is one—but not the only—way to rule out confounding variables. Much progress has been made in clarifying that causal effects <strong>can</strong> be estimated in nonexperimental data. After all, researchers have not randomly assigned individuals to smoke <span class="math inline">\(x\)</span> cigarettes per day, but we are confident that smoking causes cancer; we never manipulated the moon’s gravitational force, but we are pretty sure that the moon is a cause of high and low tides.</p>
<p>In a DAG, the back-door criterion can be used to identify variables that we should adjust for to obtain a causal effect. The set of variables to be adjusted should (a) blocks every path between X and Y that contains an arrow entering X and (b) does not contain variables that are descendant of X.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag4</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      X -&gt; Y; W1 -&gt; X; U -&gt; W2; W2 -&gt; X; W1 -&gt; Y; U -&gt; Y</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">latents</span><span class="op">(</span><span class="va">dag4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"U"</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, W1 <span class="op">=</span> <span class="fl">0.66</span>, U <span class="op">=</span> <span class="fl">1.32</span>, W2 <span class="op">=</span> <span class="fl">0.66</span>, Y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, W1 <span class="op">=</span> <span class="fl">1</span>, U <span class="op">=</span> <span class="fl">1</span>, W2 <span class="op">=</span> <span class="fl">0.5</span>, Y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag4</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dag4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-dag4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.3: DAG for a hypothetical model with two measured and one unobserved confounder.
</figcaption></figure>
</div>
</div>
</div>
<p>We can use a function in the <code>daggity</code> package to identify the set of variables that satisfy the back-door criterion. In this case, we say that X and Y are <span class="math inline">\(d\)</span>-separated by this set of adjusted variables:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">adjustmentSets</span><span class="op">(</span><span class="va">dag4</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>               effect <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ W1, W2 }</code></pre>
</div>
</div>
</section><section id="using-multiple-regression-model" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="using-multiple-regression-model">
<span class="header-section-number">13.4</span> Using Multiple Regression Model</h2>
<p><span class="math display">\[
  \begin{aligned}
    D_i &amp; \sim N(\mu_i, \sigma)  \\
    \mu_i &amp; = \beta_0 + \beta_1 A_i + \beta_2 M_i \\
    \beta_0 &amp; \sim N(0, 1) \\
    \beta_1 &amp; \sim N(0, 1) \\
    \beta_2 &amp; \sim N(0, 1) \\
  \end{aligned}
\]</span></p>
<p>Assuming a correctly specified DAG, all all assumptions of a linear model are met, <span class="math inline">\(\beta_2\)</span> is the causal effect of M on D. Here is the <code class="sourceCode r">brms</code> code:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">MedianAgeMarriage</span> <span class="op">+</span> <span class="va">Marriage</span>,</span>
<span>          data <span class="op">=</span> <span class="va">waffle_divorce</span>,</span>
<span>          prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">std_normal</span><span class="op">(</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>          seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>          file <span class="op">=</span> <span class="st">"08_m1"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="table" class="level3" data-number="13.4.1"><h3 data-number="13.4.1" class="anchored" data-anchor-id="table">
<span class="header-section-number">13.4.1</span> Table</h3>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">msummary</span><span class="op">(</span><span class="va">m1</span>,</span>
<span>         estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>         statistic <span class="op">=</span> <span class="cn">NULL</span>, fmt <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 
`modelsummary` uses the `performance` package to extract goodness-of-fit
statistics from models of this class. You can specify the statistics you wish
to compute by supplying a `metrics` argument to `modelsummary`, which will then
push it forward to `performance`. Acceptable values are: "all", "common",
"none", or a character vector of metrics names. For example: `modelsummary(mod,
metrics = c("RMSE", "R2")` Note that some metrics are computationally
expensive. See `?performance::performance` for details.
 This warning appears once per session.</code></pre>
</div>
<div id="tbl-m1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.1: Model results for the divorce rate example.
</figcaption><div aria-describedby="tbl-m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_7mjhlynzbvxedbj33ixh(i, j, css_id) {
        var table = document.getElementById("tinytable_7mjhlynzbvxedbj33ixh");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_7mjhlynzbvxedbj33ixh');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_7mjhlynzbvxedbj33ixh(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_7mjhlynzbvxedbj33ixh");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(0, 0, 'tinytable_css_idx1lcva0wl8syvcynsbjj') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(0, 1, 'tinytable_css_id575bgairailpq0qz9wi5') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(1, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(1, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(2, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(2, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(3, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(3, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(4, 0, 'tinytable_css_idsbh7gohx3onk5xw8lmii') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(4, 1, 'tinytable_css_idnpqqy4xvw9w4ageltn1c') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(5, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(5, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(6, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(6, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(7, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(7, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(8, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(8, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(9, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(9, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(10, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(10, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(11, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(11, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(12, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(12, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(13, 0, 'tinytable_css_id9k82uay42g4u44kc84wa') })
window.addEventListener('load', function () { styleCell_7mjhlynzbvxedbj33ixh(13, 1, 'tinytable_css_idd4tmyt93bvyy8jzcvws9') })
    </script><style>
    .table td.tinytable_css_idx1lcva0wl8syvcynsbjj, .table th.tinytable_css_idx1lcva0wl8syvcynsbjj {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id575bgairailpq0qz9wi5, .table th.tinytable_css_id575bgairailpq0qz9wi5 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id9k82uay42g4u44kc84wa, .table th.tinytable_css_id9k82uay42g4u44kc84wa {  text-align: left; }
    .table td.tinytable_css_idd4tmyt93bvyy8jzcvws9, .table th.tinytable_css_idd4tmyt93bvyy8jzcvws9 {  text-align: center; }
    .table td.tinytable_css_idsbh7gohx3onk5xw8lmii, .table th.tinytable_css_idsbh7gohx3onk5xw8lmii {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idnpqqy4xvw9w4ageltn1c, .table th.tinytable_css_idnpqqy4xvw9w4ageltn1c {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_7mjhlynzbvxedbj33ixh" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr></thead>
<tbody>
<tr>
<td>b_Intercept        </td>
                  <td>3.49 [1.98, 5.02]   </td>
                </tr>
<tr>
<td>b_MedianAgeMarriage</td>
                  <td>-0.93 [-1.43, -0.45]</td>
                </tr>
<tr>
<td>b_Marriage         </td>
                  <td>-0.04 [-0.20, 0.12] </td>
                </tr>
<tr>
<td>sigma              </td>
                  <td>0.15 [0.12, 0.19]   </td>
                </tr>
<tr>
<td>Num.Obs.           </td>
                  <td>50                  </td>
                </tr>
<tr>
<td>R2                 </td>
                  <td>0.349               </td>
                </tr>
<tr>
<td>R2 Adj.            </td>
                  <td>0.284               </td>
                </tr>
<tr>
<td>ELPD               </td>
                  <td>21.0                </td>
                </tr>
<tr>
<td>ELPD s.e.          </td>
                  <td>6.4                 </td>
                </tr>
<tr>
<td>LOOIC              </td>
                  <td>-42.0               </td>
                </tr>
<tr>
<td>LOOIC s.e.         </td>
                  <td>12.9                </td>
                </tr>
<tr>
<td>WAIC               </td>
                  <td>-42.2               </td>
                </tr>
<tr>
<td>RMSE               </td>
                  <td>0.14                </td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>As shown in the table, when holding constant the median marriage age of states, marriage rate has only a small effect on divorce rate.</p>
</section><section id="posterior-predictive-checks" class="level3" data-number="13.4.2"><h3 data-number="13.4.2" class="anchored" data-anchor-id="posterior-predictive-checks">
<span class="header-section-number">13.4.2</span> Posterior predictive checks</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m1</span>, ndraws <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># density</span></span>
<span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m1</span>, type <span class="op">=</span> <span class="st">"intervals"</span>, x <span class="op">=</span> <span class="st">"Marriage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marriage"</span>, y <span class="op">=</span> <span class="st">"Divorce"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'intervals' by default.</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m1</span>, type <span class="op">=</span> <span class="st">"intervals"</span>, x <span class="op">=</span> <span class="st">"MedianAgeMarriage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"MedianAgeMarriage"</span>, y <span class="op">=</span> <span class="st">"Divorce"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'intervals' by default.</code></pre>
</div>
<div id="fig-m1-pp-check" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-m1-pp-check-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-m1-pp-check" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-m1-pp-check-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-m1-pp-check-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-m1-pp-check-1.png" class="img-fluid figure-img" data-ref-parent="fig-m1-pp-check" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-m1-pp-check-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Posterior predictive density of divorce rate.
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-m1-pp-check" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-m1-pp-check-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-m1-pp-check-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-m1-pp-check-2.png" class="img-fluid figure-img" data-ref-parent="fig-m1-pp-check" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-m1-pp-check-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Posterior predictive intervals of marriage rate predicting divorce rate.
</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-m1-pp-check" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-m1-pp-check-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-m1-pp-check-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-m1-pp-check-3.png" class="img-fluid figure-img" data-ref-parent="fig-m1-pp-check" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-m1-pp-check-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Posterior predictive intervals of median marriage age predicting marriage rate.
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-m1-pp-check-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.4: Posterior predictive checks for the multiple regression model.
</figcaption></figure>
</div>
<p>The model does not fit every state (e.g., UT, ME, ID).</p>
</section></section><section id="predicting-an-intervention" class="level2" data-number="13.5"><h2 data-number="13.5" class="anchored" data-anchor-id="predicting-an-intervention">
<span class="header-section-number">13.5</span> Predicting an Intervention</h2>
<p>If the causal assumption in our DAG is reasonable, we have obtained an estimate of the causal effect of marriage rate on divorce rate at the state level. This allows us to answer questions like</p>
<blockquote class="blockquote">
<p>What would happen to the divorce rate if we encouraged more people to get married (so the marriage rate would increase by 10 percentage points)?</p>
</blockquote>
<p>We can use the Bayesian model, which is generative, to make such predictions. Consider a state with a marriage rate of 2 (per 10 adults). The predicted divorce rate is</p>
<p><span class="math display">\[
\beta_0 + \beta_1 A + \beta_2 (2)
\]</span></p>
<p>Consider an intervention that increases the marriage rate from 2 to 3. The predicted divorce rate will be</p>
<p><span class="math display">\[
\beta_0 + \beta_1 A + \beta_2 (3)
\]</span></p>
<p>The change in divorce rate is</p>
<p><span class="math display">\[
\beta_0 + \beta_1 A + \beta_2 (3) - \beta_0 + \beta_1 A + \beta_2 (2) = \beta_2
\]</span></p>
<p>Here is what the model would predict in terms of the change in the divorce rate (holding median marriage age to 25 years old), using R:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Marriage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    MedianAgeMarriage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_df</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">m1</span>, newdata <span class="op">=</span> <span class="va">pred_df</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Marriage</th>
<th style="text-align: right;">MedianAgeMarriage</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Est.Error</th>
<th style="text-align: right;">Q2.5</th>
<th style="text-align: right;">Q97.5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">1.068</td>
<td style="text-align: right;">0.035</td>
<td style="text-align: right;">1.002</td>
<td style="text-align: right;">1.138</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">1.026</td>
<td style="text-align: right;">0.067</td>
<td style="text-align: right;">0.894</td>
<td style="text-align: right;">1.160</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The difference should be just the estimate of <span class="math inline">\(\beta_2\)</span>, which has the following posterior distribution:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mcmc_dens</span><span class="op">(</span><span class="va">m1</span>, pars <span class="op">=</span> <span class="st">"b_Marriage"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-marriage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-marriage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-marriage-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marriage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.5: Estimated “causal” effect of marriage rate on divorce rate, based on the specified DAG and a linear model.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="collider" class="level2" data-number="13.6"><h2 data-number="13.6" class="anchored" data-anchor-id="collider">
<span class="header-section-number">13.6</span> Collider</h2>
<p>A collider is a descendant of two parent nodes. When one holds the collider constant, it induces a spurious association between the parents. This leads to many unexpected results in data analysis and daily life. For example, consider people who are nice and who are good-looking. Is there an association between a person being nice and a person being good-looking? Maybe. But this association can be induced when we condition on a collider. Let’s say a friend of yours only dates people who are either nice or good-looking. So we have this colliding relation:</p>
<p>Nice → Dating ← Good looking</p>
<p>Suppose you look at just the people that your friend dated. In that case, they are either nice or good-looking, but the fact that you select to look at (condition on) only the people that your friend dated would automatically eliminate people who are neither nice nor good-looking. This induces a spurious negative association between nice and good-looking, so your friend may believe that nice people would be less likely to have appearances that fit their taste, and vice versa.</p>
<p>As another example, is research that is newsworthy less trustworthy? There could be a negative association due to collider bias, because people who select research to be reported, funded, or published, consider both newsworthiness and trustworthiness. Assume that trustworthiness has no causal relation with newsworthiness, below shows what happens when we only focus on papers that are either high on newsworthiness or trustworthiness:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2221</span><span class="op">)</span> <span class="co"># different seed from the text</span></span>
<span><span class="va">num_proposals</span> <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of grant proposals</span></span>
<span><span class="va">prop_selected</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># proportion to select</span></span>
<span><span class="co"># Simulate independent newsworthiness and trustworthiness</span></span>
<span><span class="va">plot_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    nw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">num_proposals</span><span class="op">)</span>,</span>
<span>    tw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">num_proposals</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plot_dat</span> <span class="op">&lt;-</span> <span class="va">plot_dat</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>total <span class="op">=</span> <span class="va">nw</span> <span class="op">+</span> <span class="va">tw</span><span class="op">)</span></span>
<span><span class="va">sel_dat</span> <span class="op">&lt;-</span> <span class="va">plot_dat</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># select top 10% of combined scores</span></span>
<span>    <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">total</span>, prop <span class="op">=</span> <span class="va">prop_selected</span><span class="op">)</span></span>
<span><span class="va">plot_dat</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">nw</span>, y <span class="op">=</span> <span class="va">tw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sel_dat</span>, shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sel_dat</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"newsworthiness"</span>, y <span class="op">=</span> <span class="st">"trustworthiness"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-sim-news" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-sim-news-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-sim-news-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sim-news-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.6: Simulation of newsworthiness and trustworthiness.
</figcaption></figure>
</div>
</div>
</div>
<p>As you can see, a negative correlation happens. This is collider bias: spurious correlation due to conditioning on the common descendant. This also goes by the name <a href="https://brilliant.org/wiki/berksons-paradox/">Berkson’s Paradox</a>.</p>
<p>In the DAG below, X and Y have no causal association. Conditioning on S, however, induces a negative correlation between X and Y. With the DAG below,</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Generally speaking, do not condition on a collider, unless you’re going to de-confound the spurious association using other variables.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag7</span> <span class="op">&lt;-</span> <span class="fu">dagitty</span><span class="op">(</span></span>
<span>    <span class="st">"dag{</span></span>
<span><span class="st">      X -&gt; Y; X -&gt; S; Y -&gt; S</span></span>
<span><span class="st">    }"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">dag7</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, S <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span>, S <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">dag7</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-dag7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dag7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-dag7-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.7: DAG with collider bias.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Age and Happiness, conditioned on Marital Status (Example from text)
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this example, we assume that age and happiness are not related, but as people age, they are more likely to get married.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Code adapted from the rethinking package (https://github.com/rmcelreath/rethinking/blob/master/R/sim_happiness.R)</span></span>
<span><span class="va">sim_happiness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">seed</span> <span class="op">=</span> <span class="fl">1977</span>, <span class="va">N_years</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                          <span class="va">max_age</span> <span class="op">=</span> <span class="fl">65</span>, <span class="va">N_births</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                          <span class="va">aom</span> <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>    <span class="va">H</span> <span class="op">&lt;-</span> <span class="va">M</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">N_years</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># age existing individuals</span></span>
<span>        <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N_births</span><span class="op">)</span><span class="op">)</span> <span class="co"># newborns</span></span>
<span>        <span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">H</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">N_births</span><span class="op">)</span><span class="op">)</span> <span class="co"># sim happiness trait - never changes</span></span>
<span>        <span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">M</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N_births</span><span class="op">)</span><span class="op">)</span> <span class="co"># not yet married</span></span>
<span>        <span class="co"># for each person over 17, chance get married</span></span>
<span>        <span class="va">M</span><span class="op">[</span><span class="va">A</span> <span class="op">&gt;=</span> <span class="va">aom</span> <span class="op">&amp;</span> <span class="va">M</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="va">A</span> <span class="op">&gt;=</span> <span class="va">aom</span> <span class="op">&amp;</span> <span class="va">M</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">H</span><span class="op">[</span><span class="va">A</span> <span class="op">&gt;=</span> <span class="va">aom</span> <span class="op">&amp;</span> <span class="va">M</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">-</span> <span class="fl">7.9</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># mortality</span></span>
<span>        <span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">A</span> <span class="op">&gt;</span> <span class="va">max_age</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op">[</span><span class="op">-</span><span class="va">deaths</span><span class="op">]</span></span>
<span>            <span class="va">H</span> <span class="op">&lt;-</span> <span class="va">H</span><span class="op">[</span><span class="op">-</span><span class="va">deaths</span><span class="op">]</span></span>
<span>            <span class="va">M</span> <span class="op">&lt;-</span> <span class="va">M</span><span class="op">[</span><span class="op">-</span><span class="va">deaths</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">A</span>, married <span class="op">=</span> <span class="va">M</span>, happiness <span class="op">=</span> <span class="va">H</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">sim_happiness</span><span class="op">(</span><span class="fl">2024</span>, N_years <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dd</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">happiness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span>, size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-age-happiness" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-age-happiness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-age-happiness-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-happiness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.8: Age and happiness.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dd</span><span class="op">[</span><span class="va">dd</span><span class="op">$</span><span class="va">married</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">happiness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-age-happiness-married" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-age-happiness-married-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-causal-inference_files/figure-html/fig-age-happiness-married-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-age-happiness-married-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.9: Age and happiness, conditioned on married couples.
</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<p>Some other collider examples:</p>
<ul>
<li>impulsivity → high-risk youth ← delinquency</li>
<li>healthcare worker → COVID-19 testing ← COVID-19 severity</li>
<li>standardized test → admission ← research skills</li>
<li>maternal smoking → birth weight → birth defect ← mortality</li>
</ul></section><section id="some-additional-references" class="level2" data-number="13.7"><h2 data-number="13.7" class="anchored" data-anchor-id="some-additional-references">
<span class="header-section-number">13.7</span> Some Additional References</h2>
<ul>
<li>https://doi.org/10.1177/25152459221095823</li>
<li>https://doi.org/10.1038/s41562-024-01939-z</li>
</ul>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-mcelreath2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: a Bayesian course with examples in R and Stan</em> (Second edition). CRC Press.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>See this paper: <a href="https://doi.org/10.1177/1745691620921521" class="uri">https://doi.org/10.1177/1745691620921521</a> for an argument of how the taboo against causal inference has impeded the progress of psychology research.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./07b-stacking-and-regularization.html" class="pagination-link" aria-label="Stacking, Regularization, and Variable Selection">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stacking, Regularization, and Variable Selection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08b-mediation.html" class="pagination-link" aria-label="Mediation">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb33" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Causal Inference</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>comma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">2</span>L) <span class="fu">format</span>(x, <span class="at">digits =</span> digits, <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey92"</span>)))</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend =</span> <span class="st">"cmdstanr"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>Causal inference is an important topic in statistics, but it also has a complicated history with statistics. Early-day statisticians saw causality as a taboo such that researchers were discouraged from drawing any causal conclusions in nonexperimental research. In the past few decades, much progress has been made on causal inference in epidemiology, computer science, and statistics, with several frameworks proposed and many tools developed for experimental and nonexperimental data.<span class="ot">[^taboo]</span> This note will introduce the causal diagram framework for encoding causal assumptions, which can be used to guide analysis for drawing causal conclusions. The goal is to give you some basic ideas so that you can learn more from other sources, such as the book <span class="co">[</span><span class="ot">*Causality* by Pearl</span><span class="co">](http://bayes.cs.ucla.edu/BOOK-2K/)</span> and the book <span class="co">[</span><span class="ot">*Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction* by Imbens and Rubin</span><span class="co">](https://doi.org/10.1017/CBO9781139025751)</span>.</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="ot">[^taboo]: </span>See this paper: <span class="ot">&lt;https://doi.org/10.1177/1745691620921521&gt;</span> for an argument of how the taboo against causal inference has impeded the progress of psychology research.</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>Two prominent frameworks for causal inference are</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Structural causal model, which uses tools such as DAGs and $d$-separation, is thoroughly described in the book <span class="co">[</span><span class="ot">*Causality* by Pearl</span><span class="co">](http://bayes.cs.ucla.edu/BOOK-2K/)</span>, and</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Potential outcome model, which is thoroughly described in the book <span class="co">[</span><span class="ot">*Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction* by Imbens and Rubin</span><span class="co">](https://doi.org/10.1017/CBO9781139025751)</span>.</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>In this note, we will draw on both frameworks.</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is Causal Inference?</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>Causal inference is the process of determining the causal effect of one variable on another, based on data and causal assumptions. Two common ways of interpreting a causal effect are (a) *intervention*: how $Y$ will change if $X$ is manipulated to be $x$; (b) *counterfactual*: what would $Y$ be if $X$ were set to $x$.</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Potential Outcomes</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>Consider a binary treatment variable. For each individual, there are two *potential outcomes*: one if they receive the treatment (T = 1) and one if they do not (T = 0). Here is a hypothetical data set of a new drug for improving statistics knowledge, with the treatment condition receiving the drug and the control condition receiving a placebo:</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>po_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">person =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>),</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">attitude =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">2</span>),</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">82</span>, <span class="dv">95</span>, <span class="dv">78</span>),</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">88</span>, <span class="dv">75</span>, <span class="dv">92</span>, <span class="dv">82</span>, <span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">78</span>)</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(po_dat,</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Person"</span>, <span class="st">"Math Attitude"</span>, <span class="st">"Y (if T = 1)"</span>, <span class="st">"Y (if T = 0)"</span>))</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>If one could observe the two potential outcomes for each person (which is impossible in the real world), one could compute the treatment effect for each person:</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>(te <span class="ot">&lt;-</span> po_dat<span class="sc">$</span>treat <span class="sc">-</span> po_dat<span class="sc">$</span>control)</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>and the **average treatment effect (ATE)** (here we just compute it on the sample, so the sample ATE):</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>(ate <span class="ot">&lt;-</span> <span class="fu">mean</span>(te))</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>However, in practice, we can only observe one of the two potential outcomes. For example, if persons 2, 4, 6, 7 are in the treatment condition, we have</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>po_dat<span class="sc">$</span>t <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(po_dat<span class="sc">$</span>person <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>po_dat<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(po_dat<span class="sc">$</span>t, po_dat<span class="sc">$</span>treat, po_dat<span class="sc">$</span>control)</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>po_dat[<span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"y"</span>)] <span class="sc">|&gt;</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Observed Y"</span>))</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>and the naive comparison of those in the treatment condition and those in the control condition will have a mean difference of</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(po_dat<span class="sc">$</span>y[po_dat<span class="sc">$</span>t <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(po_dat<span class="sc">$</span>y[po_dat<span class="sc">$</span>t <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>which gives a misleading estimate of the ATE.</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a><span class="fu">## Directed Acyclic Graph (DAG)</span></span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>DAG is a tool for encoding causal assumptions. It contains nodes and paths. A node is usually a variable that can be measured in the data or unmeasured. Generally, paths in a DAG are directional (as implied by *directed*), which indicates the directions of causal relations. Acyclic means the causal chain does not close in a loop. </span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>We will use an example described in @mcelreath2020, chapter 5, about data from 50 U.S. states from the 2009 American Community Survey (ACS), which we have already seen in @sec-multiple-predictors and @fig-waffle-divorce.</span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>waffle_divorce <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(  <span class="co"># read delimited files</span></span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/WaffleDivorce.csv"</span>,</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Rescale Marriage and Divorce by dividing by 10</span></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>Marriage <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>Marriage <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>Divorce <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>Divorce <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>MedianAgeMarriage <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>MedianAgeMarriage <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a><span class="co"># See data description at https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</span></span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a>The outcome of interest is the divorce rate. Remember the plot shows how marriage rate is related to divorce rate at the state level. It looks like marriage rate can predict divorce rate. A causal interpretation would be a stronger assertion, such that we expect a higher divorce rate if policymakers encourage more people to get married. In order to make a causal claim, we need to remove potential confounders. </span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>A potential confounder is when people get married. Suppose people are forced to get married later in life. In that case, fewer people in the population will be married, and people may have less time, opportunity, and motivation to get divorced (as it may be harder to find a new partner). Therefore, we can use the following DAG:</span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dag1</span></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "DAG for the relationship between marriage rate (M) and divorce rate (D) example, with median age of marriage (A) as a potential confounder."</span></span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>dag1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">"dag{ A -&gt; D; A -&gt; M; M -&gt; D }"</span>)</span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag1) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">M =</span> <span class="dv">0</span>, <span class="at">A =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">2</span>),</span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">M =</span> <span class="dv">0</span>, <span class="at">A =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">0</span>))</span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag1) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a>We can look at how the median age people get married in different states relates to the divorce rate:</span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-scatter-age-divorce</span></span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scatter plot of divorce rate (y) vs median age of marriage (x)."</span></span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(waffle_divorce,</span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MedianAgeMarriage, <span class="at">y =</span> Divorce)) <span class="sc">+</span></span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median age marriage (10 years)"</span>,</span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Divorce rate (per 10 adults)"</span>) <span class="sc">+</span></span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Loc))</span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assumptions in a DAG</span></span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a>In a graphical model, there are usually two kinds of assumptions conveyed. Perhaps counterintuitively, the weaker assumptions are the ones you can see, whereas the stronger assumptions are ones you **do not see**. </span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a>For example, a weak assumption is:</span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Marriage age *may* directly influence the number of people who are married</span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a>On the other hand, examples of a strong assumption are:</span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Marriage rate does not directly influence the age people get married</span>
<span id="cb33-160"><a href="#cb33-160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>there is no other variable in the causal pathway M <span class="dv">&amp;rarr;</span> D</span>
<span id="cb33-161"><a href="#cb33-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-162"><a href="#cb33-162" aria-hidden="true" tabindex="-1"></a>The last assumption will not hold if there is a common cause of M and D other than A.</span>
<span id="cb33-163"><a href="#cb33-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-164"><a href="#cb33-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Types of Junctions</span></span>
<span id="cb33-165"><a href="#cb33-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-166"><a href="#cb33-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fork: A <span class="dv">&amp;larr;</span> B <span class="dv">&amp;rarr;</span> C</span>
<span id="cb33-167"><a href="#cb33-167" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>A and C are correlated due to a common cause B</span>
<span id="cb33-168"><a href="#cb33-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-169"><a href="#cb33-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chain/Pipe: A <span class="dv">&amp;rarr;</span> B <span class="dv">&amp;rarr;</span> C</span>
<span id="cb33-170"><a href="#cb33-170" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>B is on the causal pathway of A to C</span>
<span id="cb33-171"><a href="#cb33-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-172"><a href="#cb33-172" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Collider: A <span class="dv">&amp;rarr;</span> B <span class="dv">&amp;larr;</span> C</span>
<span id="cb33-173"><a href="#cb33-173" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>B is a *descendant* of both A and C</span>
<span id="cb33-174"><a href="#cb33-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-175"><a href="#cb33-175" aria-hidden="true" tabindex="-1"></a>Going back to our example, there is a fork relation: M <span class="dv">&amp;rarr;</span> &lt;span style="color:red"&gt;A&lt;/span&gt; <span class="dv">&amp;rarr;</span> D. In this case, A is a confounder when estimating the causal relation between M and D. In this case, the causal effect of M to D can be obtained by adjusting for A, which means looking at the subsets of data where A is constant. In regression, adjustment is obtained by including both M and A as predictors of D.</span>
<span id="cb33-176"><a href="#cb33-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-177"><a href="#cb33-177" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Back-Door Criterion: Estimating Causal Effect in Nonexperimental Data</span></span>
<span id="cb33-178"><a href="#cb33-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-179"><a href="#cb33-179" aria-hidden="true" tabindex="-1"></a>Randomization is one---but not the only---way to rule out confounding variables. Much progress has been made in clarifying that causal effects **can** be estimated in nonexperimental data. After all, researchers have not randomly assigned individuals to smoke $x$ cigarettes per day, but we are confident that smoking causes cancer; we never manipulated the moon's gravitational force, but we are pretty sure that the moon is a cause of high and low tides.</span>
<span id="cb33-180"><a href="#cb33-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-181"><a href="#cb33-181" aria-hidden="true" tabindex="-1"></a>In a DAG, the back-door criterion can be used to identify variables that we should adjust for to obtain a causal effect. The set of variables to be adjusted should (a) blocks every path between X and Y that contains an arrow entering X and (b) does not contain variables that are descendant of X.</span>
<span id="cb33-182"><a href="#cb33-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-185"><a href="#cb33-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-186"><a href="#cb33-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dag4</span></span>
<span id="cb33-187"><a href="#cb33-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "DAG for a hypothetical model with two measured and one unobserved confounder."</span></span>
<span id="cb33-188"><a href="#cb33-188" aria-hidden="true" tabindex="-1"></a>dag4 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb33-189"><a href="#cb33-189" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dag{</span></span>
<span id="cb33-190"><a href="#cb33-190" aria-hidden="true" tabindex="-1"></a><span class="st">      X -&gt; Y; W1 -&gt; X; U -&gt; W2; W2 -&gt; X; W1 -&gt; Y; U -&gt; Y</span></span>
<span id="cb33-191"><a href="#cb33-191" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb33-192"><a href="#cb33-192" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-193"><a href="#cb33-193" aria-hidden="true" tabindex="-1"></a><span class="fu">latents</span>(dag4) <span class="ot">&lt;-</span> <span class="st">"U"</span></span>
<span id="cb33-194"><a href="#cb33-194" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag4) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">W1 =</span> <span class="fl">0.66</span>, <span class="at">U =</span> <span class="fl">1.32</span>, <span class="at">W2 =</span> <span class="fl">0.66</span>, <span class="at">Y =</span> <span class="dv">2</span>),</span>
<span id="cb33-195"><a href="#cb33-195" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">W1 =</span> <span class="dv">1</span>, <span class="at">U =</span> <span class="dv">1</span>, <span class="at">W2 =</span> <span class="fl">0.5</span>, <span class="at">Y =</span> <span class="dv">0</span>))</span>
<span id="cb33-196"><a href="#cb33-196" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag4) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb33-197"><a href="#cb33-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-198"><a href="#cb33-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-199"><a href="#cb33-199" aria-hidden="true" tabindex="-1"></a>We can use a function in the <span class="in">`daggity`</span> package to identify the set of variables that satisfy the back-door criterion. In this case, we say that X and Y are $d$-separated by this set of adjusted variables:</span>
<span id="cb33-200"><a href="#cb33-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-203"><a href="#cb33-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-204"><a href="#cb33-204" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag4, <span class="at">exposure =</span> <span class="st">"X"</span>, <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb33-205"><a href="#cb33-205" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect =</span> <span class="st">"direct"</span>)</span>
<span id="cb33-206"><a href="#cb33-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-207"><a href="#cb33-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-208"><a href="#cb33-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using Multiple Regression Model</span></span>
<span id="cb33-209"><a href="#cb33-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-210"><a href="#cb33-210" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-211"><a href="#cb33-211" aria-hidden="true" tabindex="-1"></a>  \begin{aligned}</span>
<span id="cb33-212"><a href="#cb33-212" aria-hidden="true" tabindex="-1"></a>    D_i &amp; \sim N(\mu_i, \sigma)  <span class="sc">\\</span></span>
<span id="cb33-213"><a href="#cb33-213" aria-hidden="true" tabindex="-1"></a>    \mu_i &amp; = \beta_0 + \beta_1 A_i + \beta_2 M_i <span class="sc">\\</span></span>
<span id="cb33-214"><a href="#cb33-214" aria-hidden="true" tabindex="-1"></a>    \beta_0 &amp; \sim N(0, 1) <span class="sc">\\</span></span>
<span id="cb33-215"><a href="#cb33-215" aria-hidden="true" tabindex="-1"></a>    \beta_1 &amp; \sim N(0, 1) <span class="sc">\\</span></span>
<span id="cb33-216"><a href="#cb33-216" aria-hidden="true" tabindex="-1"></a>    \beta_2 &amp; \sim N(0, 1) <span class="sc">\\</span></span>
<span id="cb33-217"><a href="#cb33-217" aria-hidden="true" tabindex="-1"></a>  \end{aligned}</span>
<span id="cb33-218"><a href="#cb33-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-219"><a href="#cb33-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-220"><a href="#cb33-220" aria-hidden="true" tabindex="-1"></a>Assuming a correctly specified DAG, all all assumptions of a linear model are met, $\beta_2$ is the causal effect of M on D. Here is the <span class="in">`brms`</span>{.r} code:</span>
<span id="cb33-221"><a href="#cb33-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-224"><a href="#cb33-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-225"><a href="#cb33-225" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(Divorce <span class="sc">~</span> MedianAgeMarriage <span class="sc">+</span> Marriage,</span>
<span id="cb33-226"><a href="#cb33-226" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> waffle_divorce,</span>
<span id="cb33-227"><a href="#cb33-227" aria-hidden="true" tabindex="-1"></a>          <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> <span class="st">"b"</span>) <span class="sc">+</span></span>
<span id="cb33-228"><a href="#cb33-228" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb33-229"><a href="#cb33-229" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"sigma"</span>),</span>
<span id="cb33-230"><a href="#cb33-230" aria-hidden="true" tabindex="-1"></a>          <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb33-231"><a href="#cb33-231" aria-hidden="true" tabindex="-1"></a>          <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb33-232"><a href="#cb33-232" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"08_m1"</span></span>
<span id="cb33-233"><a href="#cb33-233" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-234"><a href="#cb33-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-235"><a href="#cb33-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-236"><a href="#cb33-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Table</span></span>
<span id="cb33-237"><a href="#cb33-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-240"><a href="#cb33-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-241"><a href="#cb33-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-m1</span></span>
<span id="cb33-242"><a href="#cb33-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Model results for the divorce rate example."</span></span>
<span id="cb33-243"><a href="#cb33-243" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(m1,</span>
<span id="cb33-244"><a href="#cb33-244" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb33-245"><a href="#cb33-245" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="cn">NULL</span>, <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb33-246"><a href="#cb33-246" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-247"><a href="#cb33-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-248"><a href="#cb33-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-249"><a href="#cb33-249" aria-hidden="true" tabindex="-1"></a>As shown in the table, when holding constant the median marriage age of states, marriage rate has only a small effect on divorce rate.</span>
<span id="cb33-250"><a href="#cb33-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-251"><a href="#cb33-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior predictive checks</span></span>
<span id="cb33-252"><a href="#cb33-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-255"><a href="#cb33-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-256"><a href="#cb33-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-m1-pp-check</span></span>
<span id="cb33-257"><a href="#cb33-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior predictive checks for the multiple regression model."</span></span>
<span id="cb33-258"><a href="#cb33-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb33-259"><a href="#cb33-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb33-260"><a href="#cb33-260" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Posterior predictive density of divorce rate."</span></span>
<span id="cb33-261"><a href="#cb33-261" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Posterior predictive intervals of marriage rate predicting divorce rate."</span></span>
<span id="cb33-262"><a href="#cb33-262" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Posterior predictive intervals of median marriage age predicting marriage rate."</span></span>
<span id="cb33-263"><a href="#cb33-263" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="co"># density</span></span>
<span id="cb33-264"><a href="#cb33-264" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1, <span class="at">type =</span> <span class="st">"intervals"</span>, <span class="at">x =</span> <span class="st">"Marriage"</span>) <span class="sc">+</span></span>
<span id="cb33-265"><a href="#cb33-265" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Marriage"</span>, <span class="at">y =</span> <span class="st">"Divorce"</span>)</span>
<span id="cb33-266"><a href="#cb33-266" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1, <span class="at">type =</span> <span class="st">"intervals"</span>, <span class="at">x =</span> <span class="st">"MedianAgeMarriage"</span>) <span class="sc">+</span></span>
<span id="cb33-267"><a href="#cb33-267" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MedianAgeMarriage"</span>, <span class="at">y =</span> <span class="st">"Divorce"</span>)</span>
<span id="cb33-268"><a href="#cb33-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-269"><a href="#cb33-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-270"><a href="#cb33-270" aria-hidden="true" tabindex="-1"></a>The model does not fit every state (e.g., UT, ME, ID).</span>
<span id="cb33-271"><a href="#cb33-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-272"><a href="#cb33-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predicting an Intervention</span></span>
<span id="cb33-273"><a href="#cb33-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-274"><a href="#cb33-274" aria-hidden="true" tabindex="-1"></a>If the causal assumption in our DAG is reasonable, we have obtained an estimate of the causal effect of marriage rate on divorce rate at the state level. This allows us to answer questions like</span>
<span id="cb33-275"><a href="#cb33-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-276"><a href="#cb33-276" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; What would happen to the divorce rate if we encouraged more people to get married (so the marriage rate would increase by 10 percentage points)?</span></span>
<span id="cb33-277"><a href="#cb33-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-278"><a href="#cb33-278" aria-hidden="true" tabindex="-1"></a>We can use the Bayesian model, which is generative, to make such predictions. Consider a state with a marriage rate of 2 (per 10 adults). The predicted divorce rate is</span>
<span id="cb33-279"><a href="#cb33-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-280"><a href="#cb33-280" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-281"><a href="#cb33-281" aria-hidden="true" tabindex="-1"></a>\beta_0 + \beta_1 A + \beta_2 (2)</span>
<span id="cb33-282"><a href="#cb33-282" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-283"><a href="#cb33-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-284"><a href="#cb33-284" aria-hidden="true" tabindex="-1"></a>Consider an intervention that increases the marriage rate from 2 to 3. The predicted divorce rate will be</span>
<span id="cb33-285"><a href="#cb33-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-286"><a href="#cb33-286" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-287"><a href="#cb33-287" aria-hidden="true" tabindex="-1"></a>\beta_0 + \beta_1 A + \beta_2 (3)</span>
<span id="cb33-288"><a href="#cb33-288" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-289"><a href="#cb33-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-290"><a href="#cb33-290" aria-hidden="true" tabindex="-1"></a>The change in divorce rate is</span>
<span id="cb33-291"><a href="#cb33-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-292"><a href="#cb33-292" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-293"><a href="#cb33-293" aria-hidden="true" tabindex="-1"></a>\beta_0 + \beta_1 A + \beta_2 (3) - \beta_0 + \beta_1 A + \beta_2 (2) = \beta_2</span>
<span id="cb33-294"><a href="#cb33-294" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-295"><a href="#cb33-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-296"><a href="#cb33-296" aria-hidden="true" tabindex="-1"></a>Here is what the model would predict in terms of the change in the divorce rate (holding median marriage age to 25 years old), using R:</span>
<span id="cb33-297"><a href="#cb33-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-300"><a href="#cb33-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-301"><a href="#cb33-301" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-302"><a href="#cb33-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">Marriage =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb33-303"><a href="#cb33-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">MedianAgeMarriage =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>)</span>
<span id="cb33-304"><a href="#cb33-304" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-305"><a href="#cb33-305" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(pred_df, <span class="fu">fitted</span>(m1, <span class="at">newdata =</span> pred_df)) <span class="sc">%&gt;%</span></span>
<span id="cb33-306"><a href="#cb33-306" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb33-307"><a href="#cb33-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-308"><a href="#cb33-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-309"><a href="#cb33-309" aria-hidden="true" tabindex="-1"></a>The difference should be just the estimate of $\beta_2$, which has the following posterior distribution:</span>
<span id="cb33-310"><a href="#cb33-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-313"><a href="#cb33-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-314"><a href="#cb33-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marriage</span></span>
<span id="cb33-315"><a href="#cb33-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated \"causal\" effect of marriage rate on divorce rate, based on the specified DAG and a linear model."</span></span>
<span id="cb33-316"><a href="#cb33-316" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens</span>(m1, <span class="at">pars =</span> <span class="st">"b_Marriage"</span>)</span>
<span id="cb33-317"><a href="#cb33-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-318"><a href="#cb33-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-319"><a href="#cb33-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collider</span></span>
<span id="cb33-320"><a href="#cb33-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-321"><a href="#cb33-321" aria-hidden="true" tabindex="-1"></a>A collider is a descendant of two parent nodes. When one holds the collider constant, it induces a spurious association between the parents. This leads to many unexpected results in data analysis and daily life. For example, consider people who are nice and who are good-looking. Is there an association between a person being nice and a person being good-looking? Maybe. But this association can be induced when we condition on a collider. Let's say a friend of yours only dates people who are either nice or good-looking. So we have this colliding relation:</span>
<span id="cb33-322"><a href="#cb33-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-323"><a href="#cb33-323" aria-hidden="true" tabindex="-1"></a>Nice <span class="dv">&amp;rarr;</span> Dating <span class="dv">&amp;larr;</span> Good looking</span>
<span id="cb33-324"><a href="#cb33-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-325"><a href="#cb33-325" aria-hidden="true" tabindex="-1"></a>Suppose you look at just the people that your friend dated. In that case, they are either nice or good-looking, but the fact that you select to look at (condition on) only the people that your friend dated would automatically eliminate people who are neither nice nor good-looking. This induces a spurious negative association between nice and good-looking, so your friend may believe that nice people would be less likely to have appearances that fit their taste, and vice versa.</span>
<span id="cb33-326"><a href="#cb33-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-327"><a href="#cb33-327" aria-hidden="true" tabindex="-1"></a>As another example, is research that is newsworthy less trustworthy? There could be a negative association due to collider bias, because people who select research to be reported, funded, or published, consider both newsworthiness and trustworthiness. Assume that trustworthiness has no causal relation with newsworthiness, below shows what happens when we only focus on papers that are either high on newsworthiness or trustworthiness:</span>
<span id="cb33-328"><a href="#cb33-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-331"><a href="#cb33-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-332"><a href="#cb33-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb33-333"><a href="#cb33-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sim-news</span></span>
<span id="cb33-334"><a href="#cb33-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Simulation of newsworthiness and trustworthiness."</span></span>
<span id="cb33-335"><a href="#cb33-335" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2221</span>) <span class="co"># different seed from the text</span></span>
<span id="cb33-336"><a href="#cb33-336" aria-hidden="true" tabindex="-1"></a>num_proposals <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># number of grant proposals</span></span>
<span id="cb33-337"><a href="#cb33-337" aria-hidden="true" tabindex="-1"></a>prop_selected <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># proportion to select</span></span>
<span id="cb33-338"><a href="#cb33-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate independent newsworthiness and trustworthiness</span></span>
<span id="cb33-339"><a href="#cb33-339" aria-hidden="true" tabindex="-1"></a>plot_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-340"><a href="#cb33-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">nw =</span> <span class="fu">rnorm</span>(num_proposals),</span>
<span id="cb33-341"><a href="#cb33-341" aria-hidden="true" tabindex="-1"></a>    <span class="at">tw =</span> <span class="fu">rnorm</span>(num_proposals)</span>
<span id="cb33-342"><a href="#cb33-342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-343"><a href="#cb33-343" aria-hidden="true" tabindex="-1"></a>plot_dat <span class="ot">&lt;-</span> plot_dat <span class="sc">|&gt;</span></span>
<span id="cb33-344"><a href="#cb33-344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total =</span> nw <span class="sc">+</span> tw)</span>
<span id="cb33-345"><a href="#cb33-345" aria-hidden="true" tabindex="-1"></a>sel_dat <span class="ot">&lt;-</span> plot_dat <span class="sc">|&gt;</span></span>
<span id="cb33-346"><a href="#cb33-346" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select top 10% of combined scores</span></span>
<span id="cb33-347"><a href="#cb33-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(<span class="at">order_by =</span> total, <span class="at">prop =</span> prop_selected)</span>
<span id="cb33-348"><a href="#cb33-348" aria-hidden="true" tabindex="-1"></a>plot_dat <span class="sc">|&gt;</span></span>
<span id="cb33-349"><a href="#cb33-349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> nw, <span class="at">y =</span> tw)) <span class="sc">+</span></span>
<span id="cb33-350"><a href="#cb33-350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-351"><a href="#cb33-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> sel_dat, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb33-352"><a href="#cb33-352" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-353"><a href="#cb33-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb33-354"><a href="#cb33-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">data =</span> sel_dat, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-355"><a href="#cb33-355" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb33-356"><a href="#cb33-356" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"newsworthiness"</span>, <span class="at">y =</span> <span class="st">"trustworthiness"</span>)</span>
<span id="cb33-357"><a href="#cb33-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-358"><a href="#cb33-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-359"><a href="#cb33-359" aria-hidden="true" tabindex="-1"></a>As you can see, a negative correlation happens. This is collider bias: spurious correlation due to conditioning on the common descendant. This also goes by the name <span class="co">[</span><span class="ot">Berkson's Paradox</span><span class="co">](https://brilliant.org/wiki/berksons-paradox/)</span>.</span>
<span id="cb33-360"><a href="#cb33-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-361"><a href="#cb33-361" aria-hidden="true" tabindex="-1"></a>In the DAG below, X and Y have no causal association. Conditioning on S, however, induces a negative correlation between X and Y. With the DAG below,</span>
<span id="cb33-362"><a href="#cb33-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-363"><a href="#cb33-363" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb33-364"><a href="#cb33-364" aria-hidden="true" tabindex="-1"></a>Generally speaking, do not condition on a collider, unless you're going to de-confound the spurious association using other variables.</span>
<span id="cb33-365"><a href="#cb33-365" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-366"><a href="#cb33-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-369"><a href="#cb33-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-370"><a href="#cb33-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb33-371"><a href="#cb33-371" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dag7</span></span>
<span id="cb33-372"><a href="#cb33-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "DAG with collider bias."</span></span>
<span id="cb33-373"><a href="#cb33-373" aria-hidden="true" tabindex="-1"></a>dag7 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb33-374"><a href="#cb33-374" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dag{</span></span>
<span id="cb33-375"><a href="#cb33-375" aria-hidden="true" tabindex="-1"></a><span class="st">      X -&gt; Y; X -&gt; S; Y -&gt; S</span></span>
<span id="cb33-376"><a href="#cb33-376" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb33-377"><a href="#cb33-377" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-378"><a href="#cb33-378" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag7) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">S =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">2</span>),</span>
<span id="cb33-379"><a href="#cb33-379" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">0</span>, <span class="at">S =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">0</span>))</span>
<span id="cb33-380"><a href="#cb33-380" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(dag7) <span class="sc">+</span> <span class="fu">theme_dag</span>()</span>
<span id="cb33-381"><a href="#cb33-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-382"><a href="#cb33-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-383"><a href="#cb33-383" aria-hidden="true" tabindex="-1"></a>::: {.callout}</span>
<span id="cb33-384"><a href="#cb33-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-385"><a href="#cb33-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Age and Happiness, conditioned on Marital Status (Example from text)</span></span>
<span id="cb33-386"><a href="#cb33-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-387"><a href="#cb33-387" aria-hidden="true" tabindex="-1"></a>In this example, we assume that age and happiness are not related, but as people age, they are more likely to get married.</span>
<span id="cb33-388"><a href="#cb33-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-391"><a href="#cb33-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-392"><a href="#cb33-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb33-393"><a href="#cb33-393" aria-hidden="true" tabindex="-1"></a><span class="co"># Code adapted from the rethinking package (https://github.com/rmcelreath/rethinking/blob/master/R/sim_happiness.R)</span></span>
<span id="cb33-394"><a href="#cb33-394" aria-hidden="true" tabindex="-1"></a>sim_happiness <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">seed =</span> <span class="dv">1977</span>, <span class="at">N_years =</span> <span class="dv">100</span>,</span>
<span id="cb33-395"><a href="#cb33-395" aria-hidden="true" tabindex="-1"></a>                          <span class="at">max_age =</span> <span class="dv">65</span>, <span class="at">N_births =</span> <span class="dv">50</span>,</span>
<span id="cb33-396"><a href="#cb33-396" aria-hidden="true" tabindex="-1"></a>                          <span class="at">aom =</span> <span class="dv">18</span>) {</span>
<span id="cb33-397"><a href="#cb33-397" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb33-398"><a href="#cb33-398" aria-hidden="true" tabindex="-1"></a>    H <span class="ot">&lt;-</span> M <span class="ot">&lt;-</span> A <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb33-399"><a href="#cb33-399" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="fu">seq_len</span>(N_years)) {</span>
<span id="cb33-400"><a href="#cb33-400" aria-hidden="true" tabindex="-1"></a>        A <span class="ot">&lt;-</span> A <span class="sc">+</span> <span class="dv">1</span> <span class="co"># age existing individuals</span></span>
<span id="cb33-401"><a href="#cb33-401" aria-hidden="true" tabindex="-1"></a>        A <span class="ot">&lt;-</span> <span class="fu">c</span>(A, <span class="fu">rep</span>(<span class="dv">1</span>, N_births)) <span class="co"># newborns</span></span>
<span id="cb33-402"><a href="#cb33-402" aria-hidden="true" tabindex="-1"></a>        H <span class="ot">&lt;-</span> <span class="fu">c</span>(H, <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">length.out =</span> N_births)) <span class="co"># sim happiness trait - never changes</span></span>
<span id="cb33-403"><a href="#cb33-403" aria-hidden="true" tabindex="-1"></a>        M <span class="ot">&lt;-</span> <span class="fu">c</span>(M, <span class="fu">rep</span>(<span class="dv">0</span>, N_births)) <span class="co"># not yet married</span></span>
<span id="cb33-404"><a href="#cb33-404" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for each person over 17, chance get married</span></span>
<span id="cb33-405"><a href="#cb33-405" aria-hidden="true" tabindex="-1"></a>        M[A <span class="sc">&gt;=</span> aom <span class="sc">&amp;</span> M <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> </span>
<span id="cb33-406"><a href="#cb33-406" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rbinom</span>(A[A <span class="sc">&gt;=</span> aom <span class="sc">&amp;</span> M <span class="sc">==</span> <span class="dv">0</span>], <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb33-407"><a href="#cb33-407" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prob =</span> <span class="fu">plogis</span>(H[A <span class="sc">&gt;=</span> aom <span class="sc">&amp;</span> M <span class="sc">==</span> <span class="dv">0</span>] <span class="sc">-</span> <span class="fl">7.9</span>))</span>
<span id="cb33-408"><a href="#cb33-408" aria-hidden="true" tabindex="-1"></a>        <span class="co"># mortality</span></span>
<span id="cb33-409"><a href="#cb33-409" aria-hidden="true" tabindex="-1"></a>        deaths <span class="ot">&lt;-</span> <span class="fu">which</span>(A <span class="sc">&gt;</span> max_age)</span>
<span id="cb33-410"><a href="#cb33-410" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">length</span>(deaths) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-411"><a href="#cb33-411" aria-hidden="true" tabindex="-1"></a>            A <span class="ot">&lt;-</span> A[<span class="sc">-</span>deaths]</span>
<span id="cb33-412"><a href="#cb33-412" aria-hidden="true" tabindex="-1"></a>            H <span class="ot">&lt;-</span> H[<span class="sc">-</span>deaths]</span>
<span id="cb33-413"><a href="#cb33-413" aria-hidden="true" tabindex="-1"></a>            M <span class="ot">&lt;-</span> M[<span class="sc">-</span>deaths]</span>
<span id="cb33-414"><a href="#cb33-414" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-415"><a href="#cb33-415" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-416"><a href="#cb33-416" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> A, <span class="at">married =</span> M, <span class="at">happiness =</span> H)</span>
<span id="cb33-417"><a href="#cb33-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(d)</span>
<span id="cb33-418"><a href="#cb33-418" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-419"><a href="#cb33-419" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">sim_happiness</span>(<span class="dv">2024</span>, <span class="at">N_years =</span> <span class="dv">100</span>)</span>
<span id="cb33-420"><a href="#cb33-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-421"><a href="#cb33-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-424"><a href="#cb33-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-425"><a href="#cb33-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-happiness</span></span>
<span id="cb33-426"><a href="#cb33-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Age and happiness."</span></span>
<span id="cb33-427"><a href="#cb33-427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dd, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> happiness)) <span class="sc">+</span></span>
<span id="cb33-428"><a href="#cb33-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">size =</span> .<span class="dv">5</span>)</span>
<span id="cb33-429"><a href="#cb33-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-430"><a href="#cb33-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-433"><a href="#cb33-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-434"><a href="#cb33-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-happiness-married</span></span>
<span id="cb33-435"><a href="#cb33-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Age and happiness, conditioned on married couples."</span></span>
<span id="cb33-436"><a href="#cb33-436" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dd[dd<span class="sc">$</span>married <span class="sc">==</span> <span class="dv">1</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> happiness)) <span class="sc">+</span></span>
<span id="cb33-437"><a href="#cb33-437" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> .<span class="dv">5</span>)</span>
<span id="cb33-438"><a href="#cb33-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-439"><a href="#cb33-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-440"><a href="#cb33-440" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-441"><a href="#cb33-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-442"><a href="#cb33-442" aria-hidden="true" tabindex="-1"></a>Some other collider examples:</span>
<span id="cb33-443"><a href="#cb33-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-444"><a href="#cb33-444" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>impulsivity <span class="dv">&amp;rarr;</span> high-risk youth <span class="dv">&amp;larr;</span> delinquency</span>
<span id="cb33-445"><a href="#cb33-445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>healthcare worker <span class="dv">&amp;rarr;</span> COVID-19 testing <span class="dv">&amp;larr;</span> COVID-19 severity</span>
<span id="cb33-446"><a href="#cb33-446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>standardized test <span class="dv">&amp;rarr;</span> admission <span class="dv">&amp;larr;</span> research skills</span>
<span id="cb33-447"><a href="#cb33-447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>maternal smoking <span class="dv">&amp;rarr;</span> birth weight <span class="dv">&amp;rarr;</span> birth defect <span class="dv">&amp;larr;</span> mortality</span>
<span id="cb33-448"><a href="#cb33-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-449"><a href="#cb33-449" aria-hidden="true" tabindex="-1"></a><span class="fu">## Some Additional References</span></span>
<span id="cb33-450"><a href="#cb33-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-451"><a href="#cb33-451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>https://doi.org/10.1177/25152459221095823</span>
<span id="cb33-452"><a href="#cb33-452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>https://doi.org/10.1038/s41562-024-01939-z</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Hok Chio (Mark) Lai</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>18&nbsp; Generalized Linear Model – PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10b-glm2.html" rel="next">
<link href="./09c-hmc.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e4a87d4af550edcd74483d3193163bc4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-225295148', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../modules.html"> 
<span class="menu-text">Modules</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../docs/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../exercises/index.html"> 
<span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../syllabus/index.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/marklhc/usc-psyc573-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./PSYC-573-Bayesian-Data-Analysis--2024-Fall---Course-Notes.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-glm.html">Week 12</a></li><li class="breadcrumb-item"><a href="./10-glm.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Generalized Linear Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bayes-theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayes’s Theorem</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-beta-bernoulli-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04b-beta-bernoulli-stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model With Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04c-poisson-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Poisson Model</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-hierarchical-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5–6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06b-multiple-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06c-regression-diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-stacking-and-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stacking, Regularization, and Variable Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-causal-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08b-mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mediation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 10–11</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09b-gibbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Gibbs Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09c-hmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Hamiltonian Monte Carlo</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 12</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-glm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Generalized Linear Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b-glm2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Generalized Linear Model (II)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 13</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-multilevel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Multilevel Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#overview-of-glm" id="toc-overview-of-glm" class="nav-link active" data-scroll-target="#overview-of-glm"><span class="header-section-number">18.1</span> Overview of GLM</a></li>
  <li><a href="#poisson-regression" id="toc-poisson-regression" class="nav-link" data-scroll-target="#poisson-regression"><span class="header-section-number">18.2</span> Poisson Regression</a></li>
  <li>
<a href="#model-and-priors" id="toc-model-and-priors" class="nav-link" data-scroll-target="#model-and-priors"><span class="header-section-number">18.3</span> Model and Priors</a>
  <ul class="collapse">
<li><a href="#mcmc-sampling-with-brms" id="toc-mcmc-sampling-with-brms" class="nav-link" data-scroll-target="#mcmc-sampling-with-brms"><span class="header-section-number">18.3.1</span> MCMC Sampling With <code>brms</code></a></li>
  <li><a href="#interpretations" id="toc-interpretations" class="nav-link" data-scroll-target="#interpretations"><span class="header-section-number">18.3.2</span> Interpretations</a></li>
  <li><a href="#rootogram" id="toc-rootogram" class="nav-link" data-scroll-target="#rootogram"><span class="header-section-number">18.3.3</span> Rootogram</a></li>
  </ul>
</li>
  <li><a href="#negative-binomial-model" id="toc-negative-binomial-model" class="nav-link" data-scroll-target="#negative-binomial-model"><span class="header-section-number">18.4</span> Negative Binomial Model</a></li>
  <li>
<a href="#binary-logistic-regression" id="toc-binary-logistic-regression" class="nav-link" data-scroll-target="#binary-logistic-regression"><span class="header-section-number">18.5</span> Binary Logistic Regression</a>
  <ul class="collapse">
<li><a href="#centering" id="toc-centering" class="nav-link" data-scroll-target="#centering"><span class="header-section-number">18.5.1</span> Centering</a></li>
  <li><a href="#model-and-priors-1" id="toc-model-and-priors-1" class="nav-link" data-scroll-target="#model-and-priors-1"><span class="header-section-number">18.5.2</span> Model and Priors</a></li>
  <li><a href="#interpreting-the-results" id="toc-interpreting-the-results" class="nav-link" data-scroll-target="#interpreting-the-results"><span class="header-section-number">18.5.3</span> Interpreting the results</a></li>
  <li><a href="#posterior-predictive-check" id="toc-posterior-predictive-check" class="nav-link" data-scroll-target="#posterior-predictive-check"><span class="header-section-number">18.5.4</span> Posterior Predictive Check</a></li>
  <li><a href="#linear-spline" id="toc-linear-spline" class="nav-link" data-scroll-target="#linear-spline"><span class="header-section-number">18.5.5</span> Linear Spline</a></li>
  <li><a href="#posterior-prediction" id="toc-posterior-prediction" class="nav-link" data-scroll-target="#posterior-prediction"><span class="header-section-number">18.5.6</span> Posterior Prediction</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison"><span class="header-section-number">18.5.7</span> Model Comparison</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-glm.html">Week 12</a></li><li class="breadcrumb-item"><a href="./10-glm.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Generalized Linear Model</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Generalized Linear Model</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>GLM (generalized linear model) is a general class of statistical models for predicting an outcome variable, <span class="math inline">\(Y\)</span>. It accommodates <span class="math inline">\(Y\)</span> in different types of measurement, such as continuous, counts, ordinal, or categorical. GLM is a generalization of the usual regression model that assumes linear associations and normally distributed errors.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Just to be careful, some scholars also use the abbreviation GLM to mean the <em>general</em> linear model, and the latter is actually the same as the linear model, which is a special case of the GLM we will discuss here. Here, we discuss the GLM (the generalized one) that is especially popular for modeling binary and count outcomes, but we will start with the linear regression case.</p>
</div>
</div>
</div>
<section id="overview-of-glm" class="level2" data-number="18.1"><h2 data-number="18.1" class="anchored" data-anchor-id="overview-of-glm">
<span class="header-section-number">18.1</span> Overview of GLM</h2>
<p>Under the GLM framework, with one predictor, we have models in the form</p>
<p><span class="math display">\[
  \begin{aligned}
    Y_i &amp; \sim \mathrm{Dist}(\mu_i, \tau)  \\
    g(\mu_i) &amp; = \eta_i \\
    \eta_i &amp; = \beta_0 + \beta_1 X_i
  \end{aligned}
\]</span></p>
<p>A GLM model has three components:</p>
<ul>
<li>Conditional distribution of <span class="math inline">\(Y\)</span> (e.g., Dist = Normal, Poisson, Binomial, Bernoulli)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</li>
<li>Linear predictor <span class="math inline">\(\eta\)</span>, which is a linear combination of the predictor</li>
<li>Link function <span class="math inline">\(g(\cdot)\)</span>, which maps <span class="math inline">\(\mu\)</span> to <span class="math inline">\(\eta\)</span>
</li>
</ul>
<p>In a GLM, one selects distributions like Dist = Normal, Poisson, Binomial, Bernoulli, etc. The distribution has a mean parameter <span class="math inline">\(\mu_i\)</span> and may have a dispersion parameter, <span class="math inline">\(\tau\)</span>. An intermediate step in GLM is transforming <span class="math inline">\(\mu_i\)</span> to <span class="math inline">\(\eta_i\)</span>. <span class="math inline">\(\eta_i\)</span> is called the <em>linear predictor</em>, which is the linear function of the predictors. In linear models, we directly model the conditional mean, <span class="math inline">\(\mu_i\)</span>, as the same as <span class="math inline">\(\eta_i\)</span>. However, to allow for the possibility of <span class="math inline">\(\mu_i\)</span> being a nonlinear function of the predictors, in GLM we transform <span class="math inline">\(\mu_i\)</span> by applying a <em>link function</em>, <span class="math inline">\(g(\cdot)\)</span>, so that, even though we <span class="math inline">\(\eta_i\)</span> to be linear in the coefficients, <span class="math inline">\(\mu_i = g^{-1}(\eta_i)\)</span> will be a nonlinear function of the coefficients as long as the link function is not linear. This step is needed to ensure the predicted values are not out of range.</p>
<p><a href="#tbl-glms" class="quarto-xref">Table&nbsp;<span>18.1</span></a> includes some commonly used GLMs.</p>
<div id="tbl-glms" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-glms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;18.1: Commonly used GLMs
</figcaption><div aria-describedby="tbl-glms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 20%">
<col style="width: 34%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">outcome type</th>
<th style="text-align: center;">Support</th>
<th style="text-align: center;">Distributions</th>
<th style="text-align: center;">Link</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">continuous</td>
<td style="text-align: center;">[<span class="math inline">\(-\infty\)</span>, <span class="math inline">\(\infty\)</span>]</td>
<td style="text-align: center;">Normal</td>
<td style="text-align: center;">Identity</td>
</tr>
<tr class="even">
<td style="text-align: center;">count (fixed duration)</td>
<td style="text-align: center;">{0, 1, <span class="math inline">\(\ldots\)</span>}</td>
<td style="text-align: center;">Poisson</td>
<td style="text-align: center;">Log</td>
</tr>
<tr class="odd">
<td style="text-align: center;">count (known # of trials)</td>
<td style="text-align: center;">{0, 1, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(N\)</span>}</td>
<td style="text-align: center;">Binomial</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">{0, 1}</td>
<td style="text-align: center;">Bernoulli</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ordinal</td>
<td style="text-align: center;">{0, 1, <span class="math inline">\(\ldots\)</span>, K}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="even">
<td style="text-align: center;">nominal</td>
<td style="text-align: center;">
<span class="math inline">\(K\)</span>-vector of {0, 1}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="odd">
<td style="text-align: center;">multinomial</td>
<td style="text-align: center;">
<span class="math inline">\(K\)</span>-vector of {0, 1, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(K\)</span>}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section><section id="poisson-regression" class="level2" data-number="18.2"><h2 data-number="18.2" class="anchored" data-anchor-id="poisson-regression">
<span class="header-section-number">18.2</span> Poisson Regression</h2>
<p>The Poisson GLM is used to model count outcomes. Count outcomes are non-negative discrete integers. Remember, with GLM, we are modeling the mean of the outcome, <span class="math inline">\(\mu\)</span>. Therefore, we need to make sure <span class="math inline">\(\mu\)</span> is non-negative, so we need a link function that can map <span class="math inline">\(\eta\)</span> from the whole real line to non-negative numbers; by far, the most commonly used link function is the logarithmic transformation, <span class="math inline">\(g(\mu) = \log(\mu)\)</span>.</p>
<p>Here’s an example data set recording the effect of anticonvulsant therapy in epilepsy. The outcome variable is the number of seizures in the two-week window prior to the last of the four visits.</p>
<p>First check the distribution of the counts in <a href="#fig-epilepsy4" class="quarto-xref">Figure&nbsp;<span>18.1</span></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">epilepsy4</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">epilepsy</span>, <span class="va">visit</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">epilepsy4</span><span class="op">$</span><span class="va">Trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">epilepsy4</span><span class="op">$</span><span class="va">Trt</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">epilepsy4</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">epilepsy4</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Trt</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-epilepsy4" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-epilepsy4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-epilepsy4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-epilepsy4-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-epilepsy4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-epilepsy4-1.png" class="img-fluid figure-img" data-ref-parent="fig-epilepsy4" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-epilepsy4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Overall counts
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-epilepsy4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-epilepsy4-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-epilepsy4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-epilepsy4-2.png" class="img-fluid figure-img" data-ref-parent="fig-epilepsy4" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-epilepsy4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) By treatment conditions
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-epilepsy4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.1: Distribution of the number of seizures in the epilepsy data set
</figcaption></figure>
</div>
</section><section id="model-and-priors" class="level2" data-number="18.3"><h2 data-number="18.3" class="anchored" data-anchor-id="model-and-priors">
<span class="header-section-number">18.3</span> Model and Priors</h2>
<p>Model:</p>
<p><span class="math display">\[
\begin{aligned}
  \text{count}_i &amp; \sim \mathrm{Pois}(\mu_i)  \\
  \log(\mu_i) &amp; = \eta_i \\
  \eta_i &amp; = \beta_0 + \beta_1 \text{Trt}_{i}
\end{aligned}
\]</span></p>
<p>Priors:</p>
<p><span class="math display">\[
\begin{aligned}
  \beta_0 &amp; \sim N(3, 2.5)  \\
  \beta_1 &amp; \sim N(0, 1)
\end{aligned}
\]</span></p>
<p>Predicted seizure rate = <span class="math inline">\(\exp(\beta_0 + \beta_1) = \exp(\beta_0) \exp(\beta_1)\)</span> for Trt = 1; <span class="math inline">\(\exp(\beta_0)\)</span> for Trt = 0</p>
<p><span class="math inline">\(\beta_1\)</span> = mean difference in <strong>log</strong> rate of seizure; <span class="math inline">\(\exp(\beta_1)\)</span> = ratio in rate of seizure</p>
<section id="mcmc-sampling-with-brms" class="level3" data-number="18.3.1"><h3 data-number="18.3.1" class="anchored" data-anchor-id="mcmc-sampling-with-brms">
<span class="header-section-number">18.3.1</span> MCMC Sampling With <code>brms</code>
</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">Trt</span>,</span>
<span>    data <span class="op">=</span> <span class="va">epilepsy4</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">31143</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"10_m2"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 chains, at most 2 in parallel...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.0 seconds.
Chain 2 finished in 0.0 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.0 seconds.
Chain 4 finished in 0.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.0 seconds.
Total execution time: 0.7 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rstan</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: StanHeaders</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
rstan version 2.32.5 (Stan version 2.32.2)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>For execution on a local, multicore CPU with excess RAM we recommend calling
options(mc.cores = parallel::detectCores()).
To avoid recompilation of unchanged Stan programs, we recommend calling
rstan_options(auto_write = TRUE)
For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,
change `threads_per_chain` option:
rstan_options(threads_per_chain = 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rstan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:posterior':

    ess_bulk, ess_tail</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
</div>
</section><section id="interpretations" class="level3" data-number="18.3.2"><h3 data-number="18.3.2" class="anchored" data-anchor-id="interpretations">
<span class="header-section-number">18.3.2</span> Interpretations</h3>
<p>Because of the nonlinear link function, one needs to be careful in interpreting the coefficients. With the log link, it is common to obtain the exponentiated coefficient. With the exponentiated coefficient, for every unit difference in <span class="math inline">\(X\)</span>, the predicted rate of seizure occurrence is <strong>multiplied</strong> by <span class="math inline">\(\exp(\beta_1)\)</span> times. Here is the usual step for obtaining the posterior distributions of the transformed parameters:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m2_summary</span> <span class="op">&lt;-</span> <span class="fu">as_draws</span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate_variables</span><span class="op">(</span></span>
<span>        exp_beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span>,</span>
<span>        exp_beta1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b_Trt1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">summarize_draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">m2_summary</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-m2-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-m2-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;18.2: Posterior summary of the Poisson regression model
</figcaption><div aria-describedby="tbl-m2-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">1.96</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3472.02</td>
<td style="text-align: right;">2643.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_Trt1</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">-0.33</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3139.53</td>
<td style="text-align: right;">2637.42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">1.98</td>
<td style="text-align: right;">1.98</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">1.91</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2930.65</td>
<td style="text-align: right;">2699.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">lprior</td>
<td style="text-align: right;">-3.01</td>
<td style="text-align: right;">-3.00</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-3.04</td>
<td style="text-align: right;">-2.99</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3326.32</td>
<td style="text-align: right;">2899.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lp__</td>
<td style="text-align: right;">-334.41</td>
<td style="text-align: right;">-334.12</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">-336.27</td>
<td style="text-align: right;">-333.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1838.59</td>
<td style="text-align: right;">2379.17</td>
</tr>
<tr class="even">
<td style="text-align: left;">exp_beta0</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">7.93</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">7.13</td>
<td style="text-align: right;">8.84</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3472.02</td>
<td style="text-align: right;">2643.16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">exp_beta1</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3139.53</td>
<td style="text-align: right;">2637.42</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>So here is a paragraph for the example:</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The model predicts that the mean seizure rate in two weeks for the control condition is 8, 90% CI [7.1, 8.8]; the exponentiated coefficient for the treatment indicator is 0.85, 90% CI [0.72, 0.99], meaning that on average, the treatment reduces seizure rate by 0.94% to 27.83%.</p>
</div>
</div>
</div>
</section><section id="rootogram" class="level3" data-number="18.3.3"><h3 data-number="18.3.3" class="anchored" data-anchor-id="rootogram">
<span class="header-section-number">18.3.3</span> Rootogram</h3>
<p>There is also a useful graphical tool, the rootogram (<a href="#fig-rootogram" class="quarto-xref">Figure&nbsp;<span>18.2</span></a>), for diagnosing count models.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m2</span>, type <span class="op">=</span> <span class="st">"rootogram"</span>, style <span class="op">=</span> <span class="st">"hanging"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'rootogram' by default.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rootogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rootogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-rootogram-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rootogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.2: Rootogram for the Poisson regression model
</figcaption></figure>
</div>
</div>
</div>
<p>If the fit is good, the bars should be close to touching the horizontal x-axis. Thus, the fit was not good in the above figure. Models that accommodate overdispersion and excessive zeros may be needed.</p>
</section></section><section id="negative-binomial-model" class="level2" data-number="18.4"><h2 data-number="18.4" class="anchored" data-anchor-id="negative-binomial-model">
<span class="header-section-number">18.4</span> Negative Binomial Model</h2>
<p>The negative binomial distribution is usually used to handle overdispersion in count data. The idea is that even with the same predictor value, each individual has a different rate of occurrence for an event, which is highly plausible for the epilepsy data. This class will not get into the details of the negative binomial, but you can check out <a href="https://online.ucpress.edu/collabra/article/7/1/27242/118591/Poisson-Regressions-A-Little-Fishy">this paper</a> or <a href="https://www.wiley.com/en-us/An+Introduction+to+Categorical+Data+Analysis%2C+3rd+Edition-p-9781119405269">this book</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m2_nb</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">Trt</span>,</span>
<span>    data <span class="op">=</span> <span class="va">epilepsy4</span>,</span>
<span>    family <span class="op">=</span> <span class="fu">negbinomial</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">31143</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"10_m2_nb"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 chains, at most 2 in parallel...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.0 seconds.
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.3 seconds.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m2_nb</span>, type <span class="op">=</span> <span class="st">"rootogram"</span>, style <span class="op">=</span> <span class="st">"hanging"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'rootogram' by default.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rootogram-nb" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rootogram-nb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-rootogram-nb-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rootogram-nb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.3: Rootogram for the Negative binomial model
</figcaption></figure>
</div>
</div>
</div>
</section><section id="binary-logistic-regression" class="level2" data-number="18.5"><h2 data-number="18.5" class="anchored" data-anchor-id="binary-logistic-regression">
<span class="header-section-number">18.5</span> Binary Logistic Regression</h2>
<p>We will use an example from this paper: <a href="https://journals.sagepub.com/doi/abs/10.1177/0956797616645672" class="uri">https://journals.sagepub.com/doi/abs/10.1177/0956797616645672</a>, which examines how common it was for researchers to report marginal <span class="math inline">\(p\)</span> values (i.e., .05 &lt; <span class="math inline">\(p\)</span> <span class="math inline">\(\leq\)</span> .10). The outcome is whether a study reported one or more marginal <span class="math inline">\(p\)</span> values (1 = Yes, 0 = No). The researchers also categorized the studies into three subfields (Cognitive Psychology, Developmental Psychology, Social Psychology), and there were a total of 1,535 studies examined from 1970 to 2010.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># readxl package can be used to import excel files</span></span>
<span><span class="va">datfile</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"marginalp.xlsx"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">datfile</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="st">"https://osf.io/r4njf/download"</span>,</span>
<span>        destfile <span class="op">=</span> <span class="va">datfile</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">marginalp</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">datfile</span><span class="op">)</span></span>
<span><span class="co"># Recode `Field` into a factor</span></span>
<span><span class="va">marginalp</span> <span class="op">&lt;-</span> <span class="va">marginalp</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Filter out studies without any experiments</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">`Number of Experiments`</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Field <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Field</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"Cognitive Psychology"</span>,</span>
<span>            <span class="st">"Developmental Psychology"</span>,</span>
<span>            <span class="st">"Social Psychology"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Rename the outcome</span></span>
<span>    <span class="fu">rename</span><span class="op">(</span>marginal_p <span class="op">=</span> <span class="va">`Marginals Yes/No`</span><span class="op">)</span></span>
<span><span class="co"># Proportion of marginal p in each subfield across Years</span></span>
<span><span class="va">marginalp</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">marginal_p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Field</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"ribbon"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Field</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Field</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">Field</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`
No summary function supplied, defaulting to `mean_se()`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-glm_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="centering" class="level3" data-number="18.5.1"><h3 data-number="18.5.1" class="anchored" data-anchor-id="centering">
<span class="header-section-number">18.5.1</span> Centering</h3>
<p>The issue of centering applies to most regression models, including GLMs. Because the predictor <code>Year</code> has values 1970, 1980, etc, if we use this variable as a predictor, the intercept <span class="math inline">\(\beta_0\)</span> will be the predicted value of <span class="math inline">\(\eta\)</span> when <code>Year</code> = 0, which is like 2,000 years before the data were collected. So instead, we usually want the value 0 to be something meaningful and/or a possible value in the data. So we will center the variable year by making 0 the year 1970. In addition, we will divide the values by 10 so that one unit in the new predictor means 10 years.</p>
<p>In other words, we will use a transformed predictor, <code>Year10</code> = (<code>Year</code> - 1970) / 10. So when <code>Year</code> = 1970, <code>Year10</code> = 0; when <code>Year</code> = 1990, <code>Year10</code> = 2.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">marginalp</span> <span class="op">&lt;-</span> <span class="va">marginalp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Year10 <span class="op">=</span> <span class="op">(</span><span class="va">Year</span> <span class="op">-</span> <span class="fl">1970</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Check the recode</span></span>
<span><span class="fu">distinct</span><span class="op">(</span><span class="va">marginalp</span>, <span class="va">Year</span>, <span class="va">Year10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Year10"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1980","2":"1"},{"1":"1970","2":"0"},{"1":"2000","2":"3"},{"1":"1990","2":"2"},{"1":"2010","2":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>For this example, I’ll look at the subset of developmental psychology. You may want to try using the other subsets of the data for practice.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">marginalp_dev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">marginalp</span>,</span>
<span>                        <span class="va">Field</span> <span class="op">==</span> <span class="st">"Developmental Psychology"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">marginalp_dev</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Field"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Paper Title"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Authors"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Year"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Number of Experiments"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["marginal_p"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["First or Only Marginal"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Conventional Threshold"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Year10"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"Developmental Psychology","2":"A New Look at Children's Understanding of Mind and Emotion: The Case of Prayer","3":"Christi Bamford; Kristen Hansen Lagattuta","4":"2010","5":"1","6":"1","7":"0.1","8":"1","9":"4"},{"1":"Developmental Psychology","2":"A Tale to Two Methods: Comparing Regression and Instrumental Variables Estimates of the Effects of preschool child care typo on the subsequent externalizing behavior of children in low-income families","3":"danielle crosby et al","4":"2010","5":"1","6":"1","7":"0.1","8":"1","9":"4"},{"1":"Developmental Psychology","2":"Associations among family environment, sustained attention, and school readiness for low-income children","3":"Rachel Razza; Anne martin; Jeanee brooks-gunn","4":"2010","5":"1","6":"1","7":"0.1","8":"1","9":"4"},{"1":"Developmental Psychology","2":"Attachment-based assessments of parent-child relationships in middle childhood","3":"kathyrn kerns et al","4":"2000","5":"1","6":"1","7":"0.1","8":"1","9":"3"},{"1":"Developmental Psychology","2":"Effects of Age and Naturally Occurring Experience on Spatial Visualization Performance","3":"Timothy Salthouse; Debora Mitchell","4":"1990","5":"1","6":"1","7":"0.1","8":"1","9":"2"},{"1":"Developmental Psychology","2":"Effortful control in early childhood: continuity and change, antecedents, and implications for social development","3":"grazyna kochanska et al","4":"2000","5":"1","6":"1","7":"0.1","8":"1","9":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="model-and-priors-1" class="level3" data-number="18.5.2"><h3 data-number="18.5.2" class="anchored" data-anchor-id="model-and-priors-1">
<span class="header-section-number">18.5.2</span> Model and Priors</h3>
<p>As the name “logistic regression” suggested, the logistic function is used somewhere in the model. The logistic function, or the inverse logit function, is <span class="math display">\[
\mu = g^{-1}(\eta) = \frac{\exp(\eta)}{1 + \exp(\eta)},
\]</span> which is a transformation from <span class="math inline">\(\eta\)</span> to <span class="math inline">\(\mu\)</span>. The link function, which is a transformation from <span class="math inline">\(\mu\)</span> to <span class="math inline">\(\eta\)</span>, is the logit function, <span class="math display">\[
\eta = g(\mu) = \log\frac{\mu}{1 - \mu},
\]</span> which converts <span class="math inline">\(\mu\)</span>, which is in probability metric, to <span class="math inline">\(\eta\)</span>, which is in log odds metric (odds = probability / [1 - probability]).</p>
<p>Model:</p>
<p><span class="math display">\[
\begin{aligned}
  \text{marginal\_p}_i &amp; \sim \mathrm{Bern}(\mu_i)  \\
  \mathrm{logit}(\mu_i) &amp; = \eta_i \\
  \eta_i &amp; = \beta_0 + \beta_1 \text{Year10}_{i}
\end{aligned}
\]</span></p>
<p>Priors:</p>
<p><span class="math display">\[
\begin{aligned}
  \beta_0 &amp; \sim t_4(0, 2.5)  \\
  \beta_1 &amp; \sim t_4(0, 1)
\end{aligned}
\]</span></p>
<p>There has been previous literature on what choices of prior on the <span class="math inline">\(\beta\)</span> coefficients for logistic regressions would be appropriate (see <a href="https://projecteuclid.org/journals/annals-of-applied-statistics/volume-2/issue-4/A-weakly-informative-default-prior-distribution-for-logistic-and-other/10.1214/08-AOAS191.full">this paper</a>). <span class="math inline">\(\beta\)</span> coefficients in logistic regression can be relatively large, unlike in normal regression. Therefore, it’s pointed out that a heavy tail distribution, like Cauchy and <span class="math inline">\(t\)</span>, would be more appropriate. Recent discussions have settled on priors such as <span class="math inline">\(t\)</span> distributions with small degrees of freedom as a good balance between heavy tails and efficiency for MCMC sampling. I use <span class="math inline">\(t_4(4, 0, 2.5)\)</span> for <span class="math inline">\(\beta_0\)</span>, which puts more density in [-2.5, 2.5] on the log odds unit. This means, in the year 1970, our belief is that the probability of marginally significant results would be somewhere between 0.08 to 0.92, which seems to cover a reasonable range. For <span class="math inline">\(\beta_1\)</span>, I use <span class="math inline">\(t_4(4, 0, 1)\)</span>, which suggests that a 10-year difference like corresponds to a difference in log odds between -1 and 1. While it’s hard to interpret the difference in log odds, a quick rule of thumb is to divide <span class="math inline">\(\beta_1\)</span> by 4, which roughly corresponds to the maximum difference in probability for a unit difference in the predictor. So if <span class="math inline">\(\beta_1\)</span> = 1, the maximum difference in probability will be no more than 25 percentage points. So my prior says that it’s unlikely that the probability of reporting marginal <span class="math inline">\(p\)</span> values would increase or decrease by 25 percentage points every 10 years, which again is a weak prior. If you’re uncertain, you can consider something weaker.</p>
<p>The priors are chosen to be weakly informative.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">marginal_p</span> <span class="op">~</span> <span class="va">Year10</span>,</span>
<span>    data <span class="op">=</span> <span class="va">marginalp_dev</span>,</span>
<span>    family <span class="op">=</span> <span class="fu">bernoulli</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">2.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Note: no sigma</span></span>
<span>    seed <span class="op">=</span> <span class="fl">1340</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"10_m4"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 chains, at most 2 in parallel...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 finished in 0.1 seconds.
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.5 seconds.</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In <code>brms</code> we used <code class="sourceCode r">family <span class="ot">=</span> <span class="fu">bernoulli</span>()</code>. In other R functions, such as <code>glm</code>, they do not distinguish between bernoulli and Binomial and only recognize <code class="sourceCode r">family <span class="ot">=</span> <span class="fu">binomial</span>()</code>, as a Bernoulli variable is a binomial variable with <span class="math inline">\(n = 1\)</span>.</p>
</div>
</div>
</div>
</section><section id="interpreting-the-results" class="level3" data-number="18.5.3"><h3 data-number="18.5.3" class="anchored" data-anchor-id="interpreting-the-results">
<span class="header-section-number">18.5.3</span> Interpreting the results</h3>
<p>Any nonlinear relationships will involve more work in interpretations, and the coefficients in logistic regressions are no exception.</p>
<section id="posterior-predictions" class="level4" data-number="18.5.3.1"><h4 data-number="18.5.3.1" class="anchored" data-anchor-id="posterior-predictions">
<span class="header-section-number">18.5.3.1</span> Posterior predictions</h4>
<p>A good way to start is to plot the model-implied association on the original unit of the data. The <code>conditional_effects()</code> function in <code>brms</code> comes in very handy, and I recommend you always start with this:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m4</span>, prob <span class="op">=</span> <span class="fl">.90</span><span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.01</span>, width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_continuous</span><span class="op">(</span></span>
<span>        breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1970"</span>, <span class="st">"1980"</span>, <span class="st">"1990"</span>, <span class="st">"2000"</span>, <span class="st">"2010"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-condeff-m4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-condeff-m4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-condeff-m4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-condeff-m4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.4: Predicted probabilities of marginal significant results over time.
</figcaption></figure>
</div>
</div>
</div>
<p>As you can see, the logistic model implies a somewhat nonlinear association between <code>Year10</code> and the outcome. From the graph, when <code>Year10</code> = 2, which is the Year 1990, the predicted probability of marginal significant results is about 25%, with a 90% credible interval of about 21 to 28%. We can get that using</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">posterior_epred</span><span class="op">(</span><span class="va">m4</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Year10 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">summarise_draws</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["q5"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["q95"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["ess_tail"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"...1","2":"0.2447597","3":"0.2442353","4":"0.01946538","5":"0.01910258","6":"0.2137743","7":"0.2779112","8":"1.000451","9":"2459.925","10":"2528.538"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="intercept" class="level4" data-number="18.5.3.2"><h4 data-number="18.5.3.2" class="anchored" data-anchor-id="intercept">
<span class="header-section-number">18.5.3.2</span> Intercept</h4>
<p>From the equation, when all predictors are zero, we have <span class="math display">\[
\mathrm{logit}(\mu_i) = \beta_0.
\]</span> Therefore, the intercept is the log odds that a study reported a marginally significant <span class="math inline">\(p\)</span> value when <code>Year10</code> = 0 (i.e, in 1970), which was estimated to be -1.8, 90% CI [-2.1, -1.5]. As log odds are not as intuitive as probability, it is common to interpret instead <span class="math inline">\(\hat{\mu} = \mathrm{logistic}(\beta_0)\)</span>, which is the conditional probability of being <code>marginal_p</code> = 1 in 1970. For Bayesian, that means obtaining the posterior distribution of <span class="math inline">\(\mathrm{logistic}(\beta_0)\)</span>, which can be done by</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m4_draws</span> <span class="op">&lt;-</span> <span class="fu">as_draws</span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></span>
<span><span class="va">m4_draws</span> <span class="op">&lt;-</span> <span class="va">m4_draws</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate_variables</span><span class="op">(</span>logistic_beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m4_draws</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"logistic_beta0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["q5"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["q95"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["ess_tail"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"logistic_beta0","2":"0.1409383","3":"0.1395251","4":"0.02301208","5":"0.02298859","6":"0.1057126","7":"0.179851","8":"1.000923","9":"2099.563","10":"2029.564"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The <code>bayesplot</code> package allows you to plot transformed parameters quickly:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">m4</span>, pars <span class="op">=</span> <span class="st">"b_Intercept"</span>,</span>
<span>           transformations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"b_Intercept"</span> <span class="op">=</span> <span class="st">"plogis"</span><span class="op">)</span>,</span>
<span>           bw <span class="op">=</span> <span class="st">"SJ"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-glm_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="interpreting-expbeta_1-as-odds-ratio" class="level4" data-number="18.5.3.3"><h4 data-number="18.5.3.3" class="anchored" data-anchor-id="interpreting-expbeta_1-as-odds-ratio">
<span class="header-section-number">18.5.3.3</span> Interpreting <span class="math inline">\(\exp(\beta_1)\)</span> as odds ratio</h4>
<p>The slope, <span class="math inline">\(\beta_1\)</span>, represents the difference in the predicted log odds between two observations with a unit difference in the predictor. For example, for two individuals with a unit difference in <code>Year10</code> (i.e., 10 years), we have <span class="math display">\[
\mathrm{logit}(\mu_{\text{marginal\_p} = 1}) -
  \mathrm{logit}(\mu_{\text{marginal\_p} = 0}) = \beta_1.
\]</span></p>
<p>Again, the difference in log odds are hard to interpret, so we will exponentiate to get <span class="math display">\[
\frac{\mathrm{odds}_{\text{marginal\_p} = 1}}
       {\mathrm{odds}_{\text{marginal\_p} = 0}} = \exp(\beta_1).
\]</span></p>
<p>The fraction on the left-hand side is the <em>odds ratio</em> of reporting a marginal <span class="math inline">\(p\)</span> value associated with a unit difference in <code>Year10</code> (i.e., 10 years). An odds of 1.0 means that the probability of success and failure is equal; an odds &gt; 1 means success is more likely than failures; and an odds &lt; 1 means success is less likely than failures. Again, for Bayesian, we can obtain the posterior distribution of <span class="math inline">\(\exp(\beta_1)\)</span> by</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m4_draws</span> <span class="op">&lt;-</span> <span class="va">m4_draws</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate_variables</span><span class="op">(</span>exp_beta1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b_Year10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m4_draws</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"exp_beta1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["q5"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["q95"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["ess_tail"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"exp_beta1","2":"1.415853","3":"1.412214","4":"0.09537852","5":"0.09678103","6":"1.269313","7":"1.575832","8":"1.000795","9":"2688.052","10":"2697.848"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Using the posterior mean, we predict that the odds of reporting a marginal <span class="math inline">\(p\)</span> value for a study that is 10 years later is multiplied by 1.4 times, 90% CI [1.3, 1.6]; in other words, every 10 years, the odds increased by 41.5852521%. Here’s the posterior density plot for the odds ratio:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">m4</span>, pars <span class="op">=</span> <span class="st">"b_Year10"</span>,</span>
<span>           transformations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"b_Year10"</span> <span class="op">=</span> <span class="st">"exp"</span><span class="op">)</span>,</span>
<span>           bw <span class="op">=</span> <span class="st">"SJ"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-glm_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Odds ratio (OR) is popular as the multiplicative effect is constant, thus making interpretations easier. Also, in medical research and some other research areas, OR can be an excellent approximation of the relative risk, which is the probability ratio of two groups, of some rare diseases or events. However, odds and odds ratios are never intuitive metrics for people, and in many situations, a large odds ratio may be misleading as it may represent a very small effect. Therefore, in general, I would recommend you to interpret coefficients in probability units, even though that means more work.</p>
</section><section id="interpreting-coefficients-in-probability-units" class="level4" data-number="18.5.3.4"><h4 data-number="18.5.3.4" class="anchored" data-anchor-id="interpreting-coefficients-in-probability-units">
<span class="header-section-number">18.5.3.4</span> Interpreting Coefficients in Probability Units</h4>
<p>Another way to interpret the results of the logistic regression coefficient is to examine the change in probability. Because the predicted probability is a nonlinear function of the predictors, a unit difference in the predictor has different meanings depending on the values of <span class="math inline">\(X\)</span> you chose for interpretations. You can see that in the <code>conditional_effects()</code> plot earlier.</p>
<p>Consider the change in the predicted probability of reporting a marginal <span class="math inline">\(p\)</span> value with <code>Year10</code> = 0 (1970), <code>Year10</code> = 1 (1980), to <code>Year10</code> = 4, respectively:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m4_pred</span> <span class="op">&lt;-</span> <span class="fu">posterior_epred</span><span class="op">(</span><span class="va">m4</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Year10 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">m4_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Year10="</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">summarise_draws</span><span class="op">(</span><span class="va">m4_pred</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["q5"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["q95"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["ess_tail"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"Year10=0","2":"0.1409383","3":"0.1395251","4":"0.02301208","5":"0.02298859","6":"0.1057126","7":"0.1798510","8":"1.0017523","9":"2062.083","10":"2023.701"},{"1":"Year10=1","2":"0.1870871","3":"0.1863948","4":"0.02105652","5":"0.02124572","6":"0.1542172","7":"0.2230440","8":"1.0012130","9":"2072.412","10":"2149.976"},{"1":"Year10=2","2":"0.2447597","3":"0.2442353","4":"0.01946538","5":"0.01910258","6":"0.2137743","7":"0.2779112","8":"1.0004509","9":"2459.925","10":"2528.538"},{"1":"Year10=3","2":"0.3139127","3":"0.3140040","4":"0.02350314","5":"0.02330612","6":"0.2749946","7":"0.3532156","8":"0.9998848","9":"3600.730","10":"2610.041"},{"1":"Year10=4","2":"0.3926253","3":"0.3922396","4":"0.03505853","5":"0.03485171","6":"0.3349127","7":"0.4508999","8":"0.9997871","9":"3947.715","10":"2653.375"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>As you can see, the predicted difference in probability is smaller when comparing <code>Year10</code> = 0 and 1, but is larger when comparing <code>Year10</code> = 3 and 4.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The “divide by 4 rule”
</div>
</div>
<div class="callout-body-container callout-body">
<p>A quick approximation is to divide the coefficient by 4 to get an upper bound on the change in probability associated with a unit change in the predictor. In our example, this corresponds to 0.3454722 / 4 = 0.086368, which is very close to the predicted difference in probability from <code>Year10</code> = 3 to <code>Year10</code> = 4.</p>
</div>
</div>
</section></section><section id="posterior-predictive-check" class="level3" data-number="18.5.4"><h3 data-number="18.5.4" class="anchored" data-anchor-id="posterior-predictive-check">
<span class="header-section-number">18.5.4</span> Posterior Predictive Check</h3>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span></span>
<span>    <span class="va">m4</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"error_binned"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using 10 posterior draws for ppc type 'error_binned' by default.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ppc-m4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ppc-m4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-ppc-m4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ppc-m4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.5: Posterior Predictive Check for the binary logistic model.
</figcaption></figure>
</div>
</div>
</div>
<p>The linear model is not the best fit.</p>
</section><section id="linear-spline" class="level3" data-number="18.5.5"><h3 data-number="18.5.5" class="anchored" data-anchor-id="linear-spline">
<span class="header-section-number">18.5.5</span> Linear Spline</h3>
<p>Use <code><a href="https://rdrr.io/r/splines/bs.html">bs()</a></code> to specify a linear spline (degree = 1) with one turning point (knots = 3).</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span><span class="va">m5</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">marginal_p</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/bs.html">bs</a></span><span class="op">(</span><span class="va">Year10</span>, degree <span class="op">=</span> <span class="fl">1</span>, knots <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">marginalp_dev</span>,</span>
<span>    family <span class="op">=</span> <span class="fu">bernoulli</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">.875</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="co"># Note: no sigma</span></span>
<span>    seed <span class="op">=</span> <span class="fl">1340</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"10_m5"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 chains, at most 2 in parallel...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.2 seconds.
Chain 2 finished in 0.1 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.1 seconds.
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.5 seconds.</code></pre>
</div>
</div>
</section><section id="posterior-prediction" class="level3" data-number="18.5.6"><h3 data-number="18.5.6" class="anchored" data-anchor-id="posterior-prediction">
<span class="header-section-number">18.5.6</span> Posterior Prediction</h3>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m5</span><span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.01</span>, width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-condeff-m5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-condeff-m5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-condeff-m5-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-condeff-m5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.6: Predicted probabilities of marginal significant results over time with the spline model.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pp_check</span><span class="op">(</span></span>
<span>    <span class="va">m5</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"error_binned"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year10"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using 10 posterior draws for ppc type 'error_binned' by default.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following arguments were unrecognized and ignored: x</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ppc-m5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ppc-m5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="10-glm_files/figure-html/fig-ppc-m5-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ppc-m5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.7: Posterior Predictive Check for the binary logistic model with a linear spline.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="model-comparison" class="level3" data-number="18.5.7"><h3 data-number="18.5.7" class="anchored" data-anchor-id="model-comparison">
<span class="header-section-number">18.5.7</span> Model Comparison</h3>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">msummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>linear <span class="op">=</span> <span class="va">m4</span>, `linear spline` <span class="op">=</span> <span class="va">m5</span><span class="op">)</span>,</span>
<span>         estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>         statistic <span class="op">=</span> <span class="cn">NULL</span>, fmt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 
`modelsummary` uses the `performance` package to extract goodness-of-fit
statistics from models of this class. You can specify the statistics you wish
to compute by supplying a `metrics` argument to `modelsummary`, which will then
push it forward to `performance`. Acceptable values are: "all", "common",
"none", or a character vector of metrics names. For example: `modelsummary(mod,
metrics = c("RMSE", "R2")` Note that some metrics are computationally
expensive. See `?performance::performance` for details.
 This warning appears once per session.</code></pre>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">linear</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">linear spline</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: center;">−1.82 [−2.20, −1.46]</td>
<td style="text-align: center;">−1.95 [−2.37, −1.55]</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_Year10</td>
<td style="text-align: center;">0.35 [0.22, 0.48]</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_bsYear10degreeEQ1knotsEQ31</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1.57 [0.93, 2.27]</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;">b_bsYear10degreeEQ1knotsEQ32</td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">1.22 [0.69, 1.77]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">535</td>
<td style="text-align: center;">535</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.049</td>
<td style="text-align: center;">0.050</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ELPD</td>
<td style="text-align: center;">−292.9</td>
<td style="text-align: center;">−290.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ELPD s.e.</td>
<td style="text-align: center;">11.2</td>
<td style="text-align: center;">11.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LOOIC</td>
<td style="text-align: center;">585.8</td>
<td style="text-align: center;">580.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">LOOIC s.e.</td>
<td style="text-align: center;">22.5</td>
<td style="text-align: center;">22.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WAIC</td>
<td style="text-align: center;">585.8</td>
<td style="text-align: center;">580.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">0.43</td>
<td style="text-align: center;">0.42</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The linear spline is better according to the information criteria.</p>


<!-- -->

</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Strictly speaking, GLM requires distributions that are in the <em>exponential family</em>, which will not include distributions like the <span class="math inline">\(t\)</span> distribution, but here, we also include models that use distributions similar to those in the exponential family, like the Student’s <span class="math inline">\(t\)</span> distribution.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09c-hmc.html" class="pagination-link" aria-label="Hamiltonian Monte Carlo">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Hamiltonian Monte Carlo</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10b-glm2.html" class="pagination-link" aria-label="Generalized Linear Model (II)">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Generalized Linear Model (II)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Generalized Linear Model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>comma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">2</span>L) <span class="fu">format</span>(x, <span class="at">digits =</span> digits, <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey92"</span>)))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">mc.cores =</span> <span class="dv">2</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>GLM (generalized linear model) is a general class of statistical models for predicting an outcome variable, $Y$. It accommodates $Y$ in different types of measurement, such as continuous, counts, ordinal, or categorical. GLM is a generalization of the usual regression model that assumes linear associations and normally distributed errors.</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>Just to be careful, some scholars also use the abbreviation GLM to mean the *general* linear model, and the latter is actually the same as the linear model, which is a special case of the GLM we will discuss here. Here, we discuss the GLM (the generalized one) that is especially popular for modeling binary and count outcomes, but we will start with the linear regression case.</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview of GLM</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>Under the GLM framework, with one predictor, we have models in the form</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  \begin{aligned}</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>    Y_i &amp; \sim \mathrm{Dist}(\mu_i, \tau)  <span class="sc">\\</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    g(\mu_i) &amp; = \eta_i <span class="sc">\\</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    \eta_i &amp; = \beta_0 + \beta_1 X_i</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  \end{aligned}</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>A GLM model has three components:</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conditional distribution of $Y$ (e.g., Dist = Normal, Poisson, Binomial, Bernoulli)<span class="ot">[^exponential-family]</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear predictor $\eta$, which is a linear combination of the predictor</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Link function $g(\cdot)$, which maps $\mu$ to $\eta$</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="ot">[^exponential-family]: </span>Strictly speaking, GLM requires distributions that are in the *exponential family*, which will not include distributions like the $t$ distribution, but here, we also include models that use distributions similar to those in the exponential family, like the Student's $t$ distribution.</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>In a GLM, one selects distributions like Dist = Normal, Poisson, Binomial, Bernoulli, etc. The distribution has a mean parameter $\mu_i$ and may have a dispersion parameter, $\tau$. An intermediate step in GLM is transforming $\mu_i$ to $\eta_i$. $\eta_i$ is called the *linear predictor*, which is the linear function of the predictors. In linear models, we directly model the conditional mean, $\mu_i$, as the same as $\eta_i$. However, to allow for the possibility of $\mu_i$ being a nonlinear function of the predictors, in GLM we transform $\mu_i$ by applying a *link function*, $g(\cdot)$, so that, even though we $\eta_i$ to be linear in the coefficients, $\mu_i = g^{-1}(\eta_i)$ will be a nonlinear function of the coefficients as long as the link function is not linear. This step is needed to ensure the predicted values are not out of range.</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>@tbl-glms includes some commonly used GLMs.</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>| outcome type | Support | Distributions | Link |</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>|:------------:|:-------:|:-------------:|:----:|</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>| continuous | <span class="co">[</span><span class="ot">$-\infty$, $\infty$</span><span class="co">]</span> | Normal | Identity |</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>| count (fixed duration) | {0, 1, $\ldots$} | Poisson | Log |</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>| count (known # of trials) | {0, 1, $\ldots$, $N$} | Binomial | Logit |</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>| binary | {0, 1} | Bernoulli | Logit |</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>| ordinal | {0, 1, $\ldots$, K} | categorical | Logit |</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>| nominal | $K$-vector of {0, 1} | categorical | Logit |</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>| multinomial | $K$-vector of {0, 1, $\ldots$, $K$} | categorical | Logit |</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>: Commonly used GLMs {#tbl-glms}</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poisson Regression</span></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>The Poisson GLM is used to model count outcomes. Count outcomes are non-negative discrete integers. Remember, with GLM, we are modeling the mean of the outcome, $\mu$. Therefore, we need to make sure $\mu$ is non-negative, so we need a link function that can map $\eta$ from the whole real line to non-negative numbers; by far, the most commonly used link function is the logarithmic transformation, $g(\mu) = \log(\mu)$.</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>Here's an example data set recording the effect of anticonvulsant therapy in epilepsy. The outcome variable is the number of seizures in the two-week window prior to the last of the four visits.</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a>First check the distribution of the counts in @fig-epilepsy4.</span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-epilepsy4</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Distribution of the number of seizures in the epilepsy data set</span></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - Overall counts</span></span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - By treatment conditions</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>epilepsy4 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(epilepsy, visit <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>epilepsy4<span class="sc">$</span>Trt <span class="ot">&lt;-</span> <span class="fu">factor</span>(epilepsy4<span class="sc">$</span>Trt)</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(epilepsy4, <span class="fu">aes</span>(<span class="at">x =</span> count)) <span class="sc">+</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(epilepsy4, <span class="fu">aes</span>(<span class="at">x =</span> Trt, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>)</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model and Priors</span></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a>Model:</span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>  \text{count}_i &amp; \sim \mathrm{Pois}(\mu_i)  <span class="sc">\\</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>  \log(\mu_i) &amp; = \eta_i <span class="sc">\\</span></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>  \eta_i &amp; = \beta_0 + \beta_1 \text{Trt}_{i}</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a>Priors:</span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a>  \beta_0 &amp; \sim N(3, 2.5)  <span class="sc">\\</span></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>  \beta_1 &amp; \sim N(0, 1)</span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a>Predicted seizure rate = $\exp(\beta_0 + \beta_1) = \exp(\beta_0) \exp(\beta_1)$ for Trt = 1; $\exp(\beta_0)$ for Trt = 0</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a>$\beta_1$ = mean difference in **log** rate of seizure; $\exp(\beta_1)$ = ratio in rate of seizure</span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a><span class="fu">### MCMC Sampling With `brms`</span></span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(count <span class="sc">~</span> Trt,</span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> epilepsy4,</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>)</span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">31143</span>,</span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"10_m2"</span></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretations</span></span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a>Because of the nonlinear link function, one needs to be careful in interpreting the coefficients. With the log link, it is common to obtain the exponentiated coefficient. With the exponentiated coefficient, for every unit difference in $X$, the predicted rate of seizure occurrence is **multiplied** by $\exp(\beta_1)$ times. Here is the usual step for obtaining the posterior distributions of the transformed parameters:</span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-m2-summary</span></span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Posterior summary of the Poisson regression model</span></span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a>m2_summary <span class="ot">&lt;-</span> <span class="fu">as_draws</span>(m2) <span class="sc">|&gt;</span></span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(</span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">exp_beta0 =</span> <span class="fu">exp</span>(b_Intercept),</span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a>        <span class="at">exp_beta1 =</span> <span class="fu">exp</span>(b_Trt1)</span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_draws</span>()</span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(m2_summary, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a>So here is a paragraph for the example:</span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a>get_mean_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(i, summ, <span class="at">unit =</span> <span class="st">""</span>, <span class="at">unit_ci =</span> <span class="st">""</span>) {</span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(summ[[<span class="st">"mean"</span>]][i], <span class="dv">2</span>), unit,</span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a>        <span class="st">", 90% CI ["</span>,</span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(summ[[<span class="st">"q5"</span>]][i], <span class="dv">2</span>), unit_ci, <span class="st">", "</span>,</span>
<span id="cb45-159"><a href="#cb45-159" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(summ[[<span class="st">"q95"</span>]][i], <span class="dv">2</span>), unit_ci, <span class="st">"]"</span></span>
<span id="cb45-160"><a href="#cb45-160" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-161"><a href="#cb45-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-164"><a href="#cb45-164" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb45-165"><a href="#cb45-165" aria-hidden="true" tabindex="-1"></a>The model predicts that the mean seizure rate in two weeks for the control condition is <span class="in">`r get_mean_ci(6, m2_summary)`</span>; the exponentiated coefficient for the treatment indicator is <span class="in">`r get_mean_ci(7, m2_summary)`</span>, meaning that on average, the treatment reduces seizure rate by <span class="in">`r round((1 - m2_summary[["q95"]][7]) * 100, 2)`</span>% to <span class="in">`r round((1 - m2_summary[["q5"]][7]) * 100, 2)`</span>%.</span>
<span id="cb45-166"><a href="#cb45-166" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-167"><a href="#cb45-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rootogram</span></span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a>There is also a useful graphical tool, the rootogram (@fig-rootogram), for diagnosing count models.</span>
<span id="cb45-171"><a href="#cb45-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-rootogram</span></span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Rootogram for the Poisson regression model</span></span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m2, <span class="at">type =</span> <span class="st">"rootogram"</span>, <span class="at">style =</span> <span class="st">"hanging"</span>)</span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a>If the fit is good, the bars should be close to touching the horizontal x-axis. Thus, the fit was not good in the above figure. Models that accommodate overdispersion and excessive zeros may be needed.</span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## Negative Binomial Model</span></span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a>The negative binomial distribution is usually used to handle overdispersion in count data. The idea is that even with the same predictor value, each individual has a different rate of occurrence for an event, which is highly plausible for the epilepsy data. This class will not get into the details of the negative binomial, but you can check out <span class="co">[</span><span class="ot">this paper</span><span class="co">](https://online.ucpress.edu/collabra/article/7/1/27242/118591/Poisson-Regressions-A-Little-Fishy)</span> or <span class="co">[</span><span class="ot">this book</span><span class="co">](https://www.wiley.com/en-us/An+Introduction+to+Categorical+Data+Analysis%2C+3rd+Edition-p-9781119405269)</span>.</span>
<span id="cb45-185"><a href="#cb45-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a>m2_nb <span class="ot">&lt;-</span> <span class="fu">brm</span>(count <span class="sc">~</span> Trt,</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> epilepsy4,</span>
<span id="cb45-191"><a href="#cb45-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">negbinomial</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb45-192"><a href="#cb45-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>)</span>
<span id="cb45-195"><a href="#cb45-195" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb45-196"><a href="#cb45-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">31143</span>,</span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"10_m2_nb"</span></span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-rootogram-nb</span></span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Rootogram for the Negative binomial model</span></span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m2_nb, <span class="at">type =</span> <span class="st">"rootogram"</span>, <span class="at">style =</span> <span class="st">"hanging"</span>)</span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a><span class="fu">## Binary Logistic Regression</span></span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-211"><a href="#cb45-211" aria-hidden="true" tabindex="-1"></a>We will use an example from this paper: <span class="ot">&lt;https://journals.sagepub.com/doi/abs/10.1177/0956797616645672&gt;</span>, which examines how common it was for researchers to report marginal $p$ values (i.e., .05 &lt; $p$ $\leq$ .10). The outcome is whether a study reported one or more marginal $p$ values (1 = Yes, 0 = No). The researchers also categorized the studies into three subfields (Cognitive Psychology, Developmental Psychology, Social Psychology), and there were a total of 1,535 studies examined from 1970 to 2010. </span>
<span id="cb45-212"><a href="#cb45-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a><span class="co"># readxl package can be used to import excel files</span></span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a>datfile <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"marginalp.xlsx"</span>)</span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(datfile)) {</span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"data"</span>), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(<span class="st">"https://osf.io/r4njf/download"</span>,</span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">destfile =</span> datfile</span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a>marginalp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(datfile)</span>
<span id="cb45-225"><a href="#cb45-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode `Field` into a factor</span></span>
<span id="cb45-226"><a href="#cb45-226" aria-hidden="true" tabindex="-1"></a>marginalp <span class="ot">&lt;-</span> marginalp <span class="sc">|&gt;</span></span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out studies without any experiments</span></span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">Number of Experiments</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-229"><a href="#cb45-229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Field =</span> <span class="fu">factor</span>(Field,</span>
<span id="cb45-230"><a href="#cb45-230" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Cognitive Psychology"</span>,</span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Developmental Psychology"</span>,</span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Social Psychology"</span></span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb45-236"><a href="#cb45-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename the outcome</span></span>
<span id="cb45-237"><a href="#cb45-237" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">marginal_p =</span> <span class="st">`</span><span class="at">Marginals Yes/No</span><span class="st">`</span>)</span>
<span id="cb45-238"><a href="#cb45-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of marginal p in each subfield across Years</span></span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a>marginalp <span class="sc">|&gt;</span></span>
<span id="cb45-240"><a href="#cb45-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> marginal_p)) <span class="sc">+</span></span>
<span id="cb45-241"><a href="#cb45-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Field), <span class="at">geom =</span> <span class="st">"ribbon"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">col =</span> Field), <span class="at">geom =</span> <span class="st">"line"</span>) <span class="sc">+</span></span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">col =</span> Field), <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> Field) <span class="sc">+</span></span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-249"><a href="#cb45-249" aria-hidden="true" tabindex="-1"></a><span class="fu">### Centering</span></span>
<span id="cb45-250"><a href="#cb45-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-251"><a href="#cb45-251" aria-hidden="true" tabindex="-1"></a>The issue of centering applies to most regression models, including GLMs. Because the predictor <span class="in">`Year`</span> has values 1970, 1980, etc, if we use this variable as a predictor, the intercept $\beta_0$ will be the predicted value of $\eta$ when <span class="in">`Year`</span> = 0, which is like 2,000 years before the data were collected. So instead, we usually want the value 0 to be something meaningful and/or a possible value in the data. So we will center the variable year by making 0 the year 1970. In addition, we will divide the values by 10 so that one unit in the new predictor means 10 years.</span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a>In other words, we will use a transformed predictor, <span class="in">`Year10`</span> = (<span class="in">`Year`</span> - 1970) / 10. So when <span class="in">`Year`</span> = 1970, <span class="in">`Year10`</span> = 0; when <span class="in">`Year`</span> = 1990, <span class="in">`Year10`</span> = 2.</span>
<span id="cb45-254"><a href="#cb45-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a>marginalp <span class="ot">&lt;-</span> marginalp <span class="sc">|&gt;</span></span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year10 =</span> (Year <span class="sc">-</span> <span class="dv">1970</span>) <span class="sc">/</span> <span class="dv">10</span>)</span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the recode</span></span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(marginalp, Year, Year10)</span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a>For this example, I'll look at the subset of developmental psychology. You may want to try using the other subsets of the data for practice.</span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-268"><a href="#cb45-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a>marginalp_dev <span class="ot">&lt;-</span> <span class="fu">filter</span>(marginalp,</span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a>                        Field <span class="sc">==</span> <span class="st">"Developmental Psychology"</span>)</span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(marginalp_dev)</span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model and Priors</span></span>
<span id="cb45-275"><a href="#cb45-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-276"><a href="#cb45-276" aria-hidden="true" tabindex="-1"></a>As the name "logistic regression" suggested, the logistic function is used somewhere in the model. The logistic function, or the inverse logit function, is </span>
<span id="cb45-277"><a href="#cb45-277" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-278"><a href="#cb45-278" aria-hidden="true" tabindex="-1"></a>\mu = g^{-1}(\eta) = \frac{\exp(\eta)}{1 + \exp(\eta)},</span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a>which is a transformation from $\eta$ to $\mu$. The link function, which is a transformation from $\mu$ to $\eta$, is the logit function,</span>
<span id="cb45-281"><a href="#cb45-281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-282"><a href="#cb45-282" aria-hidden="true" tabindex="-1"></a>\eta = g(\mu) = \log\frac{\mu}{1 - \mu},</span>
<span id="cb45-283"><a href="#cb45-283" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-284"><a href="#cb45-284" aria-hidden="true" tabindex="-1"></a>which converts $\mu$, which is in probability metric, to $\eta$, which is in log odds metric (odds = probability / <span class="co">[</span><span class="ot">1 - probability</span><span class="co">]</span>).</span>
<span id="cb45-285"><a href="#cb45-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-286"><a href="#cb45-286" aria-hidden="true" tabindex="-1"></a>Model:</span>
<span id="cb45-287"><a href="#cb45-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-288"><a href="#cb45-288" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-289"><a href="#cb45-289" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb45-290"><a href="#cb45-290" aria-hidden="true" tabindex="-1"></a>  \text{marginal<span class="sc">\_</span>p}_i &amp; \sim \mathrm{Bern}(\mu_i)  <span class="sc">\\</span></span>
<span id="cb45-291"><a href="#cb45-291" aria-hidden="true" tabindex="-1"></a>  \mathrm{logit}(\mu_i) &amp; = \eta_i <span class="sc">\\</span></span>
<span id="cb45-292"><a href="#cb45-292" aria-hidden="true" tabindex="-1"></a>  \eta_i &amp; = \beta_0 + \beta_1 \text{Year10}_{i}</span>
<span id="cb45-293"><a href="#cb45-293" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb45-294"><a href="#cb45-294" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-295"><a href="#cb45-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-296"><a href="#cb45-296" aria-hidden="true" tabindex="-1"></a>Priors:</span>
<span id="cb45-297"><a href="#cb45-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-298"><a href="#cb45-298" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-299"><a href="#cb45-299" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb45-300"><a href="#cb45-300" aria-hidden="true" tabindex="-1"></a>  \beta_0 &amp; \sim t_4(0, 2.5)  <span class="sc">\\</span></span>
<span id="cb45-301"><a href="#cb45-301" aria-hidden="true" tabindex="-1"></a>  \beta_1 &amp; \sim t_4(0, 1)</span>
<span id="cb45-302"><a href="#cb45-302" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb45-303"><a href="#cb45-303" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-304"><a href="#cb45-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-305"><a href="#cb45-305" aria-hidden="true" tabindex="-1"></a>There has been previous literature on what choices of prior on the $\beta$ coefficients for logistic regressions would be appropriate (see <span class="co">[</span><span class="ot">this paper</span><span class="co">](https://projecteuclid.org/journals/annals-of-applied-statistics/volume-2/issue-4/A-weakly-informative-default-prior-distribution-for-logistic-and-other/10.1214/08-AOAS191.full)</span>). $\beta$ coefficients in logistic regression can be relatively large, unlike in normal regression. Therefore, it's pointed out that a heavy tail distribution, like Cauchy and $t$, would be more appropriate. Recent discussions have settled on priors such as $t$ distributions with small degrees of freedom as a good balance between heavy tails and efficiency for MCMC sampling. I use $t_4(4, 0, 2.5)$ for $\beta_0$, which puts more density in <span class="co">[</span><span class="ot">-2.5, 2.5</span><span class="co">]</span> on the log odds unit. This means, in the year 1970, our belief is that the probability of marginally significant results would be somewhere between <span class="in">`r round(plogis(-2.5), 2)`</span> to <span class="in">`r round(plogis(2.5), 2)`</span>, which seems to cover a reasonable range. For $\beta_1$, I use $t_4(4, 0, 1)$, which suggests that a 10-year difference like corresponds to a difference in log odds between -1 and 1. While it's hard to interpret the difference in log odds, a quick rule of thumb is to divide $\beta_1$ by 4, which roughly corresponds to the maximum difference in probability for a unit difference in the predictor. So if $\beta_1$ = 1, the maximum difference in probability will be no more than 25 percentage points. So my prior says that it's unlikely that the probability of reporting marginal $p$ values would increase or decrease by 25 percentage points every 10 years, which again is a weak prior. If you're uncertain, you can consider something weaker.</span>
<span id="cb45-306"><a href="#cb45-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-307"><a href="#cb45-307" aria-hidden="true" tabindex="-1"></a>The priors are chosen to be weakly informative. </span>
<span id="cb45-308"><a href="#cb45-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-311"><a href="#cb45-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-312"><a href="#cb45-312" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">brm</span>(marginal_p <span class="sc">~</span> Year10,</span>
<span id="cb45-313"><a href="#cb45-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> marginalp_dev,</span>
<span id="cb45-314"><a href="#cb45-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb45-315"><a href="#cb45-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb45-316"><a href="#cb45-316" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb45-317"><a href="#cb45-317" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>)</span>
<span id="cb45-318"><a href="#cb45-318" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb45-319"><a href="#cb45-319" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: no sigma</span></span>
<span id="cb45-320"><a href="#cb45-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1340</span>,</span>
<span id="cb45-321"><a href="#cb45-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"10_m4"</span></span>
<span id="cb45-322"><a href="#cb45-322" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-323"><a href="#cb45-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-324"><a href="#cb45-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-325"><a href="#cb45-325" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb45-326"><a href="#cb45-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-327"><a href="#cb45-327" aria-hidden="true" tabindex="-1"></a>In <span class="in">`brms`</span> we used <span class="in">`family = bernoulli()`</span>{.r}. In other R functions, such as <span class="in">`glm`</span>, they do not distinguish between bernoulli and Binomial and only recognize <span class="in">`family = binomial()`</span>{.r}, as a Bernoulli variable is a binomial variable with $n = 1$.</span>
<span id="cb45-328"><a href="#cb45-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-329"><a href="#cb45-329" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-330"><a href="#cb45-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-331"><a href="#cb45-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting the results</span></span>
<span id="cb45-332"><a href="#cb45-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-333"><a href="#cb45-333" aria-hidden="true" tabindex="-1"></a>Any nonlinear relationships will involve more work in interpretations, and the coefficients in logistic regressions are no exception. </span>
<span id="cb45-334"><a href="#cb45-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-335"><a href="#cb45-335" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Posterior predictions</span></span>
<span id="cb45-336"><a href="#cb45-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-337"><a href="#cb45-337" aria-hidden="true" tabindex="-1"></a>A good way to start is to plot the model-implied association on the original unit of the data. The <span class="in">`conditional_effects()`</span> function in <span class="in">`brms`</span> comes in very handy, and I recommend you always start with this:</span>
<span id="cb45-338"><a href="#cb45-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-341"><a href="#cb45-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-342"><a href="#cb45-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-condeff-m4</span></span>
<span id="cb45-343"><a href="#cb45-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Predicted probabilities of marginal significant results over time.</span></span>
<span id="cb45-344"><a href="#cb45-344" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb45-345"><a href="#cb45-345" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m4, <span class="at">prob =</span> .<span class="dv">90</span>),</span>
<span id="cb45-346"><a href="#cb45-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-347"><a href="#cb45-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_args =</span> <span class="fu">list</span>(<span class="at">height =</span> <span class="fl">0.01</span>, <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>),</span>
<span id="cb45-348"><a href="#cb45-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb45-349"><a href="#cb45-349" aria-hidden="true" tabindex="-1"></a>)[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb45-350"><a href="#cb45-350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb45-351"><a href="#cb45-351" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb45-352"><a href="#cb45-352" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1970"</span>, <span class="st">"1980"</span>, <span class="st">"1990"</span>, <span class="st">"2000"</span>, <span class="st">"2010"</span>)</span>
<span id="cb45-353"><a href="#cb45-353" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb45-354"><a href="#cb45-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Year"</span>)</span>
<span id="cb45-355"><a href="#cb45-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-356"><a href="#cb45-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-357"><a href="#cb45-357" aria-hidden="true" tabindex="-1"></a>As you can see, the logistic model implies a somewhat nonlinear association between <span class="in">`Year10`</span> and the outcome. From the graph, when <span class="in">`Year10`</span> = 2, which is the Year 1990, the predicted probability of marginal significant results is about 25%, with a 90% credible interval of about 21 to 28%. We can get that using</span>
<span id="cb45-358"><a href="#cb45-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-361"><a href="#cb45-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-362"><a href="#cb45-362" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_epred</span>(m4, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">Year10 =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb45-363"><a href="#cb45-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>()</span>
<span id="cb45-364"><a href="#cb45-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-365"><a href="#cb45-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-366"><a href="#cb45-366" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Intercept</span></span>
<span id="cb45-367"><a href="#cb45-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-368"><a href="#cb45-368" aria-hidden="true" tabindex="-1"></a>From the equation, when all predictors are zero, we have</span>
<span id="cb45-369"><a href="#cb45-369" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-370"><a href="#cb45-370" aria-hidden="true" tabindex="-1"></a>\mathrm{logit}(\mu_i) = \beta_0.</span>
<span id="cb45-371"><a href="#cb45-371" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-372"><a href="#cb45-372" aria-hidden="true" tabindex="-1"></a>Therefore, the intercept is the log odds that a study reported a marginally significant $p$ value when <span class="in">`Year10`</span> = 0 (i.e, in 1970), which was estimated to be <span class="in">`r get_mean_ci(1, summarize_draws(m4))`</span>. As log odds are not as intuitive as probability, it is common to interpret instead $\hat{\mu} = \mathrm{logistic}(\beta_0)$, which is the conditional probability of being <span class="in">`marginal_p`</span> = 1 in 1970. For Bayesian, that means obtaining the posterior distribution of $\mathrm{logistic}(\beta_0)$, which can be done by</span>
<span id="cb45-373"><a href="#cb45-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-376"><a href="#cb45-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-377"><a href="#cb45-377" aria-hidden="true" tabindex="-1"></a>m4_draws <span class="ot">&lt;-</span> <span class="fu">as_draws</span>(m4)</span>
<span id="cb45-378"><a href="#cb45-378" aria-hidden="true" tabindex="-1"></a>m4_draws <span class="ot">&lt;-</span> m4_draws <span class="sc">|&gt;</span></span>
<span id="cb45-379"><a href="#cb45-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="at">logistic_beta0 =</span> <span class="fu">plogis</span>(b_Intercept))</span>
<span id="cb45-380"><a href="#cb45-380" aria-hidden="true" tabindex="-1"></a>m4_draws <span class="sc">|&gt;</span></span>
<span id="cb45-381"><a href="#cb45-381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">variable =</span> <span class="st">"logistic_beta0"</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-382"><a href="#cb45-382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span>
<span id="cb45-383"><a href="#cb45-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-384"><a href="#cb45-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-385"><a href="#cb45-385" aria-hidden="true" tabindex="-1"></a>The <span class="in">`bayesplot`</span> package allows you to plot transformed parameters quickly:</span>
<span id="cb45-386"><a href="#cb45-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-389"><a href="#cb45-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-390"><a href="#cb45-390" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(m4, <span class="at">pars =</span> <span class="st">"b_Intercept"</span>,</span>
<span id="cb45-391"><a href="#cb45-391" aria-hidden="true" tabindex="-1"></a>           <span class="at">transformations =</span> <span class="fu">list</span>(<span class="st">"b_Intercept"</span> <span class="ot">=</span> <span class="st">"plogis"</span>),</span>
<span id="cb45-392"><a href="#cb45-392" aria-hidden="true" tabindex="-1"></a>           <span class="at">bw =</span> <span class="st">"SJ"</span>)</span>
<span id="cb45-393"><a href="#cb45-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-394"><a href="#cb45-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-395"><a href="#cb45-395" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpreting $\exp(\beta_1)$ as odds ratio</span></span>
<span id="cb45-396"><a href="#cb45-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-397"><a href="#cb45-397" aria-hidden="true" tabindex="-1"></a>The slope, $\beta_1$, represents the difference in the predicted log odds between two observations with a unit difference in the predictor. For example, for two individuals with a unit difference in <span class="in">`Year10`</span> (i.e., 10 years), we have</span>
<span id="cb45-398"><a href="#cb45-398" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-399"><a href="#cb45-399" aria-hidden="true" tabindex="-1"></a>\mathrm{logit}(\mu_{\text{marginal<span class="sc">\_</span>p} = 1}) - </span>
<span id="cb45-400"><a href="#cb45-400" aria-hidden="true" tabindex="-1"></a>  \mathrm{logit}(\mu_{\text{marginal<span class="sc">\_</span>p} = 0}) = \beta_1.</span>
<span id="cb45-401"><a href="#cb45-401" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-402"><a href="#cb45-402" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-403"><a href="#cb45-403" aria-hidden="true" tabindex="-1"></a>Again, the difference in log odds are hard to interpret, so we will exponentiate to get</span>
<span id="cb45-404"><a href="#cb45-404" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-405"><a href="#cb45-405" aria-hidden="true" tabindex="-1"></a>\frac{\mathrm{odds}_{\text{marginal<span class="sc">\_</span>p} = 1}}</span>
<span id="cb45-406"><a href="#cb45-406" aria-hidden="true" tabindex="-1"></a>       {\mathrm{odds}_{\text{marginal<span class="sc">\_</span>p} = 0}} = \exp(\beta_1).</span>
<span id="cb45-407"><a href="#cb45-407" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb45-408"><a href="#cb45-408" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb45-409"><a href="#cb45-409" aria-hidden="true" tabindex="-1"></a>The fraction on the left-hand side is the *odds ratio* of reporting a marginal $p$ value associated with a unit difference in <span class="in">`Year10`</span> (i.e., 10 years). An odds of 1.0 means that the probability of success and failure is equal; an odds &gt; 1 means success is more likely than failures; and an odds &lt; 1 means success is less likely than failures. Again, for Bayesian, we can obtain the</span>
<span id="cb45-410"><a href="#cb45-410" aria-hidden="true" tabindex="-1"></a>posterior distribution of $\exp(\beta_1)$ by</span>
<span id="cb45-411"><a href="#cb45-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-414"><a href="#cb45-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-415"><a href="#cb45-415" aria-hidden="true" tabindex="-1"></a>m4_draws <span class="ot">&lt;-</span> m4_draws <span class="sc">|&gt;</span></span>
<span id="cb45-416"><a href="#cb45-416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="at">exp_beta1 =</span> <span class="fu">exp</span>(b_Year10))</span>
<span id="cb45-417"><a href="#cb45-417" aria-hidden="true" tabindex="-1"></a>m4_draws <span class="sc">|&gt;</span></span>
<span id="cb45-418"><a href="#cb45-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">variable =</span> <span class="st">"exp_beta1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-419"><a href="#cb45-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span>
<span id="cb45-420"><a href="#cb45-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-421"><a href="#cb45-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-424"><a href="#cb45-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-425"><a href="#cb45-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb45-426"><a href="#cb45-426" aria-hidden="true" tabindex="-1"></a>m4_summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(m4_draws)</span>
<span id="cb45-427"><a href="#cb45-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-428"><a href="#cb45-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-429"><a href="#cb45-429" aria-hidden="true" tabindex="-1"></a>Using the posterior mean, we predict that the odds of reporting a marginal $p$ value for a study that is 10 years later is multiplied by <span class="in">`r get_mean_ci(7, m4_summ, unit = " times")`</span>; in other words, every 10 years, the odds increased by <span class="in">`r (m4_summ[["mean"]][7] - 1) * 100`</span>%. Here's the posterior density plot for the odds ratio:</span>
<span id="cb45-430"><a href="#cb45-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-433"><a href="#cb45-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-434"><a href="#cb45-434" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(m4, <span class="at">pars =</span> <span class="st">"b_Year10"</span>,</span>
<span id="cb45-435"><a href="#cb45-435" aria-hidden="true" tabindex="-1"></a>           <span class="at">transformations =</span> <span class="fu">list</span>(<span class="st">"b_Year10"</span> <span class="ot">=</span> <span class="st">"exp"</span>),</span>
<span id="cb45-436"><a href="#cb45-436" aria-hidden="true" tabindex="-1"></a>           <span class="at">bw =</span> <span class="st">"SJ"</span>)</span>
<span id="cb45-437"><a href="#cb45-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-438"><a href="#cb45-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-439"><a href="#cb45-439" aria-hidden="true" tabindex="-1"></a>Odds ratio (OR) is popular as the multiplicative effect is constant, thus making interpretations easier. Also, in medical research and some other research areas, OR can be an excellent approximation of the relative risk, which is the probability ratio of two groups, of some rare diseases or events. However, odds and odds ratios are never intuitive metrics for people, and in many situations, a large odds ratio may be misleading as it may represent a very small effect. Therefore, in general, I would recommend you to interpret coefficients in probability units, even though that means more work.</span>
<span id="cb45-440"><a href="#cb45-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-441"><a href="#cb45-441" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpreting Coefficients in Probability Units</span></span>
<span id="cb45-442"><a href="#cb45-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-443"><a href="#cb45-443" aria-hidden="true" tabindex="-1"></a>Another way to interpret the results of the logistic regression coefficient is to examine the change in probability. Because the predicted probability is a nonlinear function of the predictors, a unit difference in the predictor has different meanings depending on the values of $X$ you chose for interpretations. You can see that in the <span class="in">`conditional_effects()`</span> plot earlier.</span>
<span id="cb45-444"><a href="#cb45-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-445"><a href="#cb45-445" aria-hidden="true" tabindex="-1"></a>Consider the change in the predicted probability of reporting a marginal $p$ value with <span class="in">`Year10`</span> = 0 (1970), <span class="in">`Year10`</span> = 1 (1980), to <span class="in">`Year10`</span> = 4, respectively:</span>
<span id="cb45-446"><a href="#cb45-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-449"><a href="#cb45-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-450"><a href="#cb45-450" aria-hidden="true" tabindex="-1"></a>m4_pred <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(m4, <span class="fu">list</span>(<span class="at">Year10 =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb45-451"><a href="#cb45-451" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m4_pred) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Year10="</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb45-452"><a href="#cb45-452" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise_draws</span>(m4_pred)</span>
<span id="cb45-453"><a href="#cb45-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-454"><a href="#cb45-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-455"><a href="#cb45-455" aria-hidden="true" tabindex="-1"></a>As you can see, the predicted difference in probability is smaller when comparing <span class="in">`Year10`</span> = 0 and 1, but is larger when comparing <span class="in">`Year10`</span> = 3 and 4.</span>
<span id="cb45-456"><a href="#cb45-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-457"><a href="#cb45-457" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb45-458"><a href="#cb45-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-459"><a href="#cb45-459" aria-hidden="true" tabindex="-1"></a><span class="fu">## The "divide by 4 rule"</span></span>
<span id="cb45-460"><a href="#cb45-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-461"><a href="#cb45-461" aria-hidden="true" tabindex="-1"></a>A quick approximation is to divide the coefficient by 4 to get an upper bound on the change in probability associated with a unit change in the predictor. In our example, this corresponds to <span class="in">`r fixef(m4)[2]`</span> / 4 = <span class="in">`r fixef(m4)[2] / 4`</span>, which is very close to the predicted difference in probability from <span class="in">`Year10`</span> = 3 to <span class="in">`Year10`</span> = 4.</span>
<span id="cb45-462"><a href="#cb45-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-463"><a href="#cb45-463" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-464"><a href="#cb45-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-465"><a href="#cb45-465" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior Predictive Check</span></span>
<span id="cb45-466"><a href="#cb45-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-469"><a href="#cb45-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-470"><a href="#cb45-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ppc-m4</span></span>
<span id="cb45-471"><a href="#cb45-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior Predictive Check for the binary logistic model."</span></span>
<span id="cb45-472"><a href="#cb45-472" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(</span>
<span id="cb45-473"><a href="#cb45-473" aria-hidden="true" tabindex="-1"></a>    m4,</span>
<span id="cb45-474"><a href="#cb45-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"error_binned"</span></span>
<span id="cb45-475"><a href="#cb45-475" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-476"><a href="#cb45-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-477"><a href="#cb45-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-478"><a href="#cb45-478" aria-hidden="true" tabindex="-1"></a>The linear model is not the best fit.</span>
<span id="cb45-479"><a href="#cb45-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-480"><a href="#cb45-480" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear Spline</span></span>
<span id="cb45-481"><a href="#cb45-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-482"><a href="#cb45-482" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`bs()`</span> to specify a linear spline (degree = 1) with one turning point (knots = 3). </span>
<span id="cb45-483"><a href="#cb45-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-486"><a href="#cb45-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-487"><a href="#cb45-487" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb45-488"><a href="#cb45-488" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">brm</span>(marginal_p <span class="sc">~</span> <span class="fu">bs</span>(Year10, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">knots =</span> <span class="dv">3</span>),</span>
<span id="cb45-489"><a href="#cb45-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> marginalp_dev,</span>
<span id="cb45-490"><a href="#cb45-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb45-491"><a href="#cb45-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, .<span class="dv">875</span>), <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb45-492"><a href="#cb45-492" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: no sigma</span></span>
<span id="cb45-493"><a href="#cb45-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1340</span>,</span>
<span id="cb45-494"><a href="#cb45-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"10_m5"</span></span>
<span id="cb45-495"><a href="#cb45-495" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-496"><a href="#cb45-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-497"><a href="#cb45-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-498"><a href="#cb45-498" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior Prediction</span></span>
<span id="cb45-499"><a href="#cb45-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-502"><a href="#cb45-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-503"><a href="#cb45-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-condeff-m5</span></span>
<span id="cb45-504"><a href="#cb45-504" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Predicted probabilities of marginal significant results over time with the spline model.</span></span>
<span id="cb45-505"><a href="#cb45-505" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb45-506"><a href="#cb45-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m5),</span>
<span id="cb45-507"><a href="#cb45-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-508"><a href="#cb45-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_args =</span> <span class="fu">list</span>(<span class="at">height =</span> <span class="fl">0.01</span>, <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb45-509"><a href="#cb45-509" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-510"><a href="#cb45-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-511"><a href="#cb45-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-514"><a href="#cb45-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-515"><a href="#cb45-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ppc-m5</span></span>
<span id="cb45-516"><a href="#cb45-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior Predictive Check for the binary logistic model with a linear spline."</span></span>
<span id="cb45-517"><a href="#cb45-517" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(</span>
<span id="cb45-518"><a href="#cb45-518" aria-hidden="true" tabindex="-1"></a>    m5,</span>
<span id="cb45-519"><a href="#cb45-519" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"error_binned"</span>,</span>
<span id="cb45-520"><a href="#cb45-520" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year10"</span></span>
<span id="cb45-521"><a href="#cb45-521" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-522"><a href="#cb45-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-523"><a href="#cb45-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-524"><a href="#cb45-524" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Comparison</span></span>
<span id="cb45-525"><a href="#cb45-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-528"><a href="#cb45-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-529"><a href="#cb45-529" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="at">linear =</span> m4, <span class="st">`</span><span class="at">linear spline</span><span class="st">`</span> <span class="ot">=</span> m5),</span>
<span id="cb45-530"><a href="#cb45-530" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb45-531"><a href="#cb45-531" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="cn">NULL</span>, <span class="at">fmt =</span> <span class="dv">2</span>)</span>
<span id="cb45-532"><a href="#cb45-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-533"><a href="#cb45-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-534"><a href="#cb45-534" aria-hidden="true" tabindex="-1"></a>The linear spline is better according to the information criteria.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Hok Chio (Mark) Lai</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>9&nbsp; Multiple Predictors – PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06c-regression-diagnostics.html" rel="next">
<link href="./06-linear-models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-225295148', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="site_libs/plotly-binding-4.10.4/plotly.js"></script><script src="site_libs/typedarray-0.1/typedarray.min.js"></script><script src="site_libs/jquery-3.5.1/jquery.min.js"></script><link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PSYC 573 Bayesian Data Analysis (2024 Fall): Course Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../modules.html"> 
<span class="menu-text">Modules</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../docs/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../exercises/index.html"> 
<span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../syllabus/index.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/marklhc/usc-psyc573-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./PSYC-573-Bayesian-Data-Analysis--2024-Fall---Course-Notes.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-linear-models.html">Week 5</a></li><li class="breadcrumb-item"><a href="./06b-multiple-predictors.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bayes-theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayes’s Theorem</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-beta-bernoulli-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04b-beta-bernoulli-stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Beta-Bernoulli Model With Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04c-poisson-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Poisson Model</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-hierarchical-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06b-multiple-predictors.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06c-regression-diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-stacking-and-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stacking, Regularization, and Variable Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#stratified-analysis" id="toc-stratified-analysis" class="nav-link active" data-scroll-target="#stratified-analysis"><span class="header-section-number">9.1</span> Stratified Analysis</a></li>
  <li>
<a href="#introducing-the-brms-package" id="toc-introducing-the-brms-package" class="nav-link" data-scroll-target="#introducing-the-brms-package"><span class="header-section-number">9.2</span> Introducing the <code>brms</code> package</a>
  <ul class="collapse">
<li><a href="#model-formula" id="toc-model-formula" class="nav-link" data-scroll-target="#model-formula">Model formula</a></li>
  <li><a href="#setting-priors" id="toc-setting-priors" class="nav-link" data-scroll-target="#setting-priors">Setting Priors</a></li>
  </ul>
</li>
  <li><a href="#additive-model" id="toc-additive-model" class="nav-link" data-scroll-target="#additive-model"><span class="header-section-number">9.3</span> Additive Model</a></li>
  <li>
<a href="#interaction-model-different-slopes-across-two-groups" id="toc-interaction-model-different-slopes-across-two-groups" class="nav-link" data-scroll-target="#interaction-model-different-slopes-across-two-groups"><span class="header-section-number">9.4</span> Interaction Model: Different Slopes Across Two Groups</a>
  <ul class="collapse">
<li><a href="#posterior-predictive-checks" id="toc-posterior-predictive-checks" class="nav-link" data-scroll-target="#posterior-predictive-checks"><span class="header-section-number">9.4.1</span> Posterior predictive checks</a></li>
  <li><a href="#conditional-effectssimple-slopes" id="toc-conditional-effectssimple-slopes" class="nav-link" data-scroll-target="#conditional-effectssimple-slopes"><span class="header-section-number">9.4.2</span> Conditional effects/simple slopes</a></li>
  </ul>
</li>
  <li><a href="#interaction-of-continuous-predictors" id="toc-interaction-of-continuous-predictors" class="nav-link" data-scroll-target="#interaction-of-continuous-predictors"><span class="header-section-number">9.5</span> Interaction of Continuous Predictors</a></li>
  <li><a href="#centering" id="toc-centering" class="nav-link" data-scroll-target="#centering"><span class="header-section-number">9.6</span> Centering</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-linear-models.html">Week 5</a></li><li class="breadcrumb-item"><a href="./06b-multiple-predictors.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multiple Predictors</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Here, we’ll use an example from <span class="citation" data-cites="mcelreath2020">McElreath (<a href="references.html#ref-mcelreath2020" role="doc-biblioref">2020</a>)</span>, which contains some marriage and demographic statistics for the individual states in the United States. See <a href="https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html" class="uri">https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</a> for more details.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"data/WaffleDivorce.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>        <span class="st">"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/WaffleDivorce.csv"</span>,</span>
<span>        <span class="st">"data/WaffleDivorce.csv"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">waffle_divorce</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span>  <span class="co"># read delimited files</span></span>
<span>    <span class="st">"data/WaffleDivorce.csv"</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">";"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Rescale Marriage and Divorce by dividing by 10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Marriage</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Marriage</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Divorce</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">Divorce</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">MedianAgeMarriage</span> <span class="op">&lt;-</span> <span class="va">waffle_divorce</span><span class="op">$</span><span class="va">MedianAgeMarriage</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="co"># Recode `South` to a factor variable</span></span>
<span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">South</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">waffle_divorce</span><span class="op">$</span><span class="va">South</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"non-south"</span>, <span class="st">"south"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># See data description at https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="stratified-analysis" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="stratified-analysis">
<span class="header-section-number">9.1</span> Stratified Analysis</h2>
<p>Let’s consider whether the association between <code>MedianAgeMarriage</code> and <code>Divorce</code> differs between Southern and non-Southern states. Because (and <strong>only because</strong>) the groups are <strong>independent</strong>, we can fit a linear regression for each subset of states.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">waffle_divorce</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">MedianAgeMarriage</span>, y <span class="op">=</span> <span class="va">Divorce</span>, col <span class="op">=</span> <span class="va">South</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Median age marriage (10 years)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Divorce rate (per 10 adults)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">Loc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-waffle-divorce" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-waffle-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-waffle-divorce-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-waffle-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.1: State-level association between median age of marriage and divorce rate.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="introducing-the-brms-package" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="introducing-the-brms-package">
<span class="header-section-number">9.2</span> Introducing the <code>brms</code> package</h2>
<p>While Stan is very flexible, because the linear model and some related models are so widely used, some authors have created packages that would further simplify the fitting of such models. One of those packages is <code>brms</code>, which I believe stands for “Bayesian regression models with Stan.” It allows one to do MCMC sampling using Stan, but with syntax similar to that in R functions <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>, and <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer()</a></code>. <code>brms</code> probably supports more models than any R packages that statisticians routinely used; there are models, like factor analysis, that are not directly supported. If you came across some fancy regression models, chances are you can do something similar in <code>brms</code>. You can find some resources for learning <code>brms</code> on this page: <a href="https://paul-buerkner.github.io/brms/" class="uri">https://paul-buerkner.github.io/brms/</a>.</p>
<section id="model-formula" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="model-formula">Model formula</h3>
<p><code>brms</code> comes with some default prior options, but I recommend you always check what priors are used and think about whether they make sense for your data. You can use <code>get_priors()</code> to show the default priors used in <code>brms</code>.</p>
<p>To do MCMC sampling, we use the <code>brm()</code> function. The first argument is a formula in R. The variable before <code>~</code> is the outcome, whereas the ones after <code>~</code> are the predictors. For example,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">growth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>means the model</p>
<p><span class="math display">\[
E(\text{vote}_i) = \beta_0 (1) + \beta_1 (\text{growth}_i).
\]</span></p>
<p>Usually, I write <code class="sourceCode r">vote <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> growth</code> as <code class="sourceCode r">vote <span class="sc">~</span> growth</code>, as the <code>1 +</code> part is automatically added.</p>
</section><section id="setting-priors" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="setting-priors">Setting Priors</h3>
<p><code>brms</code> comes with some default prior options, but over the years, the package maintainers have changed those priors, so the default today may be different from the one next year. Therefore, you should always check what priors are used and think about whether they make sense for your data. You can use <code>get_priors()</code> to show the default priors used in <code>brms</code>. For example,</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">get_prior</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>          data <span class="op">=</span> <span class="va">waffle_divorce</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["prior"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["coef"],"name":[3],"type":["chr"],"align":["left"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]},{"label":["resp"],"name":[5],"type":["chr"],"align":["left"]},{"label":["dpar"],"name":[6],"type":["chr"],"align":["left"]},{"label":["nlpar"],"name":[7],"type":["chr"],"align":["left"]},{"label":["lb"],"name":[8],"type":["chr"],"align":["left"]},{"label":["ub"],"name":[9],"type":["chr"],"align":["left"]},{"label":["source"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"","2":"b","3":"","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"","2":"b","3":"MedianAgeMarriage","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 1, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sigma","3":"","4":"","5":"","6":"","7":"","8":"0","9":"","10":"default"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_nonsouth</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">brm</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>        <span class="co"># Filter `waffle_divorce` to only include non-southern states</span></span>
<span>        data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">waffle_divorce</span>, <span class="va">South</span> <span class="op">==</span> <span class="st">"non-south"</span><span class="op">)</span>,</span>
<span>        <span class="co"># Use N(0, 2) and N(0, 10) as priors for beta1 and beta0,</span></span>
<span>        <span class="co"># and use t_4(0, 3) as a prior for sigma</span></span>
<span>        prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">+</span>          </span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span> <span class="op">+</span>     </span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,     </span>
<span>        seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>        iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>        file <span class="op">=</span> <span class="st">"m_nonsouth"</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_south</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">brm</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>        data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">waffle_divorce</span>, <span class="va">South</span> <span class="op">==</span> <span class="st">"south"</span><span class="op">)</span>,</span>
<span>        prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>        seed <span class="op">=</span> <span class="fl">2157</span>,  <span class="co"># use a different seed</span></span>
<span>        iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>        file <span class="op">=</span> <span class="st">"m_south"</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make a table like <a href="#tbl-example2" class="quarto-xref">Table&nbsp;<span>9.1</span></a> for <code>brms</code> results using the <code class="sourceCode r">modelsummary<span class="sc">::</span><span class="fu">msummary</span>()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">msummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>South <span class="op">=</span> <span class="va">m_south</span>, `Non-South` <span class="op">=</span> <span class="va">m_nonsouth</span><span class="op">)</span>,</span>
<span>         estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>         statistic <span class="op">=</span> <span class="cn">NULL</span>, fmt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         gof_omit <span class="op">=</span> <span class="st">"^(?!Num)"</span>  <span class="co"># only include number of observations</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 
`modelsummary` uses the `performance` package to extract goodness-of-fit
statistics from models of this class. You can specify the statistics you wish
to compute by supplying a `metrics` argument to `modelsummary`, which will then
push it forward to `performance`. Acceptable values are: "all", "common",
"none", or a character vector of metrics names. For example: `modelsummary(mod,
metrics = c("RMSE", "R2")` Note that some metrics are computationally
expensive. See `?performance::performance` for details.
 This warning appears once per session.</code></pre>
</div>
<div id="tbl-example2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9.1: Intercepts and slopes for south and non-south states.
</figcaption><div aria-describedby="tbl-example2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">South</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Non-South</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: center;">6.09 [3.60, 8.45]</td>
<td style="text-align: center;">2.74 [1.75, 3.74]</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_MedianAgeMarriage</td>
<td style="text-align: center;">−1.96 [−2.89, −0.98]</td>
<td style="text-align: center;">−0.69 [−1.07, −0.31]</td>
</tr>
<tr class="odd">
<td style="text-align: left; box-shadow: 0px 1.5px;">sigma</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">0.11 [0.07, 0.17]</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">0.15 [0.12, 0.20]</td>
</tr>
<tr class="even">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">36</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>We can now ask two questions:</p>
<ul>
<li>Is the intercept different across southern and non-southern states?</li>
<li>Is the slope different across southern and non-southern states?</li>
</ul>
<p>The correct way to answer the above questions is to obtain the posterior distribution of the <strong>difference</strong> in the coefficients. Repeat: obtain the posterior distribution of the <strong>difference</strong>. The incorrect way is to compare whether the CIs overlap.</p>
<p>Here are the posteriors of the differences (<span class="math inline">\(\beta_0^\text{south} - \beta_0^\text{nonsouth}\)</span> and <span class="math inline">\(\beta_1^\text{south} - \beta_1^\text{nonsouth}\)</span>):</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract draws</span></span>
<span><span class="va">draws_south</span> <span class="op">&lt;-</span> <span class="fu">as_draws_matrix</span><span class="op">(</span><span class="va">m_south</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_Intercept"</span>, <span class="st">"b_MedianAgeMarriage"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">draws_nonsouth</span> <span class="op">&lt;-</span> <span class="fu">as_draws_matrix</span><span class="op">(</span><span class="va">m_nonsouth</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_Intercept"</span>, <span class="st">"b_MedianAgeMarriage"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Difference in coefficients</span></span>
<span><span class="va">draws_diff</span> <span class="op">&lt;-</span> <span class="va">draws_south</span> <span class="op">-</span> <span class="va">draws_nonsouth</span></span>
<span><span class="co"># Rename the columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">draws_diff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">draws_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Summarize</span></span>
<span><span class="fu">summarize_draws</span><span class="op">(</span><span class="va">draws_diff</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-diff" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9.2: Difference in intercept and slope for south and non-south states.
</figcaption><div aria-describedby="tbl-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 26%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">db_Intercept</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: right;">1.34</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">1.14</td>
<td style="text-align: right;">5.45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6115.12</td>
<td style="text-align: right;">5017.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">db_MedianAgeMarriage</td>
<td style="text-align: right;">-1.26</td>
<td style="text-align: right;">-1.27</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-2.09</td>
<td style="text-align: right;">-0.41</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6112.20</td>
<td style="text-align: right;">5034.56</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>As you can see, the southern states have a higher intercept and a lower slope.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m_nonsouth</span><span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Non-South"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m_south</span><span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"South"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1.4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-south-vs-nonsouth" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-south-vs-nonsouth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-south-vs-nonsouth" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-south-vs-nonsouth-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-south-vs-nonsouth-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-south-vs-nonsouth-1.png" class="img-fluid figure-img" data-ref-parent="fig-south-vs-nonsouth" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-south-vs-nonsouth-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Non-southern states
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-south-vs-nonsouth" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-south-vs-nonsouth-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-south-vs-nonsouth-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-south-vs-nonsouth-2.png" class="img-fluid figure-img" data-ref-parent="fig-south-vs-nonsouth" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-south-vs-nonsouth-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Southern states
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-south-vs-nonsouth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.2: Model-implied regression lines
</figcaption></figure>
</div>
</section></section><section id="additive-model" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="additive-model">
<span class="header-section-number">9.3</span> Additive Model</h2>
<p>An additive model assumes that the difference between predicted <span class="math inline">\(Y\)</span> for two levels of <span class="math inline">\(X_1\)</span> is the same regardless of the level of <span class="math inline">\(X_2\)</span>. In our example, we assume that the predicted difference in divorce rate associated with the median age of marriage does not depend on whether the state is southern or not. Equivalently, we assume that the predicted difference in Southern and non-Southern states does not depend on the median age of marriage.</p>
<p><span class="math display">\[
\begin{aligned}
  D_i &amp; \sim N(\mu_i, \sigma)  \\
  \mu_i &amp; = \beta_0 + \beta_1 S_i + \beta_2 A_i \\
  \beta_0 &amp; \sim N(0, 10) \\
  \beta_1 &amp; \sim N(0, 10) \\
  \beta_2 &amp; \sim N(0, 1)  \\
  \sigma &amp; \sim t^+_4(0, 3)
\end{aligned}
\]</span></p>
<ul>
<li>
<span class="math inline">\(\beta_1\)</span>: Expected difference in divorce rate between southern and non-southern states.</li>
<li>
<span class="math inline">\(\beta_2\)</span>: Expected difference in divorce rate for one unit difference in median age of marriage.</li>
</ul>
<p>In the model, the variable S, southern state, is a dummy variable with 0 = non-southern and 1 = southern. Therefore,</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dummy Coding
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>For non-southern states, <span class="math inline">\(\mu = (\beta_0) + (\beta_2) A\)</span>;</li>
<li>For southern states, <span class="math inline">\(\mu = (\beta_0 + \beta_1) + \beta_2 A\)</span>
</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_additive</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>    <span class="va">Divorce</span> <span class="op">~</span> <span class="va">South</span> <span class="op">+</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>    data <span class="op">=</span> <span class="va">waffle_divorce</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, coef <span class="op">=</span> <span class="st">"Southsouth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"m_additive"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_additive</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: Divorce ~ South + MedianAgeMarriage 
   Data: waffle_divorce (Number of observations: 50) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Population-Level Effects: 
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept             3.00      0.46     2.10     3.89 1.00     7435     5360
Southsouth            0.08      0.05    -0.01     0.18 1.00     7847     5519
MedianAgeMarriage    -0.79      0.18    -1.13    -0.45 1.00     7406     5423

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.15      0.02     0.12     0.18 1.00     7217     5426

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section><section id="interaction-model-different-slopes-across-two-groups" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="interaction-model-different-slopes-across-two-groups">
<span class="header-section-number">9.4</span> Interaction Model: Different Slopes Across Two Groups</h2>
<p>An alternative is to include an interaction term</p>
<p><span class="math display">\[
\begin{aligned}
  D_i &amp; \sim N(\mu_i, \sigma)  \\
  \mu_i &amp; = \beta_0 + \beta_1 S_i + \beta_2 A_i + \beta_3 S_i \times A_i \\
  \beta_0 &amp; \sim N(0, 10) \\
  \beta_1 &amp; \sim N(0, 10) \\
  \beta_2 &amp; \sim N(0, 1) \\
  \beta_3 &amp; \sim N(0, 2) \\
  \sigma &amp; \sim t^+_4(0, 3)
\end{aligned}
\]</span></p>
<ul>
<li>
<span class="math inline">\(\beta_1\)</span>: Difference in intercept between southern and non-southern states.</li>
<li>
<span class="math inline">\(\beta_3\)</span>: Difference in the coefficient for A → D between southern and non-southern states</li>
</ul>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dummy Coding in Interaction Model
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>For non-southern states, <span class="math inline">\(\mu = (\beta_0) + (\beta_2) A\)</span>;</li>
<li>For southern states, <span class="math inline">\(\mu = (\beta_0 + \beta_1) + (\beta_2 + \beta_3) A\)</span>
</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_inter</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>    <span class="va">Divorce</span> <span class="op">~</span> <span class="va">South</span> <span class="op">*</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>    data <span class="op">=</span> <span class="va">waffle_divorce</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, coef <span class="op">=</span> <span class="st">"Southsouth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">prior</span><span class="op">(</span><span class="fu">student_t</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"m_inter"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The formula <code class="sourceCode r">Divorce <span class="sc">~</span> South <span class="sc">*</span> MedianAgeMarriage</code> is the same as</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">South</span> <span class="op">+</span> <span class="va">MedianAgeMarriage</span> <span class="op">+</span> <span class="va">South</span><span class="op">:</span><span class="va">MedianAgeMarriage</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>:</code> is the symbol in R for a product term.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Print summary of the model</span></span>
<span><span class="va">m_inter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: Divorce ~ South * MedianAgeMarriage 
   Data: waffle_divorce (Number of observations: 50) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Population-Level Effects: 
                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
Intercept                        2.78      0.46     1.87     3.68 1.00     4716
Southsouth                       3.20      1.60     0.19     6.30 1.00     2863
MedianAgeMarriage               -0.70      0.18    -1.05    -0.35 1.00     4714
Southsouth:MedianAgeMarriage    -1.22      0.62    -2.42    -0.03 1.00     2876
                             Tail_ESS
Intercept                        4042
Southsouth                       3608
MedianAgeMarriage                4085
Southsouth:MedianAgeMarriage     3584

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.14      0.02     0.12     0.18 1.00     4244     4998

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<section id="posterior-predictive-checks" class="level3" data-number="9.4.1"><h3 data-number="9.4.1" class="anchored" data-anchor-id="posterior-predictive-checks">
<span class="header-section-number">9.4.1</span> Posterior predictive checks</h3>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check density (normality)</span></span>
<span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m_inter</span>, type <span class="op">=</span> <span class="st">"dens_overlay_grouped"</span>, group <span class="op">=</span> <span class="st">"South"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using 10 posterior draws for ppc type 'dens_overlay_grouped' by default.</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check prediction (a few outliers)</span></span>
<span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m_inter</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"ribbon_grouped"</span>, x <span class="op">=</span> <span class="st">"MedianAgeMarriage"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"South"</span>,</span>
<span>    y_draw <span class="op">=</span> <span class="st">"points"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'ribbon_grouped' by default.</code></pre>
</div>
<div id="fig-pp-check-inter" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pp-check-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="fig-pp-check-inter-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-pp-check-inter-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-pp-check-inter-1.png" class="img-fluid figure-img" data-ref-parent="fig-pp-check-inter" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-pp-check-inter-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Density overlayed plots
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-pp-check-inter-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-pp-check-inter-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-pp-check-inter-2.png" class="img-fluid figure-img" data-ref-parent="fig-pp-check-inter" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-pp-check-inter-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Prediction intervals
</figcaption></figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pp-check-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.3: Posterior predictive checks for the interaction model.
</figcaption></figure>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check errors (no clear pattern)</span></span>
<span><span class="fu">pp_check</span><span class="op">(</span><span class="va">m_inter</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"error_scatter_avg_vs_x"</span>, x <span class="op">=</span> <span class="st">"MedianAgeMarriage"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'error_scatter_avg_vs_x' by default.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-error-plot-inter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-error-plot-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-error-plot-inter-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-error-plot-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.4: Average prediction error against the predictor. No clear pattern should be observed for a correctly specified model.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="conditional-effectssimple-slopes" class="level3" data-number="9.4.2"><h3 data-number="9.4.2" class="anchored" data-anchor-id="conditional-effectssimple-slopes">
<span class="header-section-number">9.4.2</span> Conditional effects/simple slopes</h3>
<p>Slope of <code>MedianAgeMarriage</code> when South = 0: <span class="math inline">\(\beta_1\)</span></p>
<p>Slope of <code>MedianAgeMarriage</code> when South = 1: <span class="math inline">\(\beta_1 + \beta_3\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">as_draws</span><span class="op">(</span><span class="va">m_inter</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate_variables</span><span class="op">(</span></span>
<span>        b_nonsouth <span class="op">=</span> <span class="va">b_MedianAgeMarriage</span>,</span>
<span>        b_south <span class="op">=</span> <span class="va">b_MedianAgeMarriage</span> <span class="op">+</span> <span class="va">`b_Southsouth:MedianAgeMarriage`</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/subset_draws.html">subset_draws</a></span><span class="op">(</span></span>
<span>        variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_nonsouth"</span>, <span class="st">"b_south"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">summarize_draws</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_nonsouth</td>
<td style="text-align: right;">-0.70</td>
<td style="text-align: right;">-0.71</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">-1.00</td>
<td style="text-align: right;">-0.41</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4713.61</td>
<td style="text-align: right;">4085.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_south</td>
<td style="text-align: right;">-1.92</td>
<td style="text-align: right;">-1.91</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">-2.91</td>
<td style="text-align: right;">-0.93</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3168.15</td>
<td style="text-align: right;">3659.43</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m_inter</span>,</span>
<span>        effects <span class="op">=</span> <span class="st">"MedianAgeMarriage"</span>,</span>
<span>        conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>South <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"south"</span>, <span class="st">"non-south"</span><span class="op">)</span>,</span>
<span>                                cond__ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"South"</span>, <span class="st">"Non-South"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cond-eff-inter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cond-eff-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-cond-eff-inter-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cond-eff-inter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.5: Model-implied simple slopes based on the interaction model.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="interaction-of-continuous-predictors" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="interaction-of-continuous-predictors">
<span class="header-section-number">9.5</span> Interaction of Continuous Predictors</h2>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">waffle_divorce</span>,</span>
<span>                x <span class="op">=</span> <span class="op">~</span><span class="va">Marriage</span>,</span>
<span>                y <span class="op">=</span> <span class="op">~</span><span class="va">MedianAgeMarriage</span>,</span>
<span>                z <span class="op">=</span> <span class="op">~</span><span class="va">Divorce</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter3d' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter3d</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No scatter3d mode specifed:
  Setting the mode to markers
  Read more about this attribute -&gt; https://plotly.com/r/reference/#scatter-mode</code></pre>
</div>
<div id="fig-plotly-divorce" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plotly-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c554694e7a8b813176f6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c554694e7a8b813176f6">{"x":{"visdat":{"3d71ea13fbbb5e":["function () ","plotlyVisDat"]},"cur_data":"3d71ea13fbbb5e","attrs":{"3d71ea13fbbb5e":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Marriage"},"yaxis":{"title":"MedianAgeMarriage"},"zaxis":{"title":"Divorce"}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2.02,2.6000000000000001,2.0300000000000002,2.6399999999999997,1.9100000000000001,2.3500000000000001,1.7100000000000002,2.3100000000000001,1.77,1.7,2.21,2.4899999999999998,2.5800000000000001,1.7899999999999998,1.98,2.1499999999999999,2.21,2.2199999999999998,2.0600000000000001,1.3500000000000001,1.8300000000000001,1.5800000000000001,1.6499999999999999,1.53,1.9300000000000002,1.8600000000000001,1.8500000000000001,1.9600000000000002,1.6699999999999999,1.48,2.04,1.6800000000000002,2.04,2.6699999999999999,1.6899999999999999,2.3799999999999999,1.8899999999999999,1.55,1.5,1.8100000000000001,2.0100000000000002,1.9399999999999999,2.1499999999999999,2.96,1.6399999999999999,2.0499999999999998,2.1399999999999997,2.2199999999999998,1.72,3.0699999999999998],"y":[2.5300000000000002,2.52,2.5800000000000001,2.4300000000000002,2.6800000000000002,2.5699999999999998,2.7600000000000002,2.6600000000000001,2.9699999999999998,2.6399999999999997,2.5899999999999999,2.6899999999999999,2.3199999999999998,2.7000000000000002,2.5699999999999998,2.54,2.5,2.48,2.5899999999999999,2.6399999999999997,2.73,2.8500000000000001,2.6399999999999997,2.6299999999999999,2.5800000000000001,2.5600000000000001,2.5699999999999998,2.54,2.6800000000000002,2.77,2.5800000000000001,2.8399999999999999,2.5699999999999998,2.5300000000000002,2.6299999999999999,2.4399999999999999,2.6000000000000001,2.71,2.8199999999999998,2.6399999999999997,2.5600000000000001,2.52,2.52,2.3300000000000001,2.6899999999999999,2.6399999999999997,2.5899999999999999,2.5,2.6299999999999999,2.4199999999999999],"z":[1.27,1.25,1.0800000000000001,1.3500000000000001,0.80000000000000004,1.1599999999999999,0.67000000000000004,0.89000000000000001,0.63,0.84999999999999998,1.1499999999999999,0.83000000000000007,0.77000000000000002,0.80000000000000004,1.1000000000000001,1.02,1.0600000000000001,1.26,1.1000000000000001,1.3,0.88000000000000012,0.78000000000000003,0.91999999999999993,0.73999999999999999,1.1099999999999999,0.94999999999999996,0.90999999999999992,0.88000000000000012,1.01,0.60999999999999999,1.02,0.65999999999999992,0.98999999999999999,0.80000000000000004,0.94999999999999996,1.28,1.04,0.77000000000000002,0.94000000000000006,0.80999999999999994,1.0900000000000001,1.1400000000000001,1,1.02,0.95999999999999996,0.89000000000000001,1,1.0900000000000001,0.83000000000000007,1.03],"type":"scatter3d","mode":"markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotly-divorce-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.6: 3-D plot visualizing one outcome and two predictors.
</figcaption></figure>
</div>
</div>
<p><span class="math display">\[
\begin{aligned}
  D_i &amp; \sim N(\mu_i, \sigma)  \\
  \mu_i &amp; = \beta_0 + \beta_1 M_i + \beta_2 A_i + \beta_3 M_i \times A_i \\
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use default priors (just for convenience here)</span></span>
<span><span class="va">m_inter2</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="va">Marriage</span> <span class="op">*</span> <span class="va">MedianAgeMarriage</span>,</span>
<span>    data <span class="op">=</span> <span class="va">waffle_divorce</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"m_inter2"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="centering" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="centering">
<span class="header-section-number">9.6</span> Centering</h2>
<p>In the previous model, <span class="math inline">\(\beta_1\)</span> is the slope of M → D when A is 0 (i.e., median marriage age = 0), and <span class="math inline">\(\beta_2\)</span> is the slope of A → D when M is 0 (i.e., marriage rate is 0). These two are not very meaningful. Therefore, it is common to make the zero values more meaningful by doing <em>centering</em>.</p>
<p>Here, I use M - 2 as the predictor, so the zero point means a marriage rate of 2 per 10 adults; I use A - 2.5 as the other predictor, so the zero point means a median marriage rate of 25 years old.</p>
<p><span class="math display">\[
\mu_i = \beta_0 + \beta_1 (M_i - 2) + \beta_2 (A_i - 2.5) + \beta_3 (M_i - 2) \times (A_i - 2.5)
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use default priors (just for convenience here)</span></span>
<span><span class="va">m_inter2c</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">Marriage</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">MedianAgeMarriage</span> <span class="op">-</span> <span class="fl">2.5</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">waffle_divorce</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">941</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>    file <span class="op">=</span> <span class="st">"m_inter2c"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">msummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>`No centering` <span class="op">=</span> <span class="va">m_inter2</span>, `centered` <span class="op">=</span> <span class="va">m_inter2c</span><span class="op">)</span>,</span>
<span>         estimate <span class="op">=</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span>         statistic <span class="op">=</span> <span class="cn">NULL</span>, fmt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">No centering</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">centered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: center;">7.38 [3.02, 11.58]</td>
<td style="text-align: center;">1.09 [1.02, 1.16]</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_Marriage</td>
<td style="text-align: center;">−1.93 [−4.00, 0.16]</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_MedianAgeMarriage</td>
<td style="text-align: center;">−2.45 [−4.07, −0.78]</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">b_Marriage × MedianAgeMarriage</td>
<td style="text-align: center;">0.74 [−0.07, 1.56]</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">sigma</td>
<td style="text-align: center;">0.15 [0.12, 0.18]</td>
<td style="text-align: center;">0.15 [0.12, 0.18]</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_IMarriageM2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.08 [−0.24, 0.09]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_IMedianAgeMarriageM2.5</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.94 [−1.44, −0.44]</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;">b_IMarriageM2 × IMedianAgeMarriageM2.5</td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">0.75 [−0.08, 1.59]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.414</td>
<td style="text-align: center;">0.413</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2 Adj.</td>
<td style="text-align: center;">0.282</td>
<td style="text-align: center;">0.268</td>
</tr>
<tr class="even">
<td style="text-align: left;">ELPD</td>
<td style="text-align: center;">21.5</td>
<td style="text-align: center;">21.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ELPD s.e.</td>
<td style="text-align: center;">6.1</td>
<td style="text-align: center;">6.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">LOOIC</td>
<td style="text-align: center;">−42.9</td>
<td style="text-align: center;">−42.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LOOIC s.e.</td>
<td style="text-align: center;">12.2</td>
<td style="text-align: center;">12.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">WAIC</td>
<td style="text-align: center;">−43.5</td>
<td style="text-align: center;">−43.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">0.14</td>
<td style="text-align: center;">0.14</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As shown in the table above, while the two models are equivalent in fit and give the same posterior distribution for <span class="math inline">\(\beta_3\)</span>, they differ in <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, and <span class="math inline">\(\beta_2\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">conditional_effects</span><span class="op">(</span><span class="va">m_inter2c</span>,</span>
<span>        effects <span class="op">=</span> <span class="st">"Marriage:MedianAgeMarriage"</span>,</span>
<span>        int_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>MedianAgeMarriage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">2.5</span>, <span class="fl">2.7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span>,</span>
<span>    points <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cond-eff-inter2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cond-eff-inter2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06b-multiple-predictors_files/figure-html/fig-cond-eff-inter2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cond-eff-inter2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.7: Model-implied simple slopes of marriage for different levels of median age of marriage.
</figcaption></figure>
</div>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-mcelreath2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: a Bayesian course with examples in R and Stan</em> (Second edition). CRC Press.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-linear-models.html" class="pagination-link" aria-label="Linear Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linear Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06c-regression-diagnostics.html" class="pagination-link" aria-label="Model Diagnostics">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multiple Predictors</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>comma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">2</span>L) <span class="fu">format</span>(x, <span class="at">digits =</span> digits, <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey92"</span>)))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend =</span> <span class="st">"cmdstanr"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>Here, we'll use an example from @mcelreath2020, which contains some marriage and demographic statistics for the individual states in the United States. See <span class="ot">&lt;https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html&gt;</span> for more details.</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data/WaffleDivorce.csv"</span>)) {</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/WaffleDivorce.csv"</span>,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"data/WaffleDivorce.csv"</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>waffle_divorce <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(  <span class="co"># read delimited files</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/WaffleDivorce.csv"</span>,</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Rescale Marriage and Divorce by dividing by 10</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>Marriage <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>Marriage <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>Divorce <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>Divorce <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>MedianAgeMarriage <span class="ot">&lt;-</span> waffle_divorce<span class="sc">$</span>MedianAgeMarriage <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode `South` to a factor variable</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>waffle_divorce<span class="sc">$</span>South <span class="ot">&lt;-</span> <span class="fu">factor</span>(waffle_divorce<span class="sc">$</span>South,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"non-south"</span>, <span class="st">"south"</span>)</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="co"># See data description at https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stratified Analysis</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>Let's consider whether the association between <span class="in">`MedianAgeMarriage`</span> and <span class="in">`Divorce`</span> differs between Southern and non-Southern states. Because (and **only because**) the groups are **independent**, we can fit a linear regression for each subset of states.</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-waffle-divorce</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "State-level association between median age of marriage and divorce rate."</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(waffle_divorce,</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MedianAgeMarriage, <span class="at">y =</span> Divorce, <span class="at">col =</span> South)) <span class="sc">+</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median age marriage (10 years)"</span>,</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Divorce rate (per 10 adults)"</span>) <span class="sc">+</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Loc))</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introducing the `brms` package</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>While Stan is very flexible, because the linear model and some related models are so widely used, some authors have created packages that would further simplify the fitting of such models. One of those packages is <span class="in">`brms`</span>, which I believe stands for "Bayesian regression models with Stan." It allows one to do MCMC sampling using Stan, but with syntax similar to that in R functions <span class="in">`lm()`</span>, <span class="in">`glm()`</span>, and <span class="in">`lme4::lmer()`</span>. <span class="in">`brms`</span> probably supports more models than any R packages that statisticians routinely used; there are models, like factor analysis, that are not directly supported. If you came across some fancy regression models, chances are you can do something similar in <span class="in">`brms`</span>. You can find some resources for learning <span class="in">`brms`</span> on this page: <span class="ot">&lt;https://paul-buerkner.github.io/brms/&gt;</span>.</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model formula {.unnumbered}</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> comes with some default prior options, but I recommend you always check what priors are used and think about whether they make sense for your data. You can use <span class="in">`get_priors()`</span> to show the default priors used in <span class="in">`brms`</span>.</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>To do MCMC sampling, we use the <span class="in">`brm()`</span> function. The first argument is a formula in R. The variable before <span class="in">`~`</span> is the outcome, whereas the ones after <span class="in">`~`</span> are the predictors. For example, </span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>vote <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> growth</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>means the model</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>E(\text{vote}_i) = \beta_0 (1) + \beta_1 (\text{growth}_i).</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>Usually, I write <span class="in">`vote ~ 1 + growth`</span>{.r} as <span class="in">`vote ~ growth`</span>{.r}, as the <span class="in">`1 +`</span> part is automatically added.</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting Priors {.unnumbered}</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> comes with some default prior options, but over the years, the package maintainers have changed those priors, so the default today may be different from the one next year. Therefore, you should always check what priors are used and think about whether they make sense for your data. You can use <span class="in">`get_priors()`</span> to show the default priors used in <span class="in">`brms`</span>. For example,</span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(Divorce <span class="sc">~</span> MedianAgeMarriage,</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> waffle_divorce)</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>m_nonsouth <span class="ot">&lt;-</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">brm</span>(Divorce <span class="sc">~</span> MedianAgeMarriage,</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter `waffle_divorce` to only include non-southern states</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">filter</span>(waffle_divorce, South <span class="sc">==</span> <span class="st">"non-south"</span>),</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use N(0, 2) and N(0, 10) as priors for beta1 and beta0,</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># and use t_4(0, 3) as a prior for sigma</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>) <span class="sc">+</span>          </span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span>     </span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"sigma"</span>),     </span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">"m_nonsouth"</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>m_south <span class="ot">&lt;-</span></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">brm</span>(Divorce <span class="sc">~</span> MedianAgeMarriage,</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">filter</span>(waffle_divorce, South <span class="sc">==</span> <span class="st">"south"</span>),</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>) <span class="sc">+</span></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"sigma"</span>),</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">seed =</span> <span class="dv">2157</span>,  <span class="co"># use a different seed</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">"m_south"</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>We can make a table like @tbl-example2 for <span class="in">`brms`</span> results using the <span class="in">`modelsummary::msummary()`</span>{.r} function.</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-example2</span></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Intercepts and slopes for south and non-south states."</span></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="at">South =</span> m_south, <span class="st">`</span><span class="at">Non-South</span><span class="st">`</span> <span class="ot">=</span> m_nonsouth),</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="cn">NULL</span>, <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>         <span class="at">gof_omit =</span> <span class="st">"^(?!Num)"</span>  <span class="co"># only include number of observations</span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>We can now ask two questions:</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Is the intercept different across southern and non-southern states?</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Is the slope different across southern and non-southern states?</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>The correct way to answer the above questions is to obtain the posterior distribution of the **difference** in the coefficients. Repeat: obtain the posterior distribution of the **difference**. The incorrect way is to compare whether the CIs overlap.</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>Here are the posteriors of the differences ($\beta_0^\text{south} - \beta_0^\text{nonsouth}$ and $\beta_1^\text{south} - \beta_1^\text{nonsouth}$):</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r diff-south}</span></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-diff</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Difference in intercept and slope for south and non-south states."</span></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract draws</span></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a><span class="in">draws_south &lt;- as_draws_matrix(m_south,</span></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="in">    variable = c("b_Intercept", "b_MedianAgeMarriage")</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="in">draws_nonsouth &lt;- as_draws_matrix(m_nonsouth,</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="in">    variable = c("b_Intercept", "b_MedianAgeMarriage")</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a><span class="in"># Difference in coefficients</span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a><span class="in">draws_diff &lt;- draws_south - draws_nonsouth</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename the columns</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(draws_diff) &lt;- paste0("d", colnames(draws_diff))</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="in"># Summarize</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="in">summarize_draws(draws_diff) |&gt;</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="in">    knitr::kable(digits = 2)</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>As you can see, the southern states have a higher intercept and a lower slope.</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-south-vs-nonsouth</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Model-implied regression lines"</span></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Non-southern states"</span></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Southern states"</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m_nonsouth),</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>)[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Non-South"</span>) <span class="sc">+</span> <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="dv">3</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">1.4</span>))</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m_south),</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>)[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"South"</span>) <span class="sc">+</span> <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="dv">3</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">1.4</span>))</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additive Model</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>An additive model assumes that the difference between predicted $Y$ for two levels of $X_1$ is the same regardless of the level of $X_2$. In our example, we assume that the predicted difference in divorce rate associated with the median age of marriage does not depend on whether the state is southern or not. Equivalently, we assume that the predicted difference in Southern and non-Southern states does not depend on the median age of marriage.</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>  D_i &amp; \sim N(\mu_i, \sigma)  <span class="sc">\\</span></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>  \mu_i &amp; = \beta_0 + \beta_1 S_i + \beta_2 A_i <span class="sc">\\</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>  \beta_0 &amp; \sim N(0, 10) <span class="sc">\\</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>  \beta_1 &amp; \sim N(0, 10) <span class="sc">\\</span></span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>  \beta_2 &amp; \sim N(0, 1)  <span class="sc">\\</span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>  \sigma &amp; \sim t^+_4(0, 3)</span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_1$: Expected difference in divorce rate between southern and non-southern states.</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_2$: Expected difference in divorce rate for one unit difference in median age of marriage.</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>In the model, the variable S, southern state, is a dummy variable with 0 = non-southern and 1 = southern. Therefore, </span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dummy Coding</span></span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For non-southern states, $\mu = (\beta_0) + (\beta_2) A$;</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For southern states, $\mu = (\beta_0 + \beta_1) + \beta_2 A$</span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>m_additive <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>    Divorce <span class="sc">~</span> South <span class="sc">+</span> MedianAgeMarriage,</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> waffle_divorce,</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>) <span class="sc">+</span></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"Southsouth"</span>) <span class="sc">+</span></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"sigma"</span>),</span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"m_additive"</span></span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>m_additive</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction Model: Different Slopes Across Two Groups</span></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>An alternative is to include an interaction term</span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>  D_i &amp; \sim N(\mu_i, \sigma)  <span class="sc">\\</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>  \mu_i &amp; = \beta_0 + \beta_1 S_i + \beta_2 A_i + \beta_3 S_i \times A_i <span class="sc">\\</span></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>  \beta_0 &amp; \sim N(0, 10) <span class="sc">\\</span></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>  \beta_1 &amp; \sim N(0, 10) <span class="sc">\\</span></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>  \beta_2 &amp; \sim N(0, 1) <span class="sc">\\</span></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>  \beta_3 &amp; \sim N(0, 2) <span class="sc">\\</span></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a>  \sigma &amp; \sim t^+_4(0, 3)</span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_1$: Difference in intercept between southern and non-southern states.</span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_3$: Difference in the coefficient for A <span class="dv">&amp;rarr;</span> D between southern and non-southern states</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dummy Coding in Interaction Model</span></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For non-southern states, $\mu = (\beta_0) + (\beta_2) A$;</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For southern states, $\mu = (\beta_0 + \beta_1) + (\beta_2 + \beta_3) A$</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>m_inter <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>    Divorce <span class="sc">~</span> South <span class="sc">*</span> MedianAgeMarriage,</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> waffle_divorce,</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>) <span class="sc">+</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"Southsouth"</span>) <span class="sc">+</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"sigma"</span>),</span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"m_inter"</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>The formula <span class="in">`Divorce ~ South * MedianAgeMarriage`</span>{.r} is the same as</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a>Divorce <span class="sc">~</span> South <span class="sc">+</span> MedianAgeMarriage <span class="sc">+</span> South<span class="sc">:</span>MedianAgeMarriage</span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>where <span class="in">`:`</span> is the symbol in R for a product term.</span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of the model</span></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a>m_inter</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior predictive checks</span></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pp-check-inter</span></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior predictive checks for the interaction model."</span></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Density overlayed plots"</span></span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Prediction intervals"</span></span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Check density (normality)</span></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m_inter, <span class="at">type =</span> <span class="st">"dens_overlay_grouped"</span>, <span class="at">group =</span> <span class="st">"South"</span>)</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Check prediction (a few outliers)</span></span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m_inter,</span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"ribbon_grouped"</span>, <span class="at">x =</span> <span class="st">"MedianAgeMarriage"</span>,</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"South"</span>,</span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_draw =</span> <span class="st">"points"</span></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error-plot-inter</span></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average prediction error against the predictor. No clear pattern should be observed for a correctly specified model."</span></span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Check errors (no clear pattern)</span></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m_inter,</span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"error_scatter_avg_vs_x"</span>, <span class="at">x =</span> <span class="st">"MedianAgeMarriage"</span></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conditional effects/simple slopes</span></span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>Slope of <span class="in">`MedianAgeMarriage`</span> when South = 0: $\beta_1$</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a>Slope of <span class="in">`MedianAgeMarriage`</span> when South = 1: $\beta_1 + \beta_3$</span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summ-simple-slopes}</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a><span class="in">as_draws(m_inter) |&gt;</span></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate_variables(</span></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="in">        b_nonsouth = b_MedianAgeMarriage,</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a><span class="in">        b_south = b_MedianAgeMarriage + `b_Southsouth:MedianAgeMarriage`</span></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a><span class="in">    posterior::subset_draws(</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a><span class="in">        variable = c("b_nonsouth", "b_south")</span></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a><span class="in">    summarize_draws() |&gt;</span></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a><span class="in">    knitr::kable(digits = 2)</span></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cond-eff-inter</span></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Model-implied simple slopes based on the interaction model."</span></span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m_inter,</span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a>        <span class="at">effects =</span> <span class="st">"MedianAgeMarriage"</span>,</span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>        <span class="at">conditions =</span> <span class="fu">data.frame</span>(<span class="at">South =</span> <span class="fu">c</span>(<span class="st">"south"</span>, <span class="st">"non-south"</span>),</span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cond__ =</span> <span class="fu">c</span>(<span class="st">"South"</span>, <span class="st">"Non-South"</span>))</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction of Continuous Predictors</span></span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plotly-divorce</span></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "3-D plot visualizing one outcome and two predictors."</span></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">plot_ly</span>(waffle_divorce,</span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="sc">~</span>Marriage,</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="sc">~</span>MedianAgeMarriage,</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>                <span class="at">z =</span> <span class="sc">~</span>Divorce)</span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a>  D_i &amp; \sim N(\mu_i, \sigma)  <span class="sc">\\</span></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a>  \mu_i &amp; = \beta_0 + \beta_1 M_i + \beta_2 A_i + \beta_3 M_i \times A_i <span class="sc">\\</span></span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Use default priors (just for convenience here)</span></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>m_inter2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(Divorce <span class="sc">~</span> Marriage <span class="sc">*</span> MedianAgeMarriage,</span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> waffle_divorce,</span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"m_inter2"</span></span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## Centering</span></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>In the previous model, $\beta_1$ is the slope of M <span class="dv">&amp;rarr;</span> D when A is 0 (i.e., median marriage age = 0), and $\beta_2$ is the slope of A <span class="dv">&amp;rarr;</span> D when M is 0 (i.e., marriage rate is 0). These two are not very meaningful. Therefore, it is common to make the zero values more meaningful by doing *centering*.</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a>Here, I use M - 2 as the predictor, so the zero point means a marriage rate of 2 per 10 adults; I use A - 2.5 as the other predictor, so the zero point means a median marriage rate of 25 years old.</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>\mu_i = \beta_0 + \beta_1 (M_i - 2) + \beta_2 (A_i - 2.5) + \beta_3 (M_i - 2) \times (A_i - 2.5)</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Use default priors (just for convenience here)</span></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>m_inter2c <span class="ot">&lt;-</span> <span class="fu">brm</span>(Divorce <span class="sc">~</span> <span class="fu">I</span>(Marriage <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">I</span>(MedianAgeMarriage <span class="sc">-</span> <span class="fl">2.5</span>),</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> waffle_divorce,</span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">941</span>,</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"m_inter2c"</span></span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="st">`</span><span class="at">No centering</span><span class="st">`</span> <span class="ot">=</span> m_inter2, <span class="st">`</span><span class="at">centered</span><span class="st">`</span> <span class="ot">=</span> m_inter2c),</span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="cn">NULL</span>, <span class="at">fmt =</span> <span class="dv">2</span>)</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>As shown in the table above, while the two models are equivalent in fit and give the same posterior distribution for $\beta_3$, they differ in $\beta_0$, $\beta_1$, and $\beta_2$.</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cond-eff-inter2</span></span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: |</span></span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a><span class="co">#|   Model-implied simple slopes of marriage for different levels of median age of marriage.</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conditional_effects</span>(m_inter2c,</span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a>        <span class="at">effects =</span> <span class="st">"Marriage:MedianAgeMarriage"</span>,</span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a>        <span class="at">int_conditions =</span> <span class="fu">list</span>(<span class="at">MedianAgeMarriage =</span> <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">2.5</span>, <span class="fl">2.7</span>)),</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">points =</span> <span class="cn">TRUE</span></span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Hok Chio (Mark) Lai</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>